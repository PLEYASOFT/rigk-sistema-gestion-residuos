"use strict";(self.webpackChunkrigk_sg_web=self.webpackChunkrigk_sg_web||[]).push([[590],{3590:(tt,F,_)=>{_.r(F),_.d(F,{ProductorStatementModule:()=>et});var p=_(6895),f=_(5792),M=_(5226),u=_.n(M),C=_(1566),B=_(9751),O=_(3532);var Y=_(4004),k=_(2529),e=_(8256),d=_(433),T=_(371),y=_(8195),U=_(5861),J=_(4351),E=_(574),v=_(2227);const L=["table1"];function V(s,r){if(1&s&&(e.TgZ(0,"tr",13)(1,"td",26),e._uU(2),e.qZA(),e.TgZ(3,"td",29),e._uU(4,"0"),e.qZA(),e.TgZ(5,"td",29),e._uU(6,"0"),e.qZA(),e.TgZ(7,"td",29),e._uU(8,"0"),e.qZA(),e.TgZ(9,"td",30),e._uU(10,"0 "),e.qZA()()),2&s){const t=r.$implicit,i=r.index;e.xp6(2),e.Oqu(t),e.xp6(1),e.MGl("id","prim_weight_",i+1,""),e.xp6(2),e.MGl("id","sec_weight_",i+1,""),e.xp6(2),e.MGl("id","ter_weight_",i+1,""),e.xp6(2),e.MGl("id","total_category_weight_",i+1,"")}}function H(s,r){if(1&s&&(e.ynx(0),e.TgZ(1,"td",26),e._uU(2),e.qZA(),e.TgZ(3,"td",29),e._uU(4,"0"),e.qZA(),e.TgZ(5,"td",29),e._uU(6,"0"),e.qZA(),e.TgZ(7,"td",29),e._uU(8,"0"),e.qZA(),e.TgZ(9,"td",30),e._uU(10,"0 "),e.qZA(),e.TgZ(11,"td",30),e._uU(12,"$0"),e.qZA(),e.BQk()),2&s){const t=e.oxw(),i=t.$implicit,n=t.index;e.xp6(2),e.Oqu(i),e.xp6(1),e.MGl("id","actual_amount_",n,""),e.xp6(2),e.MGl("id","amount_anual_",n,""),e.xp6(2),e.MGl("id","total_neto",n,""),e.xp6(2),e.MGl("id","iva_",n,""),e.xp6(2),e.MGl("id","uf_clp_",n,"")}}function $(s,r){if(1&s&&(e.TgZ(0,"tr",13),e.YNc(1,H,13,6,"ng-container",31),e.qZA()),2&s){const t=r.$implicit;e.xp6(1),e.Q6J("ngIf","Retornables"!==t)}}let q=(()=>{class s{constructor(t,i,n){this.productorService=t,this.actived=i,this.ratesService=n,this.tablas=["Reciclable","No Reciclable","Retornables / Reutilizables"],this.residuos=["Papel/Cart\xf3n Reciclable","Metal Reciclable","Pl\xe1stico Reciclable","No Reciclables","Retornables"],this.id_business=0,this.year_statement=0,this.id_statement=null,this.detailForm=[],this.detailLastForm=[],this.tonSums={primario:Array.from({length:5},()=>0),secundario:Array.from({length:5},()=>0),terciario:Array.from({length:5},()=>0),tonSum:Array.from({length:5},()=>0),l_tonSum:Array.from({length:5},()=>0)},this.tonNoReciclablePrim=0,this.tonNoReciclableSec=0,this.tonNoReciclableTer=0,this.tonRetPrim=0,this.tonRetSec=0,this.tonRetTer=0,this.result=0,this.dif=Array.from({length:5},()=>0),this.ajuste=Array.from({length:5},()=>0),this.costoAnual=Array.from({length:5},()=>0),this.sumaAmount=0,this.sumaNeto=0,this.sumaIva=0,this.sumaUF=0,this.actived.queryParams.subscribe(o=>{this.id_business=o.id_business,this.year_statement=o.year})}ngAfterViewInit(){this.generateForm()}generateForm(){var t=this;return(0,U.Z)(function*(){t.detailLastForm=JSON.parse(sessionStorage.getItem("detailLastForm")),t.detailForm=JSON.parse(sessionStorage.getItem("detailForm")),t.hasMV_PapelCarton=JSON.parse(sessionStorage.getItem("hasMV_PapelCarton")),t.hasMV_Metal=JSON.parse(sessionStorage.getItem("hasMV_Metal")),t.hasMV_Plastico=JSON.parse(sessionStorage.getItem("hasMV_Plastico")),t.id_statement=JSON.parse(sessionStorage.getItem("id_statement"));for(let n=0;n<t.detailForm.length;n++){const o=t.detailForm[n];3==o.recyclability&&(1==o.type_residue&&!t.hasMV_PapelCarton||2==o.type_residue&&!t.hasMV_Metal||3==o.type_residue&&!t.hasMV_Plastico)&&(o.recyclability=1),1==o.recyclability?(1==o.precedence&&(t.tonSums.primario[o?.type_residue-1]=t.tonSums.primario[o?.type_residue-1]+parseFloat(o?.value),t.result=t.tonSums.primario[o?.type_residue-1],4!=o?.type_residue&&(document.getElementById(`prim_weight_${o?.type_residue}`).innerHTML=t.setFormato(t.result),t.costoAnual[o?.type_residue-1]=t.result)),2==o.precedence&&(t.tonSums.secundario[o?.type_residue-1]=t.tonSums.secundario[o?.type_residue-1]+parseFloat(o?.value),t.result=t.tonSums.secundario[o?.type_residue-1],4!=o?.type_residue&&(document.getElementById(`sec_weight_${o?.type_residue}`).innerHTML=t.setFormato(t.result),t.costoAnual[o?.type_residue-1]=t.result)),3==o.precedence&&(t.tonSums.terciario[o?.type_residue-1]=t.tonSums.terciario[o?.type_residue-1]+parseFloat(o?.value),t.result=t.tonSums.terciario[o?.type_residue-1],4!=o?.type_residue&&(document.getElementById(`ter_weight_${o?.type_residue}`).innerHTML=t.setFormato(t.result),t.costoAnual[o?.type_residue-1]=t.result)),4!=o?.type_residue&&(t.costoAnual[o?.type_residue-1]=t.tonSums.primario[o?.type_residue-1]+t.tonSums.secundario[o?.type_residue-1]+t.tonSums.terciario[o?.type_residue-1])):2==o.recyclability?4!=o?.type_residue&&(1==o.precedence&&(t.tonNoReciclablePrim=t.tonNoReciclablePrim+parseFloat(o?.value),t.result=t.tonNoReciclablePrim,document.getElementById("prim_weight_4").innerHTML=t.setFormato(t.result),t.costoAnual[3]=t.result),2==o.precedence&&(t.tonNoReciclableSec=t.tonNoReciclableSec+parseFloat(o?.value),t.result=t.tonNoReciclableSec,document.getElementById("sec_weight_4").innerHTML=t.setFormato(t.result),t.costoAnual[3]=t.result),3==o.precedence&&(t.tonNoReciclableTer=t.tonNoReciclableTer+parseFloat(o?.value),t.result=t.tonNoReciclableTer,document.getElementById("ter_weight_4").innerHTML=t.setFormato(t.result),t.costoAnual[3]=t.result),t.costoAnual[3]=t.tonNoReciclablePrim+t.tonNoReciclableSec+t.tonNoReciclableTer):3==o.recyclability&&(1==o.precedence&&(t.tonRetPrim=t.tonRetPrim+parseFloat(o?.value),t.result=t.tonRetPrim,document.getElementById("prim_weight_5").innerHTML=t.setFormato(t.result)),2==o.precedence&&(t.tonRetSec=t.tonRetSec+parseFloat(o?.value),t.result=t.tonRetSec,document.getElementById("sec_weight_5").innerHTML=t.setFormato(t.result)),3==o.precedence&&(t.tonRetTer=t.tonRetTer+parseFloat(o?.value),t.result=t.tonRetTer,document.getElementById("ter_weight_5").innerHTML=t.setFormato(t.result)),t.costoAnual[4]=t.tonRetPrim+t.tonRetSec+t.tonRetTer)}for(let n=1;n<=5;n++)t.result=parseFloat(document.getElementById(`prim_weight_${n}`).innerHTML.replace(/\./g,"").replace(",","."))+parseFloat(document.getElementById(`sec_weight_${n}`).innerHTML.replace(/\./g,"").replace(",","."))+parseFloat(document.getElementById(`ter_weight_${n}`).innerHTML.replace(/\./g,"").replace(",",".")),document.getElementById(`total_category_weight_${n}`).innerHTML=t.setFormato(t.result),t.sumaAmount=t.sumaAmount+t.result;document.getElementById("total_ton").innerHTML=t.setFormato(t.sumaAmount),document.getElementById("pom_total").innerHTML=document.getElementById("total_ton").innerHTML;const i=parseInt(t.year_statement.toString())+1;yield t.ratesService.getRates(i).pipe((0,J.b)(n=>{t.sumaAmount=0;for(let o=0;o<4;o++)document.getElementById(`actual_amount_${o}`).innerHTML=t.setFormato(n.data[o].price),document.getElementById(`amount_anual_${o}`).innerHTML=t.setFormato(n.data[o].price*t.costoAnual[o]),t.sumaAmount=t.sumaAmount+parseFloat((n.data[o].price*t.costoAnual[o]).toFixed(2))+parseFloat((n.data[o].price*t.ajuste[o]).toFixed(2)),t.sumaUF=t.sumaUF+parseFloat((n.data[o].price*t.costoAnual[o]).toFixed(2)),t.dif[o]=n.data[o].price*t.costoAnual[o]+n.data[o].price*t.ajuste[o];return document.getElementById("anual_amount").innerHTML=t.setFormato(t.sumaUF),sessionStorage.setItem("uf_anual",t.sumaUF.toString()),t.ratesService.getUF})).subscribe(n=>{t.sumaAmount=0;for(let a=0;a<4;a++)t.sumaAmount=t.sumaAmount+t.dif[a]*n.data*1.19,document.getElementById(`total_neto${a}`).innerHTML="$"+t.setFormato((t.dif[a]*n.data).toFixed(0)),document.getElementById(`iva_${a}`).innerHTML="$"+t.setFormato(parseInt((t.dif[a]*n.data*1.19).toFixed(0))-parseInt((t.dif[a]*n.data).toFixed(0))),document.getElementById(`uf_clp_${a}`).innerHTML="$"+t.setFormato(parseInt((t.dif[a]*n.data*1.19).toFixed(0))),t.sumaNeto=t.sumaNeto+t.dif[a]*n.data,t.sumaIva=t.sumaIva+(t.dif[a]*n.data*1.19-t.dif[a]*n.data);document.getElementById("total_uf_clp").innerHTML="$"+t.setFormato(parseInt(t.sumaAmount.toFixed(0))),document.getElementById("amount_clp").innerHTML="$"+t.setFormato(parseInt(t.sumaAmount.toFixed(0))),document.getElementById("ajuste_amount").innerHTML="$"+t.setFormato(parseInt(t.sumaNeto.toFixed(0))),document.getElementById("total_amount_iva").innerHTML="$"+t.setFormato(parseInt(t.sumaIva.toFixed(0)));const o=JSON.parse(sessionStorage.getItem("uf_anual"));null!==o&&t.productorService.updateUFStatement(t.id_statement,o).subscribe()})})()}tableToExcel(){const t=E.P6.table_to_sheet(this.table.nativeElement,{raw:!0}),i=E.P6.book_new();E.P6.book_append_sheet(i,t,"Sheet1"),E.NC(i,"Tabla-Resumen.xlsx")}setFormato(t){const i="string"==typeof t?parseFloat(t.replace(/,/g,"")):t,n=Math.round(100*i)/100,[o,a]=n.toString().split("."),l=o.replace(/\B(?=(\d{3})+(?!\d))/g,".");return a&&"0"!==a?`${l},${a.padEnd(2,"0")}`:l}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(T.u),e.Y36(f.gz),e.Y36(v.z))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-summary-statement"]],viewQuery:function(t,i){if(1&t&&e.Gf(L,5),2&t){let n;e.iGM(n=e.CRH())&&(i.table=n.first)}},decls:127,vars:8,consts:[[1,"d-md-flex","justify-content-end"],[1,"btn",3,"click"],["aria-hidden","true",1,"fa","fa-file-excel-o","fa-fw","fa-lg"],[1,"table-responsive","mb-4"],["table1",""],[1,"row","w-100"],[1,"w-100"],[1,"w-100","table-responsive-md"],[1,"table","table-even","table-section","table-borderless","table-align-middle","table-border","table-radius","d-lg-table","table-statement"],["colspan","13",2,"margin-bottom","100px"],[1,"text-center","w-100"],[1,"mi-columna",2,"background-color","rgb(8, 148, 110)","color","white"],["class","text-end w-100",4,"ngFor","ngForOf"],[1,"text-end","w-100"],["colspan","4",1,"text-start",2,"background-color","rgb(8, 148, 110)","color","white"],["id","total_ton",2,"background-color","rgb(8, 148, 110)","color","white"],["colspan","13"],["id","table",1,"w-100"],["colspan","2",1,"text-start",2,"background-color","rgb(8, 148, 110)","color","white"],["id","anual_amount",2,"background-color","rgb(8, 148, 110)","color","white"],["id","ajuste_amount",2,"background-color","rgb(8, 148, 110)","color","white"],["id","total_amount_iva",2,"background-color","rgb(8, 148, 110)","color","white"],["id","total_uf_clp",2,"background-color","rgb(8, 148, 110)","color","white"],["id","mi-tabla"],["colspan","2"],[2,"background-color","rgb(8, 148, 110)","color","white"],[1,"text-start"],["id","pom_total"],["id","amount_clp"],[3,"id"],[2,"background-color","rgb(217, 217, 217)",3,"id"],[4,"ngIf"]],template:function(t,i){1&t&&(e.TgZ(0,"h1"),e._uU(1),e.qZA(),e.TgZ(2,"div",0)(3,"a",1),e.NdJ("click",function(){return i.tableToExcel()}),e._uU(4,"Exportar Excel "),e._UZ(5,"i",2),e.qZA()(),e.TgZ(6,"div",3,4)(8,"section")(9,"div",5)(10,"div",6)(11,"div",7)(12,"table",8)(13,"thead")(14,"tr")(15,"th",9),e._uU(16,"Resumen de EyE por subcategor\xeda"),e.qZA()()(),e._UZ(17,"p"),e.TgZ(18,"thead")(19,"tr",10)(20,"th",11),e._uU(21,"Subcategor\xeda"),e.qZA(),e.TgZ(22,"th",11),e._uU(23,"Primarios"),e.qZA(),e.TgZ(24,"th",11),e._uU(25,"Secundarios"),e.qZA(),e.TgZ(26,"th",11),e._uU(27,"Terciarios"),e.qZA(),e.TgZ(28,"th",11),e._uU(29,"Peso Total (Ton)"),e.qZA()()(),e.TgZ(30,"tbody"),e.YNc(31,V,11,5,"tr",12),e.qZA(),e.TgZ(32,"tfoot")(33,"tr",13)(34,"td",14),e._uU(35,"Total (Peso)"),e.qZA(),e.TgZ(36,"td",15),e._uU(37,"0"),e.qZA()()()()()()(),e.TgZ(38,"tr")(39,"td",16),e._uU(40," No se considera los EyE de madera "),e.qZA()(),e._UZ(41,"p")(42,"p"),e.TgZ(43,"div",5)(44,"div",17,4)(46,"div",7)(47,"table",8)(48,"thead")(49,"tr")(50,"th",9),e._uU(51),e.qZA()()(),e._UZ(52,"p"),e.TgZ(53,"thead")(54,"tr",10)(55,"th",11),e._uU(56,"Subcategor\xeda"),e.qZA(),e.TgZ(57,"th",11),e._uU(58),e.qZA(),e.TgZ(59,"th",11),e._uU(60),e.qZA(),e.TgZ(61,"th",11),e._uU(62,"Total Neto (CL$)"),e.qZA(),e.TgZ(63,"th",11),e._uU(64,"IVA"),e.qZA(),e.TgZ(65,"th",11),e._uU(66,"Total (CL$) "),e.qZA()()(),e.TgZ(67,"tbody"),e.YNc(68,$,2,1,"tr",12),e.qZA(),e.TgZ(69,"tfoot")(70,"tr",13)(71,"td",18),e._uU(72,"Total (Costo)"),e.qZA(),e.TgZ(73,"td",19),e._uU(74,"0"),e.qZA(),e.TgZ(75,"td",20),e._uU(76,"0"),e.qZA(),e.TgZ(77,"td",21),e._uU(78,"0"),e.qZA(),e.TgZ(79,"td",22),e._uU(80,"$0"),e.qZA()()()()()()(),e._UZ(81,"p"),e._uU(82," La factura se enviar\xe1 con el valor de la UF al momento de enviar la declaraci\xf3n. "),e._UZ(83,"p"),e.TgZ(84,"div",23)(85,"table",8)(86,"thead")(87,"tr")(88,"th",24),e._uU(89),e.qZA()()(),e._UZ(90,"p"),e.TgZ(91,"thead")(92,"tr",10)(93,"th",25),e._uU(94,"Total Subcategor\xedas de EyE"),e.qZA(),e.TgZ(95,"th",25),e._uU(96,"Total EyE"),e.qZA()()(),e.TgZ(97,"tbody")(98,"tr",10)(99,"td",26),e._uU(100,"Total EyE (Ton)"),e.qZA(),e.TgZ(101,"td",27),e._uU(102,"0"),e.qZA()()()()(),e._UZ(103,"p")(104,"p"),e.TgZ(105,"div",23)(106,"table",8)(107,"thead")(108,"tr")(109,"th",24),e._uU(110),e.qZA()()(),e._UZ(111,"p"),e.TgZ(112,"thead")(113,"tr",10)(114,"th",25),e._uU(115,"Material"),e.qZA(),e.TgZ(116,"th",25),e._uU(117,"Total UF"),e.qZA()()(),e.TgZ(118,"tbody")(119,"tr",10)(120,"td",26),e._uU(121,"Costo Total"),e.qZA(),e.TgZ(122,"td",28),e._uU(123,"0"),e.qZA()()()()(),e.TgZ(124,"tr")(125,"td",16),e._uU(126," El Costo Total en $CL se factura con el valor de la UF al momento de enviar la declaraci\xf3n. A ese Monto Neto se le agrega el IVA. "),e.qZA()()()()),2&t&&(e.xp6(1),e.hij(" Tabla Resumen ",+i.year_statement," "),e.xp6(30),e.Q6J("ngForOf",i.residuos),e.xp6(20),e.hij("Resumen de costos (UF) ",+i.year_statement+1,""),e.xp6(7),e.hij("Tarifa ",+i.year_statement+1," (UF)"),e.xp6(2),e.hij("Costo Anual ",i.year_statement," (UF)"),e.xp6(8),e.Q6J("ngForOf",i.residuos),e.xp6(21),e.hij("Total EyE declarados ",i.year_statement," (Ton)"),e.xp6(21),e.hij("Costo total ",+i.year_statement+1,""))},dependencies:[p.sg,p.O5],styles:[".d-none[_ngcontent-%COMP%]{display:none}#mi-tabla[_ngcontent-%COMP%]{width:25%!important}.mi-columna[_ngcontent-%COMP%]{width:100px}.columna-doble[_ngcontent-%COMP%]{width:200px}"]}),s})();function Q(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"td"),e._uU(1),e.qZA(),e.TgZ(2,"td",43),e._uU(3,"0"),e.qZA(),e.TgZ(4,"td")(5,"input",44),e.NdJ("change",function(n){e.CHM(t);const o=e.oxw().index,a=e.oxw().index,l=e.oxw();return e.KtG(l.updateValue(a+1,o+1,1,2,n.target))}),e.qZA()(),e.TgZ(6,"td",43),e._uU(7,"0"),e.qZA(),e.TgZ(8,"td")(9,"input",45),e.NdJ("change",function(n){e.CHM(t);const o=e.oxw().index,a=e.oxw().index,l=e.oxw();return e.KtG(l.updateValue(a+1,o+1,1,1,n.target))}),e.qZA()(),e.TgZ(10,"td",43),e._uU(11,"0"),e.qZA(),e.TgZ(12,"td")(13,"input",45),e.NdJ("change",function(n){e.CHM(t);const o=e.oxw().index,a=e.oxw().index,l=e.oxw();return e.KtG(l.updateValue(a+1,o+1,2,1,n.target))}),e.qZA()(),e.TgZ(14,"td",43),e._uU(15,"0"),e.qZA(),e.TgZ(16,"td")(17,"input",45),e.NdJ("change",function(n){e.CHM(t);const o=e.oxw().index,a=e.oxw().index,l=e.oxw();return e.KtG(l.updateValue(a+1,o+1,3,1,n.target))}),e.qZA()(),e.TgZ(18,"td"),e._UZ(19,"input",46),e.qZA(),e.TgZ(20,"td",47),e._uU(21,"0"),e.qZA(),e.TgZ(22,"td"),e._UZ(23,"input",48),e.qZA()}if(2&s){const t=e.oxw(),i=t.$implicit,n=t.index,o=e.oxw().index;e.xp6(1),e.Oqu(i),e.xp6(1),e.hYB("id","inp_l_",o+1,"_",n+1,"_1_2"),e.xp6(3),e.hYB("id","inp_",o+1,"_",n+1,"_1_2"),e.xp6(1),e.hYB("id","inp_l_",o+1,"_",n+1,"_1_1"),e.xp6(3),e.hYB("id","inp_",o+1,"_",n+1,"_1_1"),e.xp6(1),e.hYB("id","inp_l_",o+1,"_",n+1,"_2_1"),e.xp6(3),e.hYB("id","inp_",o+1,"_",n+1,"_2_1"),e.xp6(1),e.hYB("id","inp_l_",o+1,"_",n+1,"_3_1"),e.xp6(3),e.hYB("id","inp_",o+1,"_",n+1,"_3_1"),e.xp6(2),e.hYB("id","actual_dif_",o+1,"_",n+1,""),e.xp6(1),e.hYB("id","last_weight_",o+1,"_",n+1,""),e.xp6(3),e.hYB("id","actual_weight_",o+1,"_",n+1,"")}}function j(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"td",47),e._uU(1,"0"),e.qZA(),e.TgZ(2,"td",49)(3,"input",44),e.NdJ("change",function(n){e.CHM(t);const o=e.oxw().index,a=e.oxw().index,l=e.oxw();return e.KtG(l.updateValue(a+1,o+1,1,2,n.target))}),e.qZA()(),e.TgZ(4,"td",47),e._uU(5,"0"),e.qZA(),e.TgZ(6,"td",49)(7,"input",45),e.NdJ("change",function(n){e.CHM(t);const o=e.oxw().index,a=e.oxw().index,l=e.oxw();return e.KtG(l.updateValue(a+1,o+1,1,1,n.target))}),e.qZA()(),e.TgZ(8,"td",47),e._uU(9,"0"),e.qZA(),e.TgZ(10,"td",49)(11,"input",45),e.NdJ("change",function(n){e.CHM(t);const o=e.oxw().index,a=e.oxw().index,l=e.oxw();return e.KtG(l.updateValue(a+1,o+1,2,1,n.target))}),e.qZA()(),e.TgZ(12,"td",47),e._uU(13,"0"),e.qZA(),e.TgZ(14,"td",49)(15,"input",45),e.NdJ("change",function(n){e.CHM(t);const o=e.oxw().index,a=e.oxw().index,l=e.oxw();return e.KtG(l.updateValue(a+1,o+1,3,1,n.target))}),e.qZA()(),e.TgZ(16,"td",49),e._UZ(17,"input",50),e.qZA(),e.TgZ(18,"td",47),e._uU(19,"0"),e.qZA(),e.TgZ(20,"td",49),e._UZ(21,"input",50),e.qZA()}if(2&s){const t=e.oxw().index,i=e.oxw().index;e.hYB("id","inp_l_",i+1,"_",t+1,"_1_2"),e.xp6(3),e.hYB("id","inp_",i+1,"_",t+1,"_1_2"),e.xp6(1),e.hYB("id","inp_l_",i+1,"_",t+1,"_1_1"),e.xp6(3),e.hYB("id","inp_",i+1,"_",t+1,"_1_1"),e.xp6(1),e.hYB("id","inp_l_",i+1,"_",t+1,"_2_1"),e.xp6(3),e.hYB("id","inp_",i+1,"_",t+1,"_2_1"),e.xp6(1),e.hYB("id","inp_l_",i+1,"_",t+1,"_3_1"),e.xp6(3),e.hYB("id","inp_",i+1,"_",t+1,"_3_1"),e.xp6(2),e.hYB("id","actual_dif_",i+1,"_",t+1,""),e.xp6(1),e.hYB("id","last_weight_",i+1,"_",t+1,""),e.xp6(3),e.hYB("id","actual_weight_",i+1,"_",t+1,"")}}function G(s,r){if(1&s&&(e.TgZ(0,"tr",41),e.ynx(1),e.YNc(2,Q,24,23,"ng-template",42),e.YNc(3,j,22,22,"ng-template",42),e.BQk(),e.qZA()),2&s){const t=r.$implicit,i=e.oxw().$implicit;e.xp6(2),e.Q6J("ngIf","Envases compuestos"!==t||"Envases compuestos"===t&&"EyE No Reciclables"===i),e.xp6(1),e.Q6J("ngIf",!("Envases compuestos"!==t||"Envases compuestos"===t&&"EyE No Reciclables"===i))}}function z(s,r){if(1&s&&(e.TgZ(0,"div",27)(1,"table",28)(2,"thead")(3,"tr")(4,"th",29),e._uU(5),e.qZA()()(),e.TgZ(6,"tbody")(7,"tr",30)(8,"td",31),e._uU(9),e.qZA(),e.TgZ(10,"td",32),e._uU(11,"Primarios No Peligrosos"),e.qZA(),e.TgZ(12,"td",32),e._uU(13,"Primarios Peligrosos"),e.qZA(),e.TgZ(14,"td",32),e._uU(15,"Secundarios"),e.qZA(),e.TgZ(16,"td",32),e._uU(17,"Terciarios"),e.qZA(),e.TgZ(18,"td"),e._uU(19),e.qZA(),e.TgZ(20,"td",32),e._uU(21,"Peso Total"),e.qZA()(),e.TgZ(22,"tr",33)(23,"td",34),e._uU(24),e.qZA(),e.TgZ(25,"td",35),e._uU(26),e.qZA(),e.TgZ(27,"td",34),e._uU(28),e.qZA(),e.TgZ(29,"td",35),e._uU(30),e.qZA(),e.TgZ(31,"td",34),e._uU(32),e.qZA(),e.TgZ(33,"td",35),e._uU(34),e.qZA(),e.TgZ(35,"td",34),e._uU(36),e.qZA(),e.TgZ(37,"td",35),e._uU(38),e.qZA(),e._UZ(39,"td",34),e.TgZ(40,"td",35),e._uU(41),e.qZA()(),e.YNc(42,G,4,2,"tr",36),e.qZA(),e.TgZ(43,"tfoot")(44,"tr"),e._UZ(45,"td",37)(46,"span",38),e.TgZ(47,"td",32)(48,"div",39)(49,"span"),e._uU(50,"Peso (ton):"),e.qZA(),e._UZ(51,"span",40),e.qZA()()()()()()),2&s){const t=r.$implicit,i=r.index,n=e.oxw();e.xp6(5),e.AsE("Declaraci\xf3n REP ",t," a\xf1o ",n.year_statement," en toneladas"),e.xp6(4),e.Oqu(t),e.xp6(10),e.AsE("Dif. ",n.year_statement-1," vs ",n.year_statement," (%)"),e.xp6(5),e.Oqu(n.year_statement-1),e.xp6(2),e.Oqu(n.year_statement),e.xp6(2),e.Oqu(n.year_statement-1),e.xp6(2),e.Oqu(n.year_statement),e.xp6(2),e.Oqu(n.year_statement-1),e.xp6(2),e.Oqu(n.year_statement),e.xp6(2),e.Oqu(n.year_statement-1),e.xp6(2),e.Oqu(n.year_statement),e.xp6(3),e.Oqu(n.year_statement),e.xp6(1),e.Q6J("ngForOf",n.residuos),e.xp6(4),e.MGl("id","total_amount_",i+1,""),e.xp6(5),e.MGl("id","total_weight_",i+1,"")}}function K(s,r){if(1&s&&(e.TgZ(0,"option",51),e._uU(1),e.qZA()),2&s){const t=r.$implicit;e.Q6J("value",t.value),e.xp6(1),e.Oqu(t.name)}}function X(s,r){1&s&&(e.TgZ(0,"p"),e._uU(1,"Debe seleccionar algun tipo de MV."),e.qZA())}function W(s,r){if(1&s&&(e.TgZ(0,"div",52),e.YNc(1,X,2,0,"p",26),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.userForm.controls.MV.errors.required)}}function ee(s,r){1&s&&(e.TgZ(0,"p"),e._uU(1,"El formato del archivo debe ser PDF, JPEG o JPG."),e.qZA())}function te(s,r){1&s&&(e.TgZ(0,"p"),e._uU(1,"El tama\xf1o del archivo no debe superar 1 MB."),e.qZA())}function ie(s,r){if(1&s&&(e.TgZ(0,"div",52),e.YNc(1,ee,2,0,"p",26),e.YNc(2,te,2,0,"p",26),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.userForm.controls.ARCHIVO.errors.invalidFileType),e.xp6(1),e.Q6J("ngIf",t.userForm.controls.ARCHIVO.errors.invalidFileSize)}}function ne(s,r){1&s&&(e.TgZ(0,"div",53),e._uU(1," No se pueden subir m\xe1s de 9 archivos de verificaci\xf3n. "),e.qZA())}function oe(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"tr",56)(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td")(4,"a",58),e._uU(5),e.qZA()(),e.TgZ(6,"td")(7,"button",59),e.NdJ("click",function(){const o=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.deleteMV(o.ID))}),e._uU(8," X "),e.qZA()()()}if(2&s){const t=r.$implicit;e.xp6(2),e.Oqu(t.TYPE_MATERIAL_TIPEADO),e.xp6(3),e.Oqu(t.FILE_NAME)}}function se(s,r){if(1&s&&(e.TgZ(0,"div"),e._UZ(1,"div",54),e.TgZ(2,"table",55)(3,"thead")(4,"tr",56)(5,"th"),e._uU(6,"Tipo MV"),e.qZA(),e.TgZ(7,"th"),e._uU(8,"Nombre Archivo"),e.qZA(),e.TgZ(9,"th"),e._uU(10,"Eliminar"),e.qZA()()(),e.TgZ(11,"tbody"),e.YNc(12,oe,9,2,"tr",57),e.qZA()()()),2&s){const t=e.oxw();e.xp6(12),e.Q6J("ngForOf",t.MV_consulta)}}let ae=(()=>{class s{constructor(t,i,n,o,a){this.fb=t,this.productorService=i,this.router=n,this.actived=o,this.ratesService=a,this.tablas=["EyE Reciclables","EyE No Reciclables","EyE Retornables / Reutilizables"],this.residuos=["Papel/Cart\xf3n","Metal","Pl\xe1stico","Madera","Envases compuestos"],this.maxFiles=9,this.isSubmited=!1,this.isEdited=!1,this.id_business="",this.year_statement=0,this.id_statement=null,this.detail=this.fb.group({precedence:[],hazard:[],recyclability:[1],type_residue:[1],value:[],amount:[]}),this.detailForm=[],this.headLastForm={},this.detailLastForm=[],this.rates=[],this.listMV=[{name:"Papel/Cart\xf3n",value:1},{name:"Metal",value:2},{name:"Pl\xe1stico",value:3}],this.fileCountByMaterial={1:0,2:0,3:0},this.MV_consulta=[],this.suscription=null,this.actived.queryParams.subscribe(l=>{this.id_business=l.id_business,this.year_statement=l.year})}ngOnDestroy(){this.suscription?.unsubscribe()}ngOnInit(){u().fire({title:"Cargando Datos",text:"Se est\xe1 recuperando datos",timerProgressBar:!0,showConfirmButton:!1}),u().showLoading(),this.ratesService.getCLP.subscribe({next:t=>{this.rates=t.data,this.getDraftStatement(),this.getValueStatementByYear()},error:t=>{u().close(),u().fire({title:"\xa1Ups!",icon:"error",text:"No se logr\xf3 obtener el valor de la UF",showConfirmButton:!0}),console.log(t)}}),this.userForm=this.fb.group({MV:["",d.kI.required],ARCHIVO:[null,[d.kI.required,this.fileTypeValidator,this.fileSizeValidator]]})}ngAfterViewChecked(){this.calculateDiff()}onFileSelected(t){const i=t.target;if(i&&i.files&&i.files.length>0){const n=i.files[0];this.fileName=n.name,this.fileBuffer=n,this.selectedFile=i.files[0];const o=["pdf","jpeg","jpg"],a=this.selectedFile.name.split(".").pop()?.toLowerCase()||"";o.includes(a)?n.size>1048576?(this.userForm.controls.ARCHIVO.setErrors({invalidFileSize:!0}),this.userForm.controls.ARCHIVO.markAsTouched()):(this.userForm.controls.ARCHIVO.setErrors(null),this.userForm.controls.ARCHIVO.markAsTouched()):(this.userForm.controls.ARCHIVO.setErrors({invalidFileType:!0}),this.userForm.controls.ARCHIVO.markAsTouched())}else this.selectedFile=null}reset(){this.userForm.reset(),this.userForm.patchValue({MV:"",ARCHIVO:""})}calculateDiff(){let o=0,a=0,l=0;for(let c=1;c<=5;c++){const m=parseFloat(document.getElementById(`actual_weight_1_${c}`).value.replace(",",".")),g=parseFloat(document.getElementById(`actual_weight_2_${c}`).value.replace(",",".")),h=parseFloat(document.getElementById(`actual_weight_3_${c}`).value.replace(",",".")),A=parseFloat(document.getElementById(`last_weight_1_${c}`).innerHTML.replace(",",".")),S=parseFloat(document.getElementById(`last_weight_2_${c}`).innerHTML.replace(",",".")),b=parseFloat(document.getElementById(`last_weight_3_${c}`).innerHTML.replace(",","."));let Z=(m-A)/A*100,N=(g-S)/S*100,w=(h-b)/b*100;0==A&&(Z=0),0==S&&(N=0),0==b&&(w=0),o+=parseFloat(document.getElementById(`actual_weight_1_${c}`).value.replace(",","."))||0,a+=parseFloat(document.getElementById(`actual_weight_2_${c}`).value.replace(",","."))||0,l+=parseFloat(document.getElementById(`actual_weight_3_${c}`).value.replace(",","."))||0,document.getElementById(`actual_dif_1_${c}`).value=`${0==A?0:Z.toFixed(0)||0}%`,document.getElementById(`actual_dif_2_${c}`).value=`${0==S?0:N.toFixed(0)||0}%`,document.getElementById(`actual_dif_3_${c}`).value=`${0==b?0:w.toFixed(0)||0}%`}document.getElementById("total_amount_1").innerHTML=(0).toFixed(2).replace(".",","),document.getElementById("total_amount_2").innerHTML=(0).toFixed(2).replace(".",","),document.getElementById("total_amount_3").innerHTML=(0).toFixed(2).replace(".",","),document.getElementById("total_weight_1").innerHTML=o.toFixed(2).replace(".",","),document.getElementById("total_weight_2").innerHTML=a.toFixed(2).replace(".",","),document.getElementById("total_weight_3").innerHTML=l.toFixed(2).replace(".",",")}getDraftStatement(){this.detailForm=[],this.suscription=this.productorService.getValueStatementByYear(this.id_business,this.year_statement,1).subscribe({next:t=>{if(t.status){t.data.header.STATE&&this.router.navigate(["/productor/home"]),this.id_statement=t.data.header.ID,sessionStorage.setItem("isEdited","true"),sessionStorage.setItem("id_statement",this.id_statement?.toString()||"null");for(let i=0;i<t.data.detail.length;i++){const n=t.data.detail[i];document.getElementById(`inp_${n?.RECYCLABILITY}_${n?.TYPE_RESIDUE}_${n?.PRECEDENCE}_${n?.HAZARD}`).value="0"}for(let i=0;i<t.data.detail.length;i++){const n=t.data.detail[i],o=this.toLowerKeys(n);if(0==n?.VALUE)continue;document.getElementById(`inp_${n?.RECYCLABILITY}_${n?.TYPE_RESIDUE}_${n?.PRECEDENCE}_${n?.HAZARD}`).value=n?.VALUE.toString().replace(".",",");const a=(parseFloat(document.getElementById(`actual_weight_${n?.RECYCLABILITY}_${n?.TYPE_RESIDUE}`).value.replace(",","."))||0)+parseFloat(n?.VALUE);let l=0;l=1==n.RECYCLABILITY&&n.TYPE_RESIDUE<=3?n?.VALUE*this.rates[n.TYPE_RESIDUE-1].price:2==n.RECYCLABILITY&&(n.TYPE_RESIDUE<=3||5==n.TYPE_RESIDUE)?n?.VALUE*this.rates[3].price:0,o.amount=l,this.detailForm.push(o),document.getElementById(`actual_weight_${n?.RECYCLABILITY}_${n?.TYPE_RESIDUE}`).value=a.toFixed(2).replace(".",",")}sessionStorage.setItem("detailForm",JSON.stringify(this.detailForm))}this.loadMV()},error:t=>{u().close(),u().fire({icon:"error",text:t.msg,title:"\xa1Ups!"})}})}toLowerKeys(t){const i=Object.entries(t);return Object.fromEntries(i.map(([n,o])=>[n.toLowerCase(),o]))}updateValue(t,i,n,o,a){sessionStorage.setItem("isEdited","true");let l,c=0,m=0;/^[0-9]+(,[0-9]+)?$/.test(a.value)||(a.value=0);let h=parseFloat(a.value.replace(",","."));(!a.value||isNaN(h)||h<0)&&(h=0,a.value=0);for(let b=0;b<this.detailForm.length;b++){const Z=this.detailForm[b];Z.type_residue==i&&Z.recyclability==t&&(c+=parseFloat(Z.value||0)),Z.type_residue==i&&Z.precedence==n&&Z.hazard==o&&Z.recyclability==t&&(l=Z)}if(0==this.detailForm.length&&(c=0),l){const b=this.detailForm.indexOf(l);c-={...this.detailForm[b]}.value,this.detailForm[b].value=h,c+=parseFloat(this.detailForm[b].value),m=1==t&&i<=3?h*this.rates[i-1].price:2==t&&(i<=3||5==i)?h*this.rates[3].price:0,this.detailForm[b].amount=m}else c+=h,m=1==t&&i<=3?h*this.rates[i-1].price:2==t&&(i<=3||5==i)?h*this.rates[3].price:0,this.detailForm.push({precedence:n,hazard:o,value:h,type_residue:i,amount:m,recyclability:t});m=1==t&&i<=3?(this.rates[i-1].price*c).toString():2==t&&(i<=3||5==i)?(this.rates[3].price*c).toString():"0",sessionStorage.setItem("detailForm",JSON.stringify(this.detailForm)),document.getElementById(`actual_weight_${t}_${i}`).value=`${c.toFixed(2).replace(".",",")}`;const S=c-parseFloat(document.getElementById(`last_weight_${t}_${i}`).innerHTML.replace(",","."));document.getElementById(`actual_dif_${t}_${i}`).value=`${S==1/0?100:S.toFixed(2).replace(".",",")||0} `,this.calculateDiff()}getValueStatementByYear(){this.productorService.getValueStatementByYear(this.id_business,this.year_statement-1,0).subscribe({next:i=>{i.status||(u().close(),u().fire({title:"Tuvimos problemas",text:i.msg,icon:"error"}).then(n=>{n.isConfirmed&&this.router.navigate(["/productor/home"])})),this.detailLastForm=i.data.detail,sessionStorage.setItem("detailLastForm",JSON.stringify(this.detailLastForm)||'""'),this.headLastForm=i.data.health,u().close(),this.detailLastForm?.forEach(n=>{document.getElementById(`inp_l_${n?.RECYCLABILITY}_${n?.TYPE_RESIDUE}_${n?.PRECEDENCE}_${n?.HAZARD}`).innerHTML=n?.VALUE.toFixed(2).replace(".",",");const o=(parseFloat(document.getElementById(`last_weight_${n?.RECYCLABILITY}_${n?.TYPE_RESIDUE}`).innerHTML.replace(",","."))||0)+parseFloat(n?.VALUE);document.getElementById(`last_weight_${n?.RECYCLABILITY}_${n.TYPE_RESIDUE}`).innerHTML=o.toFixed(2).replace(".",",")})},error:i=>{u().close(),u().fire({icon:"error",text:i.msg,title:"\xa1Ups!"})}})}fileTypeValidator(t){const i=t.value;return i&&!["application/pdf","image/jpeg"].includes(i.type)?{invalidFileType:!0}:null}fileSizeValidator(t){const i=t.value;return i&&i.size>1048576?{invalidFileSize:!0}:null}saveFile(){var t=this;return(0,U.Z)(function*(){const i=t.userForm.get("MV").value;if(t.fileCountByMaterial[i]>=3)return void u().fire({icon:"error",title:"L\xedmite Alcanzado",text:"No puedes subir m\xe1s de 3 archivos para el tipo de material seleccionado."});const n=sessionStorage.getItem("detailForm");if(JSON.parse(n||"[]").some(l=>3===l.recyclability&&l.type_residue===parseInt(i)&&0!==l.value))if(null==t.id_statement){u().fire({title:"Guardando Datos",text:"Se est\xe1n guardando datos",timerProgressBar:!0,showConfirmButton:!1}),u().showLoading();const l={id_business:t.id_business,year_statement:t.year_statement,state:!1,id_statement:t.id_statement},c=sessionStorage.getItem("detailForm"),m=JSON.parse(c||"[]");0==m.length&&m.push({precedence:1,hazard:1,recyclability:1,type_residue:1,value:0,amount:0}),sessionStorage.setItem("saving","true");const g=yield t.productorService.saveForm({header:l,detail:m}).toPromise();g.status&&(sessionStorage.setItem("id_statement",g.data),t.id_statement=g.data,u().close()),sessionStorage.removeItem("isEdited"),sessionStorage.removeItem("saving"),t.productorService.saveFile(t.id_statement,t.fileName,t.fileBuffer,i).subscribe(h=>{h.status&&(u().fire({icon:"success",text:"Medio de verificaci\xf3n guardado satisfactoriamente"}),t.loadMV())}),t.fileCountByMaterial[i]++}else t.productorService.saveFile(t.id_statement,t.fileName,t.fileBuffer,i).subscribe(l=>{l.status&&(u().fire({icon:"success",text:"Medio de verificaci\xf3n guardado satisfactoriamente"}),t.loadMV())});else u().fire({icon:"warning",title:"Advertencia",text:"El material no tiene valores ingresados."})})()}deleteMV(t){this.productorService.deleteById(t).subscribe(i=>{i.status&&(u().fire({icon:"info",text:"Medio de verificaci\xf3n eliminado satisfactoriamente"}),this.loadMV())})}loadMV(){this.productorService.getMV(this.id_statement).subscribe(t=>{t.status&&(this.MV_consulta=t.data.header,this.fileCountByMaterial={1:0,2:0,3:0},this.MV_consulta.forEach(i=>{this.fileCountByMaterial.hasOwnProperty(i.TYPE_MATERIAL)&&this.fileCountByMaterial[i.TYPE_MATERIAL]++}),sessionStorage.setItem("hasMV_PapelCarton",this.fileCountByMaterial[1]>0?"true":"false"),sessionStorage.setItem("hasMV_Metal",this.fileCountByMaterial[2]>0?"true":"false"),sessionStorage.setItem("hasMV_Plastico",this.fileCountByMaterial[3]>0?"true":"false"))})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(d.qu),e.Y36(T.u),e.Y36(f.F0),e.Y36(f.gz),e.Y36(v.z))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-form-statement"]],decls:43,vars:8,consts:[["class","table-responsive mb-4",4,"ngFor","ngForOf"],["type","button","data-bs-toggle","modal","data-bs-target","#exampleModal",1,"btn","btn-primary"],["id","exampleModal","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade",3,"hidden.bs.modal"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","exampleModalLabel",1,"modal-title","fs-5"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"container"],[3,"formGroup"],["miFormulario","ngForm"],[1,"row"],[1,"col-md-6"],["for","inp_nom"],["formControlName","MV","id","inp_mv","required","",1,"form-select"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","text-danger pl-0",4,"ngIf"],["for","inp_archivo"],["type","file","formControlName","ARCHIVO","id","inp_archivo","accept","application/pdf, image/jpeg","required","",1,"form-control",3,"change"],["class","text-danger mt-2 text-end",4,"ngIf"],[1,"modal-footer"],["type","button","id","btnCloseModal","data-bs-dismiss","modal",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[2,"visibility","hidden"],[4,"ngIf"],[1,"table-responsive","mb-4"],[1,"table","table-even","table-section","table-borderless","table-align-middle","table-border","table-radius","table-statement"],["colspan","13"],[1,"text-center","fw-bold","bg-green-light"],["width","16%","rowspan","2",1,"text-start","bg-green","color-white",2,"font-size","18px"],["colspan","2"],[1,"text-center","bg-green-light-2"],["width","7%",1,"color-red"],["width","7%"],["class","text-end",4,"ngFor","ngForOf"],["colspan","10"],[2,"display","none",3,"id"],[1,"d-flex","justify-content-between"],[3,"id"],[1,"text-end"],[3,"ngIf"],[1,"bg-grey-light",3,"id"],["value","0","type","text","min","0",1,"form-control",3,"id","change"],["value","0","type","text","min","0",1,"form-control","form-control-sm",3,"id","change"],["value","0","readonly","","type","text",2,"border","none","background-color","transparent","text-align","center",3,"id"],[1,"bg-grey-light",2,"display","none",3,"id"],["value","0","readonly","",2,"border","none","background-color","transparent","text-align","center","font-weight","bold",3,"id"],[2,"display","none"],["value","0","readonly","","type","text",1,"form-control","form-control-sm",3,"id"],[3,"value"],[1,"text-danger","pl-0"],[1,"text-danger","mt-2","text-end"],[2,"height","50px"],[1,"table-container","table","table-even","table-section","table-borderless","table-border","table-radius","d-lg-table"],[1,"text-center","w-100"],["class","text-center w-100",4,"ngFor","ngForOf"],[1,"file-link"],["type","button",1,"btn","btn-danger","btn-sm","rounded-pill",3,"click"]],template:function(t,i){if(1&t&&(e.YNc(0,z,52,17,"div",0),e.TgZ(1,"button",1),e._uU(2,"Agregar Medios de Verificaci\xf3n para Retornables/Reutilizables"),e.qZA(),e._UZ(3,"p"),e.TgZ(4,"p")(5,"strong"),e._uU(6,"Si ingresa materiales Retornables/Reutilizables, con excepci\xf3n de Madera, debe adjuntar medios de verificaci\xf3n o de lo contrario se aplicar\xe1n las tarifas de EyE Reciclables."),e.qZA()(),e.TgZ(7,"div",2),e.NdJ("hidden.bs.modal",function(){return i.reset()}),e.TgZ(8,"div",3)(9,"div",4)(10,"div",5)(11,"h1",6),e._uU(12,"Medios de Verificaci\xf3n"),e.qZA(),e._UZ(13,"button",7),e.qZA(),e.TgZ(14,"div",8)(15,"div",9)(16,"form",10,11)(18,"div",12)(19,"div",13)(20,"label",14),e._uU(21,"Tipo MV"),e.qZA(),e.TgZ(22,"select",15)(23,"option",16),e._uU(24,"Selecciona MV"),e.qZA(),e.YNc(25,K,2,2,"option",17),e.qZA(),e.YNc(26,W,2,1,"div",18),e.qZA(),e.TgZ(27,"div",13)(28,"label",19),e._uU(29,"Archivo"),e.qZA(),e.TgZ(30,"input",20),e.NdJ("change",function(o){return i.onFileSelected(o)}),e.qZA(),e.YNc(31,ie,3,2,"div",18),e.qZA()(),e.YNc(32,ne,2,0,"div",21),e.TgZ(33,"div",22)(34,"button",23),e.NdJ("click",function(){return i.reset()}),e._uU(35,"Cerrar"),e.qZA(),e.TgZ(36,"button",24),e.NdJ("click",function(){return i.saveFile(),i.reset()}),e._uU(37,"Agregar"),e.qZA()(),e.TgZ(38,"div",25),e._uU(39,"a"),e.qZA(),e.TgZ(40,"div",25),e._uU(41,"a"),e.qZA(),e.YNc(42,se,13,1,"div",26),e.qZA()()()()()()),2&t){const n=e.MAs(17);e.Q6J("ngForOf",i.tablas),e.xp6(16),e.Q6J("formGroup",i.userForm),e.xp6(9),e.Q6J("ngForOf",i.listMV),e.xp6(1),e.Q6J("ngIf",i.userForm.controls.MV.errors&&i.userForm.controls.MV.touched),e.xp6(5),e.Q6J("ngIf",i.userForm.controls.ARCHIVO.errors&&i.userForm.controls.ARCHIVO.touched),e.xp6(1),e.Q6J("ngIf",i.MV_consulta.length>=i.maxFiles),e.xp6(4),e.Q6J("disabled",n.invalid||i.MV_consulta.length>=i.maxFiles),e.xp6(6),e.Q6J("ngIf",i.MV_consulta&&i.MV_consulta.length>0)}},dependencies:[p.sg,p.O5,d._Y,d.YN,d.Kr,d.Fj,d.EJ,d.JJ,d.JL,d.Q7,d.sg,d.u],styles:[".table-statement[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:last-child{border-radius:20px 20px 0 0!important}"]}),s})();function re(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"tr")(1,"td",25)(2,"button",26),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.validate())}),e._uU(3,"Validar"),e.qZA()()()}}function le(s,r){1&s&&(e.TgZ(0,"h2",27),e._uU(1,"Cargar orden de compra "),e.qZA())}function ue(s,r){1&s&&(e.TgZ(0,"p"),e._uU(1," El formato del archivo debe ser PDF. "),e.qZA())}function ce(s,r){1&s&&(e.TgZ(0,"p"),e._uU(1," El tama\xf1o del archivo no debe superar 1 MB. "),e.qZA())}function de(s,r){if(1&s&&(e.TgZ(0,"div",35),e.YNc(1,ue,2,0,"p",22),e.YNc(2,ce,2,0,"p",22),e.qZA()),2&s){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",t.userForm.controls.ARCHIVO.errors.invalidFileType),e.xp6(1),e.Q6J("ngIf",t.userForm.controls.ARCHIVO.errors.invalidFileSize)}}function me(s,r){if(1&s&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&s){const t=e.oxw(2);e.xp6(1),e.hij(" Quedan ",t.remaining," d\xedas para ingresar la OC ")}}function _e(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"div")(1,"div",28)(2,"form",29)(3,"input",30),e.NdJ("change",function(n){e.CHM(t);const o=e.oxw();return e.KtG(o.onFileSelected(n))}),e.qZA(),e.YNc(4,de,3,2,"div",31),e.YNc(5,me,2,1,"div",22),e.TgZ(6,"div",32)(7,"a",33),e._uU(8,"Volver a inicio"),e.qZA(),e.TgZ(9,"button",34),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.uploadDeclaration())}),e._uU(10,"Enviar declaraci\xf3n"),e.qZA()()()()()}if(2&s){const t=e.oxw();e.xp6(2),e.Q6J("formGroup",t.userForm),e.xp6(2),e.Q6J("ngIf",t.userForm.controls.ARCHIVO.errors&&t.userForm.controls.ARCHIVO.touched),e.xp6(1),e.Q6J("ngIf",t.isValidated),e.xp6(4),e.Q6J("disabled",!t.userForm.controls.ARCHIVO.valid)}}let pe=(()=>{class s{constructor(t,i,n,o,a,l){this.businessService=t,this.productorService=i,this.rateService=n,this.actived=o,this.router=a,this.fb=l,this.year_statement=0,this.isValidated=!1,this.fileName="",this.selectedFile=null,this.isButtonVisible=!0,this.id_business="",this.name_business="",this.rut="",this.loc_address="",this.phone="",this.email="",this.am_first_name="",this.am_last_name="",this.giro="",this.invoice_name="",this.invoice_email="",this.invoice_phone="",this.amount_current_year=0,this.amount_previous_year=0,this.uf=0,this.totalCLP="",this.porcentajeDiff="",this.remaining=-1,this.actived.queryParams.subscribe(c=>{this.id_business=c.id_business,this.year_statement=c.year})}ngOnInit(){this.isValidated=!1,this.isButtonVisible=!0,this.getResume(),this.getUf(),this.getBusiness(),this.userForm=this.fb.group({ARCHIVO:[null,[d.kI.required,this.fileTypeValidator,this.fileSizeValidator]]})}ngOnDestroy(){sessionStorage.removeItem("state")}getUf(){this.rateService.getUF.subscribe(t=>{this.uf=t.data})}getBusiness(){this.businessService.getBusiness(this.id_business).subscribe({next:t=>{t.status&&(this.name_business=t.status[0].NAME,this.rut=t.status[0].VAT,this.loc_address=t.status[0].LOC_ADDRESS,this.phone=t.status[0].PHONE,this.email=t.status[0].EMAIL,this.am_first_name=t.status[0].AM_FIRST_NAME,this.am_last_name=t.status[0].AM_LAST_NAME,this.invoice_name=t.status[0].INVOICE_NAME,this.invoice_email=t.status[0].INVOICE_EMAIL,this.invoice_phone=t.status[0].INVOICE_PHONE,this.giro=t.status[0].GIRO)},error:t=>{u().close(),u().fire({icon:"error",text:t.msg,title:"\xa1Ups!"})}})}getResume(){this.actived.queryParams.subscribe(t=>{let i=t.year,n=t.id_business;u().fire({title:"Cargando datos...",allowOutsideClick:!1}),u().showLoading(),this.productorService.getResumeById(n,i).subscribe({next:o=>{this.resume=o,this.remaining=o.remaining,sessionStorage.setItem("state",this.resume.state),u().close(),2==this.resume.state&&(this.isValidated=!0,this.isButtonVisible=!1);let a=this.parseMoney_two(this.resume?.neto);const l=(parseFloat(a.toString())/this.uf).toFixed(2),c=sessionStorage.getItem("id_statement");null!==l&&c&&this.productorService.updateUFStatement(c,l).subscribe()},error:o=>{u().close(),u().fire({icon:"error",text:o.msg,title:"\xa1Ups!"}).then(a=>{a.isConfirmed&&this.router.navigate(["/productor"])})}})})}parseMoney_two(t){return t?parseInt(t.replace(/\D/g,""),10):0}validate(){var t=this;return(0,U.Z)(function*(){if((yield u().fire({title:"Confirmaci\xf3n",html:'<div style="text-align: justify; font-size: 0.8em;">Est\xe1 a punto de validar la declaraci\xf3n, a partir de este momento no va a poder cambiar los valores ingresados y el valor de la declaraci\xf3n quedar\xe1 fijado a la UF del d\xeda de hoy. Tiene un plazo de 7 d\xedas para subir la Orden de Compra en el campo que se habilitar\xe1 al cerrar este mensaje. Pasado este plazo, la declaraci\xf3n volver\xe1 a estado borrador y se recalcular\xe1 el valor de la UF.</div>',icon:"warning",showCancelButton:!0,confirmButtonText:"Aceptar",cancelButtonText:"Cancelar",reverseButtons:!0})).isConfirmed){const n=sessionStorage.getItem("id_statement");if(!n)return;t.productorService.validateStatement(n).subscribe({next:o=>{o.status&&(t.isValidated=!0,t.isButtonVisible=!1,sessionStorage.setItem("state","2"))},error:o=>{u().close(),u().fire({icon:"error",text:o.msg,title:"\xa1Ups!"})}})}})()}onFileSelected(t){const i=t.target;if(i&&i.files&&i.files.length>0){const n=i.files[0];this.fileName=n.name,this.fileBuffer=n,this.selectedFile=i.files[0];const o=["pdf"],a=this.selectedFile.name.split(".").pop()?.toLowerCase()||"";o.includes(a)?n.size>1048576?(this.userForm.controls.ARCHIVO.setErrors({invalidFileSize:!0}),this.userForm.controls.ARCHIVO.markAsTouched()):(this.userForm.controls.ARCHIVO.setErrors(null),this.userForm.controls.ARCHIVO.markAsTouched()):(this.userForm.controls.ARCHIVO.setErrors({invalidFileType:!0}),this.userForm.controls.ARCHIVO.markAsTouched())}else this.selectedFile=null}fileTypeValidator(t){const i=t.value;return i&&!["application/pdf","image/jpeg"].includes(i.type)?{invalidFileType:!0}:null}fileSizeValidator(t){const i=t.value;return i&&i.size>1048576?{invalidFileSize:!0}:null}uploadDeclaration(){this.userForm.get("ARCHIVO");const i=document.getElementById("inp_archivo").files,n=sessionStorage.getItem("id_statement");!n||(u().fire({title:"Subiendo archivo",text:"Espere mientras se sube el archivo...",showCancelButton:!1,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>{u().showLoading()}}),this.productorService.uploadOC(n,i).subscribe({next:o=>{u().close(),u().fire({icon:"success",title:"Archivo subido exitosamente",text:"La declaraci\xf3n se ha enviado correctamente.",showConfirmButton:!0}).then(()=>{window.location.href="/#"})},error:o=>{u().close(),u().fire({icon:"error",title:"Error al subir el archivo",text:"Ha ocurrido un error al subir la declaraci\xf3n. Por favor, int\xe9ntelo nuevamente.",showConfirmButton:!0})}}))}getTotalEyE(){return(parseFloat(this.resume?.metal.replace(",","."))+parseFloat(this.resume?.papel.replace(",","."))+parseFloat(this.resume?.plastico.replace(",","."))+parseFloat(this.resume?.no_reciclable.replace(",","."))||0).toFixed(2).replace(".",",")}getNeto(){return this.formatMoney(this.resume?.neto)}getIVA(){return this.formatMoney(this.resume?.iva)}getTotalFacturado(){let t=this.parseMoney(this.getNeto()),i=this.parseMoney(this.getIVA());return this.formatMoney((t+i).toFixed(0))}parseMoney(t){let i=t.replace(/\./g,"");return i=i.replace(",","."),parseFloat(i)}formatMoney(t){return parseFloat(t).toFixed(0).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")}formatNumber(t){if(!t)return"";const i=t.split(",");return i[0]=i[0].replace(/\B(?=(\d{3})+(?!\d))/g,"."),i.join(",")}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(y.m),e.Y36(T.u),e.Y36(v.z),e.Y36(f.gz),e.Y36(f.F0),e.Y36(d.qu))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-send-statement"]],decls:222,vars:18,consts:[["id","content",1,"w-100"],[1,"consulta-declaracion"],[1,"row"],[1,"col-12","col-lg-6","col-xl-4","d-flex"],[1,"box","box-semiradius","box-semiradius-secondary","box-header","mb-4","w-100"],[1,"box-header-h1"],[1,"list","list-data","list-data-tit-text-col","list-unstyled"],[1,"list-data__title"],["aria-hidden","true",1,"fa","fa-building","fa-fw","fa-lg"],[1,"list-data__text","flex-grow-1","ps-0"],["aria-hidden","true",1,"fa","fa-map-marker","fa-fw","fa-lg"],["aria-hidden","true",1,"fa","fa-envelope","fa-fw","fa-lg"],["aria-hidden","true",1,"fa","fa-user","fa-fw","fa-lg"],[1,"box-header-h1",2,"border-radius","1px"],["aria-hidden","true",1,"fa","fa-phone","fa-fw","fa-lg"],[2,"display","flex","justify-content","center"],[1,"table","table-even","table-section","table-borderless","table-align-middle","d-lg-table","table-statement"],["colspan","2",1,"box-header-h1",2,"text-align","center"],[1,"columna1"],[1,"columna2"],[2,"display","flex","justify-content","center","margin-top","25px"],["colspan","2",1,"box-header-h1",2,"border-radius","1px","text-align","center"],[4,"ngIf"],["class","box-header-h1","style","border-radius: 1px;margin-top: 7px;text-align: center;",4,"ngIf"],[1,"d-flex"],["colspan","2",2,"text-align","right"],[1,"btn","btn-primary",2,"width","150px",3,"click"],[1,"box-header-h1",2,"border-radius","1px","margin-top","7px","text-align","center"],[1,"mt-3",2,"margin","10px"],[3,"formGroup"],["type","file","formControlName","ARCHIVO","id","inp_archivo","accept","application/pdf","required","",1,"form-control",3,"change"],["class","text-danger pl-0",4,"ngIf"],[1,"button-container","mt-3",2,"display","flex","justify-content","space-between"],["href","#",1,"btn","btn-primary"],[1,"btn","btn-primary",3,"disabled","click"],[1,"text-danger","pl-0"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"section",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h2",5),e._uU(6,"Informaci\xf3n ProREP"),e.qZA(),e.TgZ(7,"ul",6)(8,"li")(9,"span",7),e._UZ(10,"i",8),e.qZA(),e.TgZ(11,"span",9)(12,"strong"),e._uU(13,"Nombre SG:"),e.qZA(),e._UZ(14,"br"),e._uU(15,"Corporaci\xf3n PROREP para la Gesti\xf3n de Residuos "),e.qZA()(),e.TgZ(16,"li")(17,"span",7),e._UZ(18,"i",8),e.qZA(),e.TgZ(19,"span",9)(20,"strong"),e._uU(21,"Rut:"),e.qZA(),e._UZ(22,"br"),e._uU(23,"65.216.268-1 "),e.qZA()(),e.TgZ(24,"li")(25,"span",7),e._UZ(26,"i",10),e.qZA(),e.TgZ(27,"span",9)(28,"strong"),e._uU(29,"Direcci\xf3n:"),e.qZA(),e._UZ(30,"br"),e._uU(31,"Avda. Andr\xe9s Bello 2777, of. 506, Las Condes, Santiago "),e.qZA()(),e.TgZ(32,"li")(33,"span",7),e._UZ(34,"i",8),e.qZA(),e.TgZ(35,"span",9)(36,"strong"),e._uU(37,"Giro:"),e.qZA(),e._UZ(38,"br"),e._uU(39,"Gesti\xf3n de Residuos de Envases y Embalajes no Domiciliarios "),e.qZA()(),e.TgZ(40,"li")(41,"span",7),e._UZ(42,"i",11),e.qZA(),e.TgZ(43,"span",9)(44,"strong"),e._uU(45,"Correo:"),e.qZA(),e._UZ(46,"br"),e._uU(47,"admin@prorep.cl "),e.qZA()(),e.TgZ(48,"li")(49,"span",7),e._UZ(50,"i",8),e.qZA(),e.TgZ(51,"span",9)(52,"strong"),e._uU(53,"Asunto:"),e.qZA(),e._UZ(54,"br"),e._uU(55,"Pago cumplimiento Ley REP y nombre del socio "),e.qZA()(),e.TgZ(56,"li")(57,"span",7),e._UZ(58,"i",12),e.qZA(),e.TgZ(59,"span",9)(60,"strong"),e._uU(61,"Encargado de facturaci\xf3n:"),e.qZA(),e._UZ(62,"br"),e._uU(63,"Lucas Bustos Juri "),e.qZA()(),e.TgZ(64,"li")(65,"span",7),e._UZ(66,"i",8),e.qZA(),e.TgZ(67,"span",9)(68,"strong"),e._uU(69,"Banco:"),e.qZA(),e._UZ(70,"br"),e._uU(71,"Santander "),e.qZA()(),e.TgZ(72,"li")(73,"span",7),e._UZ(74,"i",8),e.qZA(),e.TgZ(75,"span",9)(76,"strong"),e._uU(77,"Cuenta Corriente"),e.qZA(),e._UZ(78,"br"),e._uU(79,"89412617 "),e.qZA()()()()(),e.TgZ(80,"div",3)(81,"div",4)(82,"h2",5),e._uU(83,"Informaci\xf3n para Facturaci\xf3n"),e.qZA(),e.TgZ(84,"ul",6)(85,"li")(86,"span",7),e._UZ(87,"i",8),e.qZA(),e.TgZ(88,"span",9)(89,"strong"),e._uU(90,"Nombre Empresa:"),e.qZA(),e._UZ(91,"br"),e._uU(92),e.qZA()(),e.TgZ(93,"li")(94,"span",7),e._UZ(95,"i",8),e.qZA(),e.TgZ(96,"span",9)(97,"strong"),e._uU(98,"Rut:"),e.qZA(),e._UZ(99,"br"),e._uU(100),e.qZA()(),e.TgZ(101,"li")(102,"span",7),e._UZ(103,"i",8),e.qZA(),e.TgZ(104,"span",9)(105,"strong"),e._uU(106,"Giro:"),e.qZA(),e._UZ(107,"br"),e._uU(108),e.qZA()(),e.TgZ(109,"li")(110,"span",7),e._UZ(111,"i",10),e.qZA(),e.TgZ(112,"span",9)(113,"strong"),e._uU(114,"Direcci\xf3n:"),e.qZA(),e._UZ(115,"br"),e._uU(116),e._UZ(117,"br"),e.qZA()()(),e.TgZ(118,"h6",13),e._uU(119,"Contraparte Finanzas"),e.qZA(),e.TgZ(120,"ul",6)(121,"li")(122,"span",7),e._UZ(123,"i",12),e.qZA(),e.TgZ(124,"span",9)(125,"strong"),e._uU(126,"Nombre:"),e.qZA(),e._UZ(127,"br"),e._uU(128),e.qZA()(),e.TgZ(129,"li")(130,"span",7),e._UZ(131,"i",11),e.qZA(),e.TgZ(132,"span",9)(133,"strong"),e._uU(134,"Correo:"),e.qZA(),e._UZ(135,"br"),e._uU(136),e.qZA()(),e.TgZ(137,"li")(138,"span",7),e._UZ(139,"i",14),e.qZA(),e.TgZ(140,"span",9)(141,"strong"),e._uU(142,"Tel\xe9fono:"),e.qZA(),e._UZ(143,"br"),e._uU(144),e.qZA()()()()(),e.TgZ(145,"div",3)(146,"div",4)(147,"div",15)(148,"table",16)(149,"thead",5)(150,"tr",5)(151,"th",17),e._uU(152,"Total EyE (ton)"),e.qZA()()(),e.TgZ(153,"tbody")(154,"tr")(155,"td",18)(156,"strong"),e._uU(157,"Papel/cart\xf3n Reciclable"),e.qZA()(),e.TgZ(158,"td",19)(159,"strong"),e._uU(160),e.qZA()()(),e.TgZ(161,"tr")(162,"td",18)(163,"strong"),e._uU(164,"Metal Reciclable"),e.qZA()(),e.TgZ(165,"td",19)(166,"strong"),e._uU(167),e.qZA()()(),e.TgZ(168,"tr")(169,"td",18)(170,"strong"),e._uU(171,"Pl\xe1stico Reciclable"),e.qZA()(),e.TgZ(172,"td",19)(173,"strong"),e._uU(174),e.qZA()()(),e.TgZ(175,"tr")(176,"td",18)(177,"strong"),e._uU(178,"No Reciclables"),e.qZA()(),e.TgZ(179,"td",19)(180,"strong"),e._uU(181),e.qZA()()(),e.TgZ(182,"tr")(183,"td",18)(184,"strong"),e._uU(185,"Total EyE"),e.qZA()(),e.TgZ(186,"td",19)(187,"strong"),e._uU(188),e.qZA()()()()()(),e.TgZ(189,"div",20)(190,"table",16)(191,"thead",5)(192,"tr",5)(193,"th",21),e._uU(194,"Total Facturado (CLP)"),e.qZA()()(),e.TgZ(195,"tbody")(196,"tr")(197,"td",18)(198,"strong"),e._uU(199,"Monto Neto"),e.qZA()(),e.TgZ(200,"td",19)(201,"strong"),e._uU(202),e.qZA()()(),e.TgZ(203,"tr")(204,"td",18)(205,"strong"),e._uU(206,"Monto I.V.A"),e.qZA()(),e.TgZ(207,"td",19)(208,"strong"),e._uU(209),e.qZA()()(),e.TgZ(210,"tr")(211,"td",18)(212,"strong"),e._uU(213,"Monto Total"),e.qZA()(),e.TgZ(214,"td",19)(215,"strong"),e._uU(216),e.qZA()()(),e.YNc(217,re,4,0,"tr",22),e.qZA()()(),e.YNc(218,le,2,0,"h2",23),e.YNc(219,_e,11,4,"div",22),e.qZA()(),e.TgZ(220,"div",24),e._uU(221," En caso de que la informaci\xf3n se\xf1alada est\xe9 err\xf3nea o desactualizada por favor contactarse al correo de soporte de plataforma ProREP: soporte@prorep.cl "),e.qZA()()()()),2&t&&(e.xp6(92),e.hij("",i.name_business," "),e.xp6(8),e.hij("",i.rut," "),e.xp6(8),e.hij("",i.giro," "),e.xp6(8),e.Oqu(i.loc_address),e.xp6(12),e.hij("",i.invoice_name," "),e.xp6(8),e.hij("",i.invoice_email," "),e.xp6(8),e.hij("",i.invoice_phone," "),e.xp6(16),e.Oqu(i.formatNumber(null==i.resume?null:i.resume.papel)),e.xp6(7),e.Oqu(i.formatNumber(null==i.resume?null:i.resume.metal)),e.xp6(7),e.Oqu(i.formatNumber(null==i.resume?null:i.resume.plastico)),e.xp6(7),e.Oqu(i.formatNumber(null==i.resume?null:i.resume.no_reciclable)),e.xp6(7),e.Oqu(i.formatNumber(i.getTotalEyE())),e.xp6(14),e.Oqu(null==i.resume?null:i.resume.neto),e.xp6(7),e.Oqu(null==i.resume?null:i.resume.iva),e.xp6(7),e.Oqu(null==i.resume?null:i.resume.total),e.xp6(1),e.Q6J("ngIf",i.isButtonVisible),e.xp6(1),e.Q6J("ngIf",i.isValidated),e.xp6(1),e.Q6J("ngIf",i.isValidated))},dependencies:[p.O5,d._Y,d.Fj,d.JJ,d.JL,d.Q7,d.sg,d.u],styles:[".btn-link[_ngcontent-%COMP%]{color:#777;text-decoration:underline;cursor:pointer;background:none;border:none;padding:0;font:inherit}.columna1[_ngcontent-%COMP%]{width:200px}.columna2[_ngcontent-%COMP%]{width:100px;text-align:right}"]}),s})();function ge(s,r){if(1&s&&(e.TgZ(0,"p",12),e._uU(1),e.ALo(2,"date"),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.hij("Borrador guardado a las: ",e.xi3(2,1,t.hour,"HH:mm:ss"),"")}}function he(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"button",16),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.changeStep(-1))}),e._uU(1,"Atr\xe1s"),e.qZA()}if(2&s){const t=e.oxw();e.Q6J("disabled",t._saving||t.disableBackButton)}}function fe(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"button",17),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.changeStep(1))}),e._uU(1,"Siguiente"),e.qZA()}}function be(s,r){1&s&&e._UZ(0,"app-form-statement")}function Ze(s,r){1&s&&e._UZ(0,"app-summary-statement")}function Te(s,r){1&s&&e._UZ(0,"app-send-statement")}const x=function(s){return{active:s}};let Se=(()=>{class s{constructor(t,i,n,o,a){this.fb=t,this.productorService=i,this.businessService=n,this.router=o,this.actived=a,this.tablas=["Reciclable","No Reciclable","Retornables / Reutilizados"],this.residuos=["Papel Cart\xf3n","Metal","Pl\xe1stico","Madera**","Envases compuestos"],this.position=1,this.hour=null,this.disableBackButton=!1,this.state=0,this.sessionCheck=null,this.isSubmited=!1,this.isEdited=!1,this._saving=!1,this.id_business=0,this.name_business="",this.rut_business="",this.year_statement=0,this.id_statement=null,this.detailForm=[],this.actived.queryParams.subscribe(l=>{this.id_business=l.id_business,this.year_statement=l.year}),this.getNameBusiness()}ngOnDestroy(){this.isSubmited||this.saveDraft(),sessionStorage.removeItem("id_statement"),sessionStorage.removeItem("detailForm"),sessionStorage.removeItem("saving"),sessionStorage.removeItem("detailLastForm"),sessionStorage.removeItem("hasMV_PapelCarton"),sessionStorage.removeItem("hasMV_Metal"),sessionStorage.removeItem("hasMV_Plastico"),sessionStorage.removeItem("uf_anual"),null!==this.sessionCheck&&this.sessionCheck.unsubscribe()}ngOnInit(){sessionStorage.getItem("state")&&"2"==sessionStorage.getItem("state")&&(this.position=3),this.sessionCheck=function D(s=0,r=C.z){return s<0&&(s=0),function R(s=0,r,t=C.P){let i=-1;return null!=r&&((0,O.K)(r)?t=r:i=r),new B.y(n=>{let o=function P(s){return s instanceof Date&&!isNaN(s)}(s)?+s-t.now():s;o<0&&(o=0);let a=0;return t.schedule(function(){n.closed||(n.next(a++),0<=i?this.schedule(void 0,i):n.complete())},o)})}(s,s,r)}(100).pipe((0,Y.U)(()=>parseInt(sessionStorage.getItem("state")||"0")),(0,k.o)(t=>2!==t,!0)).subscribe(t=>{this.state!==t&&(this.state=t,this.updateBackButtonStatus())})}updateBackButtonStatus(){this.disableBackButton=2===this.state&&3===this.position}getNameBusiness(){this.businessService.getBusiness(this.id_business.toString()).subscribe({next:t=>{t.status&&(this.name_business=t.status[0].NAME,this.rut_business=t.status[0].VAT)},error:t=>{u().close(),u().fire({icon:"error",text:t.msg,title:"\xa1Ups!"})}})}saveDraft(){this._saving=!0;const t=sessionStorage.getItem("saving")||!1,i=sessionStorage.getItem("isEdited")||!1;this.id_statement=parseInt(sessionStorage.getItem("id_statement"))||null;const n=sessionStorage.getItem("detailForm"),o=JSON.parse(n||"[]");let a=!0;for(let c=0;c<o.length;c++)0!=o[c].value&&(a=!1);const l={id_business:this.id_business,year_statement:this.year_statement,state:!1,id_statement:this.id_statement};if(a&&3!==this.position)o.push({precedence:1,hazard:1,recyclability:1,type_residue:1,value:0,amount:0}),u().fire({icon:"question",title:"\xbfFormulario vacio?",text:"El formulario tiene todos los valores en cero. \xbfEstas seguro de guardar borrador?",showConfirmButton:!0,showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonText:"Guardar"}).then(c=>{if(c.isConfirmed)if(u().fire({title:"Guardando Datos",text:"Se est\xe1n guardando datos",timerProgressBar:!0,showConfirmButton:!1}),u().showLoading(),null!=this.id_statement||t){if(t)return;this.productorService.updateValuesStatement(this.id_statement,o,l).subscribe(m=>{m.status&&(this._saving=!1,this.hour=new Date,u().close())})}else sessionStorage.setItem("saving","true"),this.productorService.saveForm({header:l,detail:o}).subscribe(m=>{this.hour=new Date,this._saving=!1,m.status&&(sessionStorage.setItem("id_statement",m.data),u().close()),sessionStorage.removeItem("isEdited"),sessionStorage.removeItem("saving")});else this.position=1});else{if(null===n)return void(this._saving=!1);if(!i)return this.hour=new Date,void(this._saving=!1);if(null!=this.id_statement||t){if(t)return;this.productorService.updateValuesStatement(this.id_statement,o,l).subscribe(c=>{c.status&&(this._saving=!1,this.hour=new Date)})}else sessionStorage.setItem("saving","true"),this.productorService.saveForm({header:l,detail:o}).subscribe(c=>{this._saving=!1,this.hour=new Date,c.status&&sessionStorage.setItem("id_statement",c.data),sessionStorage.removeItem("saving"),sessionStorage.removeItem("isEdited")})}}updateFormState(){this.id_statement=parseInt(sessionStorage.getItem("id_statement"))||null,u().fire({icon:"question",title:"Confirmaci\xf3n Env\xedo",text:"Usted est\xe1 a punto de enviar su declaraci\xf3n. Una vez enviada, no podr\xe1 realizar modificaciones sobre la misma. \xbfEsta seguro de realizar el env\xedo?",showConfirmButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,showCancelButton:!0}).then(t=>{t.isConfirmed&&this.productorService.updateStateStatement(this.id_statement,!0).subscribe(i=>{u().fire({title:"Exito",text:"La declaraci\xf3n fue enviada exitosamente",allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!0}).then(n=>{sessionStorage.removeItem("id_statement"),sessionStorage.removeItem("isEdited"),this.isSubmited=!0,this.router.navigate(["/productor/home"])})})})}changeStep(t){0!=this.position?(this.position>=1&&this.position<3&&t>0&&this.saveDraft(),t>0?this.position<3&&(this.position+=t):this.position>1&&(this.position+=t),this.updateBackButtonStatus()):this.position=1}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(d.qu),e.Y36(T.u),e.Y36(y.m),e.Y36(f.F0),e.Y36(f.gz))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-form"]],decls:35,vars:18,consts:[["aria-label","breadcrumb",1,"breadcrumbs","d-none","d-lg-block"],[1,"breadcrumb"],[1,"breadcrumb-item"],["href","#"],["aria-hidden","true",1,"fa","fa-home"],["href","#/productor/statements"],["aria-current","page",1,"breadcrumb-item","active"],["style","text-align: right;",4,"ngIf"],[1,"w-100",2,"width","100% !important"],[1,"table-responsive","mb-2","mb-lg-4"],[1,"list","list-process","list-unstyled"],[1,"list-process__dot",3,"ngClass"],[2,"text-align","right"],["class","btn btn-warning",3,"disabled","click",4,"ngIf"],["class","btn btn-primary",3,"click",4,"ngIf"],[4,"ngIf"],[1,"btn","btn-warning",3,"disabled","click"],[1,"btn","btn-primary",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"nav",0)(1,"ol",1)(2,"li",2)(3,"a",3),e._UZ(4,"i",4),e._uU(5," Inicio"),e.qZA()(),e.TgZ(6,"li",2)(7,"a",5),e._uU(8,"Consulta de Declaraci\xf3n"),e.qZA()(),e.TgZ(9,"li",6),e._uU(10),e.qZA()()(),e.TgZ(11,"h1"),e._uU(12,"Formulario"),e.qZA(),e._UZ(13,"hr")(14,"br")(15,"br"),e.YNc(16,ge,3,4,"p",7),e.TgZ(17,"div",8)(18,"div",9)(19,"ul",10)(20,"li",11)(21,"a"),e._uU(22,"Formulario"),e.qZA()(),e.TgZ(23,"li",11)(24,"a"),e._uU(25,"Resumen"),e.qZA()(),e.TgZ(26,"li",11)(27,"a"),e._uU(28,"Facturaci\xf3n"),e.qZA()()()()(),e.TgZ(29,"div",12),e.YNc(30,he,2,1,"button",13),e.YNc(31,fe,2,0,"button",14),e.qZA(),e.YNc(32,be,1,0,"app-form-statement",15),e.YNc(33,Ze,1,0,"app-summary-statement",15),e.YNc(34,Te,1,0,"app-send-statement",15)),2&t&&(e.xp6(10),e.lnq("Declaraci\xf3n ",i.year_statement," - ",i.name_business,"(",i.rut_business,") "),e.xp6(6),e.Q6J("ngIf",null!=i.hour),e.xp6(4),e.Q6J("ngClass",e.VKq(12,x,1==i.position)),e.xp6(3),e.Q6J("ngClass",e.VKq(14,x,2==i.position)),e.xp6(3),e.Q6J("ngClass",e.VKq(16,x,3==i.position)),e.xp6(4),e.Q6J("ngIf",i.position>1),e.xp6(1),e.Q6J("ngIf",i.position<3),e.xp6(1),e.Q6J("ngIf",1==i.position),e.xp6(1),e.Q6J("ngIf",2==i.position),e.xp6(1),e.Q6J("ngIf",3==i.position))},dependencies:[p.mk,p.O5,q,ae,pe,p.uU],styles:["[_nghost-%COMP%]{width:90%!important;padding:1%}"]}),s})();const Ae=function(s,r,t){return{"green-circle":s,"red-circle":r,"yellow-circle":t}};function ve(s,r){if(1&s&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._UZ(8,"span",21),e._uU(9),e.qZA()()),2&s){const t=r.$implicit,i=e.oxw();e.xp6(2),e.Oqu(t.CODE_BUSINESS),e.xp6(2),e.Oqu(t.NAME),e.xp6(2),e.Oqu(i.year),e.xp6(2),e.Q6J("ngClass",e.kEZ(5,Ae,1==i.businessById(t.ID).code,0==i.businessById(t.ID).code||-1==i.businessById(t.ID).code,2==i.businessById(t.ID).code)),e.xp6(1),e.hij(" ",i.businessById(t.ID).status," ")}}const Ee=function(s,r){return{"btn-info":s,"btn-primary":r}};function ye(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"li")(1,"button",22),e.NdJ("click",function(){const o=e.CHM(t).index,a=e.oxw();return e.KtG(a.pagTo(o))}),e._uU(2),e.qZA()()}if(2&s){const t=r.index,i=e.oxw();e.xp6(1),e.Q6J("ngClass",e.WLB(2,Ee,i.pos==t+1,i.pos!=t+1)),e.xp6(1),e.Oqu(t+1)}}let Ue=(()=>{class s{constructor(t,i,n,o){this.productorService=t,this.router=i,this.ratesService=n,this.businessServices=o,this.db=[],this.dbStatements=[],this.pos=1,this.business_name=[],this.years=[],this.cant=0,this.types=["EyE reciclables de papel/cart\xf3n","EyE reciclables de metal","EyE reciclables de pl\xe1sticos","EyE no reciclables"],this.year=(new Date).getFullYear()-1,this.rates=[],this.allStatement=[],this.allBusiness=[],this.decrypt=a=>{const l=Buffer.from(a,"base64");return Buffer.from(l).toString("utf-8")}}ngOnInit(){this.loadStatements(),this.ratesService.getRates(this.year).subscribe(i=>{i.status&&i.data.forEach(n=>{this.rates.push({name:this.types[n.type-1],price:n.price})})}),sessionStorage.getItem("user")}loadStatements(){const t=JSON.parse(sessionStorage.getItem("user")).ID;this.businessServices.getBusinessById(t,this.year.toString()).subscribe(i=>{this.allStatement=i.data.statements,this.allBusiness=i.data.business.sort((n,o)=>n.CODE_BUSINESS.toString().localeCompare(o.CODE_BUSINESS.toString())),this.cant=Math.ceil(this.allBusiness.length/10),this.db=this.allBusiness.slice(10*(this.pos-1),10*this.pos).sort((n,o)=>n.CODE_BUSINESS.toString().localeCompare(o.CODE_BUSINESS.toString()))})}businessById(t){const i=this.allStatement.find(a=>a.ID_BUSINESS==t);let n="",o=-1;if(null==i)n="No Enviado";else switch(o=i.STATE,i.STATE){case 1:n="Enviada";break;case 0:n="Borrador";break;case 2:n="Pendiente"}return{status:n,code:o}}filter(){const t=document.getElementById("f_name").value,i=document.getElementById("f_year").value,n=this.dbStatements.filter(o=>{if("-1"!=t&&o.NAME_BUSINESS==t){if("-1"==i)return o;if(o.YEAR_STATEMENT==i)return o}if("-1"==t){if("-1"==i)return o;if(o.YEAR_STATEMENT==i)return o}});this.db=n.slice(0,10).sort((o,a)=>o.CODE_BUSINESS.toString().localeCompare(a.CODE_BUSINESS.toString())),this.cant=Math.ceil(n.length/10)}reset(){this.loadStatements()}pagTo(t){this.pos=t+1,this.db=this.allBusiness.slice(10*t,10*(t+1)).sort((i,n)=>i.CODE_BUSINESS.toString().localeCompare(n.CODE_BUSINESS.toString()))}next(){this.pos>=this.cant||(this.pos++,this.db=this.allBusiness.slice(10*(this.pos-1),10*this.pos).sort((t,i)=>t.CODE_BUSINESS.toString().localeCompare(i.CODE_BUSINESS.toString())))}previus(){this.pos-1<=0||this.pos>=this.cant+1||(this.pos=this.pos-1,this.db=this.allBusiness.slice(10*(this.pos-1),10*this.pos).sort((t,i)=>t.CODE_BUSINESS.toString().localeCompare(i.CODE_BUSINESS.toString())))}navigateToForm(t,i,n,o=0){sessionStorage.setItem("state",o.toString()||"0"),sessionStorage.setItem("id_statement",n?.toString()||"null"),this.router.navigateByUrl(`/productor/form?year=${i}&id_business=${t}`)}setArrayFromNumber(){return new Array(this.cant)}logout(){this.router.navigate(["/auth/login"],{queryParams:{logout:!0}})}dowloadPdf(){this.productorService.downloadPDFTerminos().subscribe(t=>{const i=new Blob([t],{type:t.type}),n=window.URL.createObjectURL(i),o=document.createElement("a");o.href=n,o.download="Declaracion Jurada.docx",o.click(),window.URL.revokeObjectURL(n)})}openTermsAndConditions(){this.productorService.veryfyPDFTerminos().subscribe(t=>{t.status||document.getElementById("modalDownloadPdfTerms").click()})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(T.u),e.Y36(f.F0),e.Y36(v.z),e.Y36(y.m))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-home"]],decls:68,vars:2,consts:[["rel","stylesheet","href","https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css","integrity","sha512-*********","crossorigin","anonymous"],["id","content",2,"width","60vw","margin","0","padding","0"],["aria-label","breadcrumb",1,"breadcrumbs","d-none","d-lg-block"],[1,"breadcrumb"],["aria-current","page",1,"breadcrumb-item"],["aria-hidden","true",1,"fa","fa-home"],[1,"inicio"],[1,"box","box-inicio"],[1,"row"],[1,"col-12","col-md-12"],[1,"h1"],["href","mailto:soporte@prorep.cl"],["href","tel:+56979168394",1,"color-white"],[1,"table-responsive"],[1,"table","table-even","table-section","table-borderless","table-radius"],[1,"vertical-middle"],[4,"ngFor","ngForOf"],["aria-label","Navegaci\xf3n resultados"],[1,"pagination"],[1,"btn","btn-primary",3,"click"],["type","button","id","modalDownloadPdfTerms","data-bs-toggle","modal","data-bs-target","#Modal",1,"btn","btn-primary","text-center","d-none"],[1,"circle",3,"ngClass"],[1,"border","btn","btn-sm",3,"ngClass","click"]],template:function(t,i){1&t&&(e._UZ(0,"link",0),e.TgZ(1,"div",1)(2,"nav",2)(3,"ol",3)(4,"li",4),e._UZ(5,"i",5),e._uU(6," Inicio"),e.qZA()()(),e.TgZ(7,"section",6)(8,"h1"),e._uU(9,"Inicio"),e.qZA(),e.TgZ(10,"div",7)(11,"div",8)(12,"div",9)(13,"h2",10),e._uU(14,"Bienvenido/a a Mi Declaraci\xf3n"),e.qZA(),e.TgZ(15,"p"),e._uU(16,"Como parte de las obligaciones que establece la Ley REP, los Productores deben informar la cantidad de EyE no domiciliarios (POM) puestos en el mercado el a\xf1o anterior."),e.qZA(),e.TgZ(17,"p"),e._uU(18,"ProREP pone a disposici\xf3n de sus socios la plataforma de declaraci\xf3n que dar\xe1 cumplimiento a la obligaci\xf3n de informar sus EyE."),e.qZA(),e.TgZ(19,"p"),e._uU(20,"La declaraci\xf3n de los EyE introducidos en el mercado el a\xf1o anterior deber\xe1 ser subida y enviada antes del 20 de marzo de cada a\xf1o"),e.qZA(),e.TgZ(21,"p"),e._uU(22,"En caso de problemas, errores, correcciones o dudas espec\xedficas contactarse con el \xc1rea de Soporte en el siguiente mail: "),e.TgZ(23,"a",11),e._uU(24,"soporte@prorep.cl"),e.qZA()(),e.TgZ(25,"h2",10),e._uU(26,"Contacto:"),e.qZA(),e.TgZ(27,"p")(28,"strong"),e._uU(29,"\xbfAlguna pregunta?"),e.qZA(),e._uU(30," P\xf3ngase en contacto con nuestro equipo de atenci\xf3n al cliente. "),e.qZA(),e.TgZ(31,"p"),e._uU(32,"Celular "),e.TgZ(33,"strong")(34,"a",12),e._uU(35,"+56 9 7916 8394"),e.qZA()()()()()(),e._UZ(36,"p"),e.TgZ(37,"div",13)(38,"table",14)(39,"thead",15)(40,"tr")(41,"th"),e._uU(42,"ID Empresa"),e.qZA(),e.TgZ(43,"th"),e._uU(44,"Nombre Empresa"),e.qZA(),e.TgZ(45,"th"),e._uU(46,"A\xf1o Declaraci\xf3n"),e.qZA(),e.TgZ(47,"th"),e._uU(48,"Estado"),e.qZA()()(),e.TgZ(49,"tbody"),e.YNc(50,ve,10,9,"tr",16),e.qZA()()(),e.TgZ(51,"nav",17)(52,"ul",18)(53,"li")(54,"button",19),e.NdJ("click",function(){return i.pagTo(0)}),e._uU(55,"Primero"),e.qZA()(),e.TgZ(56,"li")(57,"button",19),e.NdJ("click",function(){return i.previus()}),e._uU(58,"Anterior"),e.qZA()(),e.YNc(59,ye,3,5,"li",16),e.TgZ(60,"li")(61,"button",19),e.NdJ("click",function(){return i.next()}),e._uU(62,"Siguiente"),e.qZA()(),e.TgZ(63,"li")(64,"button",19),e.NdJ("click",function(){return i.pagTo(i.cant-1)}),e._uU(65,"\xdaltimo"),e.qZA()()()()()(),e.TgZ(66,"button",20),e._uU(67," Launch demo modal\n"),e.qZA()),2&t&&(e.xp6(50),e.Q6J("ngForOf",i.db),e.xp6(9),e.Q6J("ngForOf",i.setArrayFromNumber()))},dependencies:[p.mk,p.sg],styles:[".circle[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:50%;display:inline-block;margin-right:5px}.green-circle[_ngcontent-%COMP%]{background-color:green}.red-circle[_ngcontent-%COMP%]{background-color:red}.yellow-circle[_ngcontent-%COMP%]{background-color:#ff0}body[_ngcontent-%COMP%]{font-family:Open Sans,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,Helvetica,Arial,sans-serif}.icon-orange[_ngcontent-%COMP%]{color:#f8bb86}"]}),s})();var xe=_(4135),Fe=_(263);function Ce(s,r){1&s&&e._UZ(0,"i",53)}function qe(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"button",23),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,o=e.oxw();return e.KtG(o.downloadTerminos(n.ID_BUSINESS))}),e._uU(1," Descargar "),e.qZA()}}function Ie(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td",48)(6,"button",49),e.NdJ("click",function(){const o=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.adjuntar(o.ID_BUSINESS))}),e._uU(7),e.qZA()(),e.TgZ(8,"td",48),e.YNc(9,Ce,1,0,"i",50),e.YNc(10,qe,2,0,"button",51),e.qZA(),e.TgZ(11,"td",48)(12,"button",52),e.NdJ("click",function(){const o=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.deleteDJ(o.ID_BUSINESS))}),e._uU(13,"X"),e.qZA()()()}if(2&s){const t=r.$implicit;e.xp6(2),e.Oqu(t.CODE_BUSINESS),e.xp6(2),e.Oqu(t.NAME),e.xp6(2),e.Q6J("disabled",null!==t.DJ_FILE),e.xp6(1),e.hij(" ",null==t.DJ_FILE?"Adjuntar":"Adjuntado"," "),e.xp6(2),e.Q6J("ngIf",null==t.DJ_FILE),e.xp6(1),e.Q6J("ngIf",null!==t.DJ_FILE),e.xp6(2),e.Q6J("disabled",null==t.DJ_FILE)}}const Ne=function(s,r){return{"btn-info":s,"btn-primary":r}};function we(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"li")(1,"button",54),e.NdJ("click",function(){const o=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.pagTo(o))}),e._uU(2),e.qZA()()}if(2&s){const t=r.$implicit,i=e.oxw();e.xp6(1),e.Q6J("ngClass",e.WLB(2,Ne,i.posP===t+1,i.posP!==t+1)),e.xp6(1),e.Oqu(t+1)}}let Me=(()=>{class s{constructor(t,i,n,o){this.fb=t,this.authService=i,this.productorServices=n,this.router=o,this.pos="right",this.horaIngreso=new Date,this.db=[],this.business_user=[],this.index=0,this.posP=1,this.cant=0,this.allBusiness=[],this.filteredForm=[],this.formData=this.fb.group({actual:["",[d.kI.required]],password:["",[d.kI.required,d.kI.minLength(3)]],repeatPassword:["",[d.kI.required,d.kI.minLength(3)]]}),this.pos2="right"}ngOnInit(){this.loadStatements(),this.userData=JSON.parse(sessionStorage.getItem("user")),this.horaIngreso=new Date(sessionStorage.getItem("horaIngreso"))}getBusiness(){this.productorServices.businessUserDJ(this.userData.ID).subscribe(t=>{t.status&&(this.business_user=t.data)})}loadStatements(){const t=JSON.parse(sessionStorage.getItem("user")).ID;this.productorServices.businessUserDJ(t).subscribe(i=>{this.allBusiness=i.data.sort((n,o)=>n.CODE_BUSINESS.toString().localeCompare(o.CODE_BUSINESS.toString())),this.cant=Math.ceil(this.allBusiness.length/10),this.db=this.allBusiness.slice(10*(this.posP-1),10*this.posP).sort((n,o)=>n.CODE_BUSINESS.toString().localeCompare(o.CODE_BUSINESS.toString()))})}reset(){this.loadStatements()}pagTo(t){this.posP=t+1,this.db=this.allBusiness.slice(10*t,10*(t+1)).sort((i,n)=>i.CODE_BUSINESS.toString().localeCompare(n.CODE_BUSINESS.toString()))}next(){this.posP>=this.cant||(this.posP++,this.db=this.allBusiness.slice(10*(this.posP-1),10*this.posP).sort((t,i)=>t.CODE_BUSINESS.toString().localeCompare(i.CODE_BUSINESS.toString())))}previus(){this.posP-1<=0||this.posP>=this.cant+1||(this.posP=this.posP-1,this.db=this.allBusiness.slice(10*(this.posP-1),10*this.posP).sort((t,i)=>t.CODE_BUSINESS.toString().localeCompare(i.CODE_BUSINESS.toString())))}setArrayFromNumber(){return new Array(this.cant)}visiblePageNumbers(){const t=this.setArrayFromNumber().length,i=[];if(t<=15)for(let n=0;n<t;n++)i.push(n);else{let n=Math.max(0,this.posP-Math.floor(7.5)),o=Math.min(t-1,n+14);o-n+1<15&&(o=t-1,n=Math.max(0,o-14));for(let a=n;a<=o;a++)i.push(a)}return i}btnrecovery(){const{actual:t,password:i,repeatPassword:n}=this.formData.value;this.authService.modifyPassword(i,n,t).subscribe({next:o=>{o.status?(u().fire({title:"Cambio de contrase\xf1a",text:"La contrase\xf1a fue cambiada exitosamente",icon:"success"}),this.router.navigate(["/productor/home"])):(u().fire({title:"Validar informaci\xf3n",text:o.msg,icon:"error"}),this.formData.reset())},error:o=>{u().fire({title:"Formato inv\xe1lido",text:"Contrase\xf1a debe contener al menos 8 caracteres",icon:"error"})}})}displayModifyPassword(){this.pos="right"==this.pos?"down":"right"}displayModifyPassword2(){this.pos2="right"==this.pos2?"down":"right"}downloadTerminos(t){this.productorServices.downloadPdfFirma(t,this.userData.ID).subscribe({next:n=>{if(n){const o=new Blob([n],{type:"application/pdf"});let a=document.createElement("a");a.href=window.URL.createObjectURL(o),a.download="Declaraci\xf3n Jurada Firmada",document.body.appendChild(a),a.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),a.remove(),window.URL.revokeObjectURL(a.href)}}})}adjuntar(t){const i=this.userData.ID;var n=document.createElement("input");n.type="file",n.style.display="none",n.onchange=o=>{let l=o.target.files[0];l&&"application/pdf"===l.type&&l.size/1e3<=1e3?(this.file=l,this.productorServices.uploadPDFTerminos(l,t,i).subscribe({next:c=>{c.status&&this.reset()}})):u().fire({icon:"info",text:"El archivo debe ser PDF y debe pesar menos de 1MB"})},document.body.appendChild(n),n.click()}deleteDJ(t){const i=this.userData.ID;u().fire({title:"\xbfEsta seguro de eliminar la declaraci\xf3n jurada?",showDenyButton:!0,confirmButtonText:"Aceptar",denyButtonText:"Cancelar"}).then(n=>{n.isConfirmed&&this.productorServices.deleteDJ(t,i).subscribe({next:o=>{o.status?(u().fire({title:"Declaraci\xf3n Eliminada",text:"",icon:"error"}),this.reset()):u().fire({title:"Validar informaci\xf3n",text:o.msg,icon:"error"})},error:o=>{u().fire({title:"Formato inv\xe1lido",text:"",icon:"error"})}})})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(d.qu),e.Y36(Fe.e),e.Y36(T.u),e.Y36(f.F0))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-profile"]],decls:142,vars:22,consts:[[1,"container","mt-4"],[1,"mi-perfil"],[1,"box","box-mi-perfil","mb-5","d-flex","align-items-start"],[1,"list","list-data","list-data-title-green","column-md-2","gap-0","list-unstyled"],[1,"list-data__title"],[1,"list-data__text"],[1,"color-verde"],[1,"list","list-links","list-unstyled"],["id","accordionPanelsStayOpenExample",1,"accordion","accordion-flush"],[1,"accordion-item"],["id","panelsStayOpen-headingOne",1,"accordion-header"],["data-bs-toggle","collapse","data-bs-target","#panelsStayOpen-collapseOne",3,"click"],["aria-hidden","true"],["id","panelsStayOpen-collapseOne","aria-labelledby","panelsStayOpen-headingOne",1,"accordion-collapse","collapse"],[1,"accordion-body"],["autocomplete","off",1,"form-recovery",3,"formGroup"],[1,"mb-4"],[1,"input-group"],[1,"input-group-text","input-group-text-left"],["aria-hidden","true",1,"fa","fa-lock","fa-fw"],["type","password","id","password","formControlName","actual","placeholder","Contrase\xf1a actual",1,"form-control"],["type","password","id","password","formControlName","password","placeholder","Nueva contrase\xf1a",1,"form-control"],["type","password","id","repeatPassword","formControlName","repeatPassword","placeholder","Repetir contrase\xf1a",1,"form-control"],["type","button",1,"btn","btn-primary","btn-fa","w-100",3,"click"],["aria-hidden","true",1,"fa","fa-long-arrow-right","fa-fw"],["id","panelsStayOpen-headingTwo",1,"accordion-header"],["data-bs-toggle","collapse","data-bs-target","#panelsStayOpen-collapseTwo",3,"click"],["id","panelsStayOpen-collapseTwo","aria-labelledby","panelsStayOpen-headingTwo",1,"accordion-collapse","collapse"],[1,"buttonRight"],["data-bs-toggle","modal","data-bs-target","#exampleModal",1,"btn","btn-primary"],["id","exampleModal","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","exampleModalLabel",1,"modal-title","fs-5"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"container"],[1,"row"],[1,"col-md-6"],[1,"table-container","table","table-even","table-section","table-borderless","table-border","table-radius","d-lg-table"],[1,"text-center","w-100"],[4,"ngFor","ngForOf"],["aria-label","Navegaci\xf3n resultados"],[1,"pagination"],[1,"btn","btn-primary",3,"click"],[1,"modal-footer"],["type","button","id","btnCloseModal","data-bs-dismiss","modal",1,"btn","btn-secondary"],[1,"centered-td"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","fas fa-times text-danger",4,"ngIf"],["type","button","class","btn btn-primary btn-fa w-100",3,"click",4,"ngIf"],["type","button",1,"btn","btn-danger","btn-sm","rounded-pill",3,"disabled","click"],[1,"fas","fa-times","text-danger"],[1,"border","btn","btn-sm",3,"ngClass","click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"section",1)(2,"h1"),e._uU(3,"Mi Perfil"),e.qZA(),e.TgZ(4,"div",2)(5,"ul",3)(6,"li")(7,"span",4),e._uU(8,"Nombre Usuario"),e.qZA(),e.TgZ(9,"span",5),e._uU(10),e.qZA()(),e.TgZ(11,"li")(12,"span",4),e._uU(13,"Perfil"),e.qZA(),e.TgZ(14,"span",5),e._uU(15),e.qZA()(),e.TgZ(16,"li")(17,"span",4),e._uU(18,"Tel\xe9fono"),e.qZA(),e.TgZ(19,"span",5),e._uU(20),e.qZA()(),e.TgZ(21,"li")(22,"span",4),e._uU(23,"Correo"),e.qZA(),e.TgZ(24,"span",5),e._uU(25),e.qZA()(),e.TgZ(26,"li")(27,"span",4),e._uU(28,"Instituci\xf3n"),e.qZA(),e.TgZ(29,"span",5),e._uU(30),e.qZA()(),e.TgZ(31,"li")(32,"span",4),e._uU(33,"Cargo"),e.qZA(),e.TgZ(34,"span",5),e._uU(35),e.qZA()(),e.TgZ(36,"li")(37,"span",4),e._uU(38,"Tel\xe9fono Oficina"),e.qZA(),e.TgZ(39,"span",5),e._uU(40),e.qZA()(),e.TgZ(41,"li")(42,"span",4)(43,"b"),e._uU(44,"Fecha/ Hora ingreso"),e.qZA()(),e.TgZ(45,"span",5),e._uU(46),e.ALo(47,"date"),e.qZA()()()(),e.TgZ(48,"h2",6),e._uU(49,"Acciones"),e.qZA(),e.TgZ(50,"ul",7)(51,"div",8)(52,"div",9)(53,"h2",10)(54,"li",11),e.NdJ("click",function(){return i.displayModifyPassword()}),e.TgZ(55,"a")(56,"span"),e._uU(57,"Cambio de contrase\xf1a"),e.qZA(),e._UZ(58,"i",12),e.qZA()()(),e.TgZ(59,"div",13)(60,"div",14)(61,"form",15)(62,"div",16)(63,"div",17)(64,"button",18),e._UZ(65,"i",19),e.qZA(),e._UZ(66,"input",20),e.qZA()(),e.TgZ(67,"div",16)(68,"div",17)(69,"button",18),e._UZ(70,"i",19),e.qZA(),e._UZ(71,"input",21),e.qZA()(),e.TgZ(72,"div",16)(73,"div",17)(74,"button",18),e._UZ(75,"i",19),e.qZA(),e._UZ(76,"input",22),e.qZA()(),e.TgZ(77,"div",16)(78,"button",23),e.NdJ("click",function(){return i.btnrecovery()}),e._uU(79," Enviar "),e._UZ(80,"i",24),e.qZA()()()()()(),e.TgZ(81,"div",9)(82,"h2",25)(83,"li",26),e.NdJ("click",function(){return i.displayModifyPassword2()}),e.TgZ(84,"a")(85,"span"),e._uU(86,"Mis Declaraciones Juradas"),e.qZA(),e._UZ(87,"i",12),e.qZA()()(),e.TgZ(88,"div",27)(89,"div",14)(90,"form",15)(91,"div",16)(92,"div",28)(93,"button",29),e._uU(94,"Ver Declaraciones Juradas"),e.qZA()()()()()()()()()(),e.TgZ(95,"div",30)(96,"div",31)(97,"div",32)(98,"div",33)(99,"h1",34),e._uU(100,"Declaraciones"),e.qZA(),e._UZ(101,"button",35),e.qZA(),e.TgZ(102,"div",36)(103,"div",37)(104,"form")(105,"div",38)(106,"div",39),e._UZ(107,"p"),e.qZA(),e.TgZ(108,"div")(109,"table",40)(110,"thead")(111,"tr",41)(112,"th"),e._uU(113,"C\xf3digo Empresa"),e.qZA(),e.TgZ(114,"th"),e._uU(115,"Nombre Empresa"),e.qZA(),e.TgZ(116,"th"),e._uU(117,"Adjuntar Declaraci\xf3n Jurada"),e.qZA(),e.TgZ(118,"th"),e._uU(119,"Descargar Declaraci\xf3n Jurada"),e.qZA(),e.TgZ(120,"th"),e._uU(121,"Eliminar Declaraci\xf3n Jurada"),e.qZA()()(),e.TgZ(122,"tbody"),e.YNc(123,Ie,14,7,"tr",42),e.qZA()(),e.TgZ(124,"nav",43)(125,"ul",44)(126,"li")(127,"button",45),e.NdJ("click",function(){return i.pagTo(0)}),e._uU(128,"Primero"),e.qZA()(),e.TgZ(129,"li")(130,"button",45),e.NdJ("click",function(){return i.previus()}),e._uU(131,"Anterior"),e.qZA()(),e.YNc(132,we,3,5,"li",42),e.TgZ(133,"li")(134,"button",45),e.NdJ("click",function(){return i.next()}),e._uU(135,"Siguiente"),e.qZA()(),e.TgZ(136,"li")(137,"button",45),e.NdJ("click",function(){return i.pagTo(i.cant-1)}),e._uU(138,"\xdaltimo"),e.qZA()()()()()()()()(),e.TgZ(139,"div",46)(140,"button",47),e._uU(141,"Cerrar"),e.qZA()()()()()()),2&t&&(e.xp6(10),e.AsE("",i.userData.FIRST_NAME," ",i.userData.LAST_NAME,""),e.xp6(5),e.Oqu(i.userData.ROL_NAME),e.xp6(5),e.Oqu(i.userData.PHONE),e.xp6(5),e.Oqu(i.userData.EMAIL),e.xp6(5),e.Oqu(i.userData.BUSINESS.join(" || ")),e.xp6(5),e.Oqu(i.userData.POSITION),e.xp6(5),e.Oqu(i.userData.PHONE_OFFICE),e.xp6(6),e.Oqu(e.xi3(47,19,i.horaIngreso,"dd-MM-yyyy H:mm:s")),e.xp6(12),e.Gre("fa fa-chevron-",i.pos,""),e.xp6(3),e.Q6J("formGroup",i.formData),e.xp6(26),e.Gre("fa fa-chevron-",i.pos2,""),e.xp6(3),e.Q6J("formGroup",i.formData),e.xp6(33),e.Q6J("ngForOf",i.db),e.xp6(9),e.Q6J("ngForOf",i.visiblePageNumbers()))},dependencies:[p.mk,p.sg,p.O5,d._Y,d.Fj,d.JJ,d.JL,d.F,d.sg,d.u,p.uU],styles:[".accordion[_ngcontent-%COMP%]{border:none!important}.accordion-item[_ngcontent-%COMP%]{border:none}.accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]:last-child{border:none}.accordion[_ngcontent-%COMP%]   .accordion-body[_ngcontent-%COMP%]{border:none}a[_ngcontent-%COMP%]{cursor:pointer}a[_ngcontent-%COMP%]:hover{color:#09a57b}.swal-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:20px;height:20px}.centered-td[_ngcontent-%COMP%]{text-align:center}"]}),s})();var I=_(1770),Be=_(805);function Oe(s,r){if(1&s&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&s){const t=r.$implicit;e.xp6(1),e.Oqu(t.label)}}function Pe(s,r){if(1&s&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&s){const t=r.$implicit;e.xp6(1),e.Oqu(t.label)}}function Re(s,r){if(1&s&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&s){const t=r.$implicit;e.xp6(1),e.Oqu(t.label)}}function De(s,r){if(1&s&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&s){const t=r.$implicit;e.xp6(1),e.Oqu(t.label)}}function Ye(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"button",30),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,o=e.oxw();return e.KtG(o.downloadPDF(n.CODE_BUSINESS,n.YEAR_STATEMENT))}),e._UZ(1,"i",31),e.qZA()}}function ke(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"button",30),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,o=e.oxw();return e.KtG(o.navigateToForm(n.CODE_BUSINESS,n.YEAR_STATEMENT,n.ID,n.STATE))}),e._UZ(1,"i",32),e.qZA()}}function Je(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"button",30),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,o=e.oxw();return e.KtG(o.navigateToForm(n.CODE_BUSINESS,n.YEAR_STATEMENT,n.ID,n.STATE))}),e._UZ(1,"i",33),e.qZA()}}function Le(s,r){if(1&s&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.ALo(13,"date"),e.qZA(),e.TgZ(14,"td",28),e.YNc(15,Ye,2,0,"button",29),e.YNc(16,ke,2,0,"button",29),e.YNc(17,Je,2,0,"button",29),e.qZA()()),2&s){const t=r.$implicit;e.xp6(2),e.Oqu(t.CODE_BUSINESS),e.xp6(2),e.Oqu(t.NAME_BUSINESS),e.xp6(2),e.Oqu(t.YEAR_STATEMENT),e.xp6(2),e.Oqu(1==t.STATE?"Enviada":0==t.STATE?"Borrador":"Pendiente"),e.xp6(2),e.Oqu(null!==t.AMOUNT_UF?t.AMOUNT_UF.toFixed(2).replace(".",","):"-"),e.xp6(2),e.Oqu(e.xi3(13,9,t.UPDATED_AT,"dd-MM-yyyy H:mm:ss")),e.xp6(3),e.Q6J("ngIf",1==t.STATE),e.xp6(1),e.Q6J("ngIf",0==t.STATE),e.xp6(1),e.Q6J("ngIf",2==t.STATE)}}const Ve=function(s,r){return{"btn-info":s,"btn-primary":r}};function He(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"li")(1,"button",34),e.NdJ("click",function(){const o=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.pagTo(o))}),e._uU(2),e.qZA()()}if(2&s){const t=r.$implicit,i=e.oxw();e.xp6(1),e.Q6J("ngClass",e.WLB(2,Ve,i.pos===t+1,i.pos!==t+1)),e.xp6(1),e.Oqu(t+1)}}let $e=(()=>{class s{constructor(t,i){this.productorService=t,this.router=i,this.dbStatements=[],this.filtered=[],this.db=[],this.pos=1,this.business_name=[],this.business_year=[],this.years=[],this.cant=0,this.selectedYear="-1",this.filteredBusinesses=[],this.filteredYear=[],this.form=new d.cw({BUSINESS:new d.NI(null,d.kI.required),YEAR:new d.NI(null,d.kI.required)})}ngOnInit(){this.loadStatements()}filterBusinesses(t){const i=t.query.toLowerCase();this.filteredBusinesses=this.business_name.filter(n=>n.label.toLowerCase().includes(i)),this.filteredBusinesses.length>0?this.filteredBusinesses.unshift({label:"Todos",value:"-1"}):this.filteredBusinesses=[{label:"Todos",value:"-1"}]}filterYear(t){const i=t.query;this.filteredYear=this.business_year.filter(n=>n.label.toString().startsWith(i)),this.filteredYear.length>0?this.filteredYear.unshift({label:"Todos",value:"-1"}):this.filteredYear=[{label:"Todos",value:"-1"}]}loadStatements(){this.productorService.getStatementByUser.subscribe(t=>{if(t.status){const i=t.data.sort((a,l)=>a.NAME_BUSINESS<l.NAME_BUSINESS?-1:a.NAME_BUSINESS>l.NAME_BUSINESS?1:l.YEAR_STATEMENT-a.YEAR_STATEMENT);let n=new Set,o=new Set;i.forEach(a=>{n.add(a.CODE_BUSINESS+" \u2014 "+a.NAME_BUSINESS),this.years.includes(a.YEAR_STATEMENT)||(this.years.push(a.YEAR_STATEMENT),o.add(a.YEAR_STATEMENT))}),this.business_year=Array.from(o).map(a=>({label:a,value:a})),this.business_name=Array.from(n).map(a=>({label:a,value:a})),this.years.sort((a,l)=>l-a),this.dbStatements=i,this.filtered=t.data,this.cant=Math.ceil(this.dbStatements.length/10),this.db=this.dbStatements.slice(0,10)}})}updateFiltersBusiness(t){let i;if(t&&"input"==t.type){const a=this.form.get("BUSINESS");a&&a.value&&(i=a.value)}else i=t&&t.value;if("Todos"==i&&(i=-1),-1==i||null==i){let a=new Set,l=this.dbStatements.slice();return this.dbStatements.sort((c,m)=>m.YEAR_STATEMENT-c.YEAR_STATEMENT).forEach(c=>{a.add(c.YEAR_STATEMENT)}),this.business_year=Array.from(a).map(c=>({label:c,value:c})),void(this.dbStatements=l)}i=i.replace(/.* \u2014 \s*/,"");const n=this.dbStatements.filter(a=>{if("-1"!=i&&a.NAME_BUSINESS==i)return a});let o=new Set;n.forEach(a=>{o.add(a.YEAR_STATEMENT)}),this.business_year=Array.from(o).map(a=>({label:a,value:a}))}updateFiltersYears(t){let i;if(t&&"input"==t.type){const a=this.form.get("YEAR");a&&a.value&&(i=a.value)}else i=t&&t.value;if("Todos"==i&&(i=-1),-1==i||null==i){let a=new Set;return this.dbStatements.forEach(l=>{a.add(l.CODE_BUSINESS+" \u2014 "+l.NAME_BUSINESS)}),void(this.business_name=Array.from(a).map(l=>({label:l,value:l})))}i=i.toString().replace(/.* \u2014 \s*/,"");const n=this.dbStatements.filter(a=>{if("-1"!=i&&a.YEAR_STATEMENT==i)return a});let o=new Set;n.forEach(a=>{o.add(a.CODE_BUSINESS+" \u2014 "+a.NAME_BUSINESS)}),this.business_name=Array.from(o).map(a=>({label:a,value:a}))}filter(){let t,i,n,o;const a=this.form.get("BUSINESS"),l=this.form.get("YEAR");if(a&&a.value&&l&&l.value){a.value&&(n="string"==typeof a.value?1:Object.keys(a.value).length),l.value&&(o="string"==typeof l.value?1:Object.keys(l.value).length),n>1?o>1?(t=a.value.value,i=l.value.value):(t=a.value.value,i="Todos"==l.value?-1:l.value):o>1?"Todos"==a.value?(t=-1,i=l.value.value):(t=a.value,i=l.value):"Todos"==a.value?(t=-1,i="Todos"==l.value?-1:l.value):"Todos"==l.value?(t=a.value,i=-1):(t=a.value,i=l.value),-1!=t&&(t=t.toString().replace(/.* \u2014 \s*/,""));let c=this.business_name;if(this.business_name=this.business_name.map(m=>({value:m.value.replace(/.* \u2014 \s*/,""),label:m.label.replace(/.* \u2014 \s*/,"")})),-1==t||this.business_name.some(m=>m.value===t)){if(this.business_name=c,null!=i&&!isNaN(Number(i))){this.business_name=c;const m=this.dbStatements.filter(g=>{if("-1"!=t&&g.NAME_BUSINESS==t){if("-1"==i)return g;if(g.YEAR_STATEMENT==i)return g}if("-1"==t){if("-1"==i)return g;if(g.YEAR_STATEMENT==i)return g}});return this.pos=1,this.filtered=m,this.db=m.slice(0,10).sort((g,h)=>new Date(h.UPDATED_AT).getTime()-new Date(g.UPDATED_AT).getTime()),void(this.cant=Math.ceil(m.length/10))}this.business_name=c,u().fire({title:"Error",text:"Debe ingresar un a\xf1o v\xe1lido.",icon:"error",confirmButtonText:"Aceptar"})}else this.business_name=c,u().fire({title:"Error",text:"Debe ingresar una empresa o a\xf1o v\xe1lido.",icon:"error",confirmButtonText:"Aceptar"})}else u().fire({title:"Error",text:"Debe seleccionar empresa y a\xf1o.",icon:"error",confirmButtonText:"Aceptar"})}reset(){this.loadStatements()}pagTo(t){this.pos=t+1,this.db=this.filtered.slice(10*t,10*(t+1)).sort((i,n)=>i.NAME_BUSINESS<n.NAME_BUSINESS?-1:i.NAME_BUSINESS>n.NAME_BUSINESS?1:n.YEAR_STATEMENT-i.YEAR_STATEMENT)}next(){this.pos>=this.cant||(this.pos++,this.db=this.filtered.slice(10*(this.pos-1),10*this.pos).sort((t,i)=>t.NAME_BUSINESS<i.NAME_BUSINESS?-1:t.NAME_BUSINESS>i.NAME_BUSINESS?1:i.YEAR_STATEMENT-t.YEAR_STATEMENT))}previus(){this.pos-1<=0||this.pos>=this.cant+1||(this.pos=this.pos-1,this.db=this.filtered.slice(10*(this.pos-1),10*this.pos).sort((t,i)=>t.NAME_BUSINESS<i.NAME_BUSINESS?-1:t.NAME_BUSINESS>i.NAME_BUSINESS?1:i.YEAR_STATEMENT-t.YEAR_STATEMENT))}downloadPDF(t,i){u().fire({title:"Espere",text:"Generando PDF",showConfirmButton:!1}),u().showLoading(),this.productorService.downloadPDF(t,i).subscribe(n=>{const o=new Blob([n],{type:"application/pdf"});let a=document.createElement("a");a.href=window.URL.createObjectURL(o),a.download=`Reporte_${i}`,document.body.appendChild(a),a.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),a.remove(),window.URL.revokeObjectURL(a.href),u().close()})}navigateToForm(t,i,n,o=0){sessionStorage.setItem("state",o.toString()||"0"),sessionStorage.setItem("id_statement",n?.toString()||"null"),this.router.navigateByUrl(`/productor/form?year=${i}&id_business=${t}`)}setArrayFromNumber(){return new Array(this.cant)}visiblePageNumbers(){const t=this.setArrayFromNumber().length,i=[];if(t<=15)for(let n=0;n<t;n++)i.push(n);else{let n=Math.max(0,this.pos-Math.floor(7.5)),o=Math.min(t-1,n+14);o-n+1<15&&(o=t-1,n=Math.max(0,o-14));for(let a=n;a<=o;a++)i.push(a)}return i}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(T.u),e.Y36(f.F0))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-statements"]],decls:69,vars:7,consts:[[1,"container","mt-4"],["aria-label","breadcrumb",1,"breadcrumbs","d-none","d-lg-block"],[1,"breadcrumb"],[1,"breadcrumb-item"],["href","#"],["aria-hidden","true",1,"fa","fa-home"],["aria-current","page",1,"breadcrumb-item","active"],[1,"declaracion"],[1,"d-sm-flex","justify-content-between","mb-3","mb-md-0"],[1,"box","box-form","mb-4",3,"formGroup"],[1,"row","align-items-end"],[1,"col-12","col-xl-4","mb-3","mb-xl-0"],[1,"form-label"],["formControlName","BUSINESS","field","label","placeholder","Buscar empresa",1,"custom-autocomplete",3,"suggestions","dropdown","completeMethod","input","onSelect"],["pTemplate","item"],["pTemplate","selectedItem"],["formControlName","YEAR","field","label","placeholder","Buscar A\xf1o",1,"custom-autocomplete",3,"suggestions","dropdown","completeMethod","input","onSelect"],[1,"row"],[1,"col-6"],[1,"btn","btn-primary","col-12",2,"height","2.875rem","border-radius",".25rem",3,"click"],[1,"table-responsive"],[1,"table","table-even","table-section","table-borderless","table-radius"],[1,"vertical-middle"],[1,"text-uppercase","text-center","text-nowrap"],[4,"ngFor","ngForOf"],["aria-label","Navegaci\xf3n resultados"],[1,"pagination"],[1,"btn","btn-primary",3,"click"],[1,"text-center","text-nowrap"],["class","btn",3,"click",4,"ngIf"],[1,"btn",3,"click"],["aria-hidden","true",1,"fa","fa-file-pdf-o","fa-fw","fa-lg","color-blue"],["aria-hidden","true",1,"fa","fa-file-text-o","fa-fw","fa-lg",2,"color","red"],["aria-hidden","true",1,"fa","fa-file-text-o","fa-fw","fa-lg",2,"color","#DEC300"],[1,"border","btn","btn-sm",3,"ngClass","click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),e._UZ(5,"i",5),e._uU(6," Inicio"),e.qZA()(),e.TgZ(7,"li",6),e._uU(8,"Consulta de Declaraci\xf3n"),e.qZA()()(),e.TgZ(9,"section",7)(10,"h1"),e._uU(11,"Consulta Declaraciones"),e.qZA(),e._UZ(12,"div",8),e.TgZ(13,"div",9)(14,"div",10)(15,"div",11)(16,"label",12),e._uU(17,"EMPRESAS:"),e.qZA(),e._UZ(18,"br"),e.TgZ(19,"p-autoComplete",13),e.NdJ("completeMethod",function(o){return i.filterBusinesses(o)})("input",function(o){return i.updateFiltersBusiness(o)})("onSelect",function(o){return i.updateFiltersBusiness(o)}),e.YNc(20,Oe,2,1,"ng-template",14),e.YNc(21,Pe,2,1,"ng-template",15),e.qZA()(),e.TgZ(22,"div",11)(23,"label",12),e._uU(24,"A\xf1o:"),e.qZA(),e._UZ(25,"br"),e.TgZ(26,"p-autoComplete",16),e.NdJ("completeMethod",function(o){return i.filterYear(o)})("input",function(o){return i.updateFiltersYears(o)})("onSelect",function(o){return i.updateFiltersYears(o)}),e.YNc(27,Re,2,1,"ng-template",14),e.YNc(28,De,2,1,"ng-template",15),e.qZA()(),e.TgZ(29,"div",11)(30,"div",17)(31,"div",18)(32,"button",19),e.NdJ("click",function(){return i.filter()}),e._uU(33,"Mostrar"),e.qZA()()()()()(),e.TgZ(34,"div",20)(35,"table",21)(36,"thead",22)(37,"tr")(38,"th"),e._uU(39,"ID Empresa"),e.qZA(),e.TgZ(40,"th"),e._uU(41,"Nombre Empresa"),e.qZA(),e.TgZ(42,"th"),e._uU(43,"A\xf1o Declaraci\xf3n"),e.qZA(),e.TgZ(44,"th"),e._uU(45,"Estado"),e.qZA(),e.TgZ(46,"th"),e._uU(47,"Monto Total (UF)"),e.qZA(),e.TgZ(48,"th"),e._uU(49,"Fecha Env\xedo"),e.qZA(),e.TgZ(50,"th",23),e._uU(51,"Acci\xf3n"),e.qZA()()(),e.TgZ(52,"tbody"),e.YNc(53,Le,18,12,"tr",24),e.qZA()()(),e.TgZ(54,"nav",25)(55,"ul",26)(56,"li")(57,"button",27),e.NdJ("click",function(){return i.pagTo(0)}),e._uU(58,"Primero"),e.qZA()(),e.TgZ(59,"li")(60,"button",27),e.NdJ("click",function(){return i.previus()}),e._uU(61,"Anterior"),e.qZA()(),e.YNc(62,He,3,5,"li",24),e.TgZ(63,"li")(64,"button",27),e.NdJ("click",function(){return i.next()}),e._uU(65,"Siguiente"),e.qZA()(),e.TgZ(66,"li")(67,"button",27),e.NdJ("click",function(){return i.pagTo(i.cant-1)}),e._uU(68,"\xdaltimo"),e.qZA()()()()()()),2&t&&(e.xp6(13),e.Q6J("formGroup",i.form),e.xp6(6),e.Q6J("suggestions",i.filteredBusinesses)("dropdown",!0),e.xp6(7),e.Q6J("suggestions",i.filteredYear)("dropdown",!0),e.xp6(27),e.Q6J("ngForOf",i.db),e.xp6(9),e.Q6J("ngForOf",i.visiblePageNumbers()))},dependencies:[p.mk,p.sg,p.O5,d.JJ,d.JL,d.sg,d.u,I.Qc,Be.jx,p.uU],styles:["[_nghost-%COMP%]{width:90%!important;padding:1%}  .custom-autocomplete .p-autocomplete{width:100%;max-height:300px}  .custom-autocomplete .p-autocomplete-dropdown{width:10%;max-height:300px;background-color:#08a47c}  .select .form-select{width:50!important}"]}),s})();var Qe=_(9314);function je(s,r){if(1&s&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&s){const t=r.$implicit,i=r.index,n=e.oxw();e.xp6(1),e.AsE("+(",t.price,"UF x POM ",n.typex[i],")")}}function Ge(s,r){if(1&s&&(e.TgZ(0,"li")(1,"span"),e._uU(2),e.qZA(),e.TgZ(3,"span"),e._uU(4),e.qZA()()),2&s){const t=r.$implicit;e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.price)}}const Ke=[{path:"",component:xe.$,children:[{path:"home",component:Ue},{path:"rates",component:(()=>{class s{constructor(t,i){this.ratesService=t,this.router=i,this.types=["EyE reciclables de papel/cart\xf3n","EyE reciclables de metal","EyE reciclables de pl\xe1sticos","EyE no reciclables"],this.typex=["Papel/cart\xf3n","Metal","Pl\xe1stico","No Reciclable"],this.year=(new Date).getFullYear(),this.rates=[]}ngOnInit(){this.ratesService.getRates(this.year).subscribe({next:t=>{t.status&&(t.data.length<4&&u().fire({icon:"info",text:`Las tarifas del a\xf1o ${this.year} no han sido ingresadas. Por favor contacte al administrador`}).then(i=>{i.isConfirmed&&this.router.navigate(["/productor/home"])}),t.data.forEach(i=>{this.rates.push({name:this.types[i.type-1],price:i.price})}))},error:t=>{u().fire({icon:"error",text:"Algo sali\xf3 mal"}),this.router.navigate(["/productor/home"])}})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(v.z),e.Y36(f.F0))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-rates"]],decls:39,vars:2,consts:[["id","content"],["aria-label","breadcrumb",1,"breadcrumbs","d-none","d-lg-block"],[1,"breadcrumb"],[1,"breadcrumb-item"],["href","#"],["aria-hidden","true",1,"fa","fa-home"],["aria-current","page",1,"breadcrumb-item","active"],[1,"inicio"],[1,"box","box-inicio"],[1,"row"],[1,"col-12","col-md-7"],["src","assets/images/rigk_eq.png",1,"img-fluid"],[4,"ngFor","ngForOf"],[1,"col-12","col-md-5"],[1,"pt-4","pt-md-0","mt-3","mt-md-0","border-top","border-top-md-0"],[1,"list","list-tarifas","list-unstyled"],[1,"d-block","bg-blue","color-white"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),e._UZ(5,"i",5),e._uU(6," Inicio"),e.qZA()(),e.TgZ(7,"li",6),e._uU(8,"Tarifas"),e.qZA()()(),e.TgZ(9,"section",7)(10,"h1"),e._uU(11,"Tarifas"),e.qZA(),e.TgZ(12,"div",8)(13,"div",9)(14,"div",10)(15,"p"),e._uU(16," El costo anual que deber\xe1 pagar en marzo del a\xf1o correspondiente al cumplimiento: "),e._UZ(17,"img",11),e.qZA(),e._uU(18," donde: "),e.TgZ(19,"ul")(20,"li"),e._uU(21,"P es el precio tarifa UF por tonelada"),e.qZA(),e.TgZ(22,"li"),e._uU(23,"Q son las toneladas declaradas"),e.qZA()(),e._UZ(24,"br"),e._uU(25," Ejemplo: "),e._UZ(26,"br")(27,"br"),e.TgZ(28,"b"),e._uU(29,"Costo Anual ="),e.qZA(),e.YNc(30,je,2,2,"p",12),e.qZA(),e.TgZ(31,"div",13)(32,"div",14)(33,"p"),e._uU(34,"Las tarifas por subcategor\xeda son de car\xe1cter anual por lo que estar\xe1n vigentes por todo el a\xf1o 2023."),e.qZA(),e.TgZ(35,"ul",15)(36,"li",16),e._uU(37,"Tarifas por tonelada (UF)"),e.qZA(),e.YNc(38,Ge,5,2,"li",12),e.qZA()()()()()()()),2&t&&(e.xp6(30),e.Q6J("ngForOf",i.rates),e.xp6(8),e.Q6J("ngForOf",i.rates))},dependencies:[p.sg]}),s})()},{path:"form",component:Se},{path:"profile",component:Me},{path:"statements",component:$e},{path:"summary",component:q},{path:"faq",component:Qe.v},{path:"**",redirectTo:"home",pathMatch:"full"}]}];let Xe=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[f.Bz.forChild(Ke),f.Bz]}),s})();var We=_(4466);let et=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({providers:[p.H9],imports:[p.ez,Xe,We.m,d.u5,d.UX,I.WN]}),s})()}}]);