"use strict";(self.webpackChunkrigk_sg_web=self.webpackChunkrigk_sg_web||[]).push([[744],{9821:(ce,P,f)=>{f.d(P,{d:()=>e});var E=f(2340),M=f(529),O=f(8256);let e=(()=>{class S{constructor(c){this.http=c,this.url=`${E.N.API_V1_URL}/establishment`}getAllEstablishment(){return this.http.get(`${this.url}/all/`)}getInovice(c,T,Z,s){return this.http.post(`${this.url}/get/invoice/`,{invoice_number:c,treatment_type:T,material_type:Z,idGestor:s})}saveInvoice(c,T,Z,s,W,k,B,Y,H,Q,K){const C=new FormData;return C.append("vat",c),C.append("id_business",T),C.append("invoice_number",Z),C.append("id_detail",s),C.append("date_pr",W),C.append("value",k),C.append("valued_total",B),C.append("treatment",Y),C.append("id_material",H),C.append("IdGestor",K),C.append("file",Q,Q.name),this.http.post(`${this.url}/invoice/`,C)}addEstablishment(c,T,Z,s,W,k,B){return this.http.post(`${this.url}/add/`,{name:c,name_region:T,v_unica:Z,id_region:s,id_comuna:W,address:k,id_business:B})}deleteEstablishment(c){return this.http.delete(`${this.url}/delete/${c}`)}getEstablishment(c){return this.http.get(`${this.url}/${c}`)}getEstablishmentByID(c){return this.http.get(`${this.url}/get/${c}`)}getIdByEstablishment(c,T,Z,s){return this.http.get(`${this.url}/getIdByEstablishment/${c}/${T}/${Z}/${s}`)}getDeclarationEstablishment(){return this.http.get(`${this.url}/declaration/`)}getDeclarationEstablishmentByIdGestor(c){const T={headers:new M.WM({"Content-Type":"application/json"})};return this.http.post(`${this.url}/declarationByIdGestor/`,{idGestors:c},T)}getAllDeclarationEstablishments(){return this.http.get(`${this.url}/alldeclaration/`)}}return S.\u0275fac=function(c){return new(c||S)(O.LFG(M.eN))},S.\u0275prov=O.Yz7({token:S,factory:S.\u0275fac,providedIn:"root"}),S})()},3813:(ce,P,f)=>{f.d(P,{b:()=>e});var E=f(2340),M=f(529),O=f(8256);let e=(()=>{class S{constructor(c){this.http=c,this.url=`${E.N.API_V1_URL}/manager`}getAllManager(){return this.http.get(`${this.url}/all/`)}addManager(c,T,Z,s){return this.http.post(`${this.url}/add/`,{type_material:c,region:T,id_business:Z,id_region:s})}deleteManager(c){return this.http.delete(`${this.url}/delete/${c}`)}getManager(c){return this.http.get(`${this.url}/${c}`)}getAllMaterials(){return this.http.get(`${this.url}/allMaterials/`)}getAllTreatments(){return this.http.get(`${this.url}/allTreatments/`)}getAllRegions(){return this.http.get(`${this.url}/regiones/`)}getRegionFromID(c){return this.http.get(`${this.url}/regiones/${c}/`)}getAllCommunes(){return this.http.get(`${this.url}/comunas/`)}getCommunesFormatted(){return this.http.get(`${this.url}/communesFormatted/`)}getAllSubmaterial(){return this.http.get(`${this.url}/submaterial/`)}getAllSubmaterialFormatted(){return this.http.get(`${this.url}/submaterialFormatted/`)}getManagersByMaterials(c,T){const Z=c.join(",");return this.http.get(`${this.url}/materials/${Z}/region/${T}`)}downloadExcelTemplateInvoice(c){let T=new M.WM;return T=T.set("Accept","application/vnd.ms-excel"),this.http.post(`${this.url}/excel`,{idGestors:c},{headers:T,responseType:"blob"})}}return S.\u0275fac=function(c){return new(c||S)(O.LFG(M.eN))},S.\u0275prov=O.Yz7({token:S,factory:S.\u0275fac,providedIn:"root"}),S})()},3744:(ce,P,f)=>{f.r(P),f.d(P,{ManagerStatementModule:()=>St});var E=f(6895),M=f(5792),O=f(4135),e=f(8256);let S=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(o){return new(o||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-home"]],decls:22,vars:0,consts:[["id","content"],["aria-label","breadcrumb",1,"breadcrumbs","d-none","d-lg-block"],[1,"breadcrumb"],["aria-current","page",1,"breadcrumb-item"],["aria-hidden","true",1,"fa","fa-home"],[1,"inicio"],[1,"box","box-inicio"],[1,"row"],[1,"col-12","col-md-8"],[1,"h1"],[2,"visibility","hidden"]],template:function(o,t){1&o&&(e.TgZ(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3),e._UZ(4,"i",4),e._uU(5," Inicio"),e.qZA()()(),e.TgZ(6,"section",5)(7,"h1"),e._uU(8,"Inicio"),e.qZA(),e.TgZ(9,"div",6)(10,"div",7)(11,"div",8)(12,"h2",9),e._uU(13,"Bienvenido/a a M\xf3dulo de Gestores"),e.qZA(),e.TgZ(14,"p",10),e._uU(15,"Como parte de las obligaciones que establece la Ley REP, los Productores deben informar la cantidad de EyE no domiciliarios (POM) puestos en el mercado el a\xf1o anterior."),e.qZA(),e.TgZ(16,"p",10),e._uU(17,"ProREP pone a disposici\xf3n de sus socios la plataforma de declaraci\xf3n que dar\xe1 cumplimiento a la obligaci\xf3n de informar sus EyE."),e.qZA(),e.TgZ(18,"p",10),e._uU(19,"La informaci\xf3n deber\xe1 subirse en los meses de enero y febrero."),e.qZA(),e.TgZ(20,"p",10),e._uU(21,"En caso de tener dudas con respecto a su declaraci\xf3n puede ver los tutoriales y preguntas frecuentes."),e.qZA()()()()()())}}),n})();var q=f(5861),c=f(433),T=f(3224),Z=f(5226),s=f.n(Z),W=f(371),k=f(9821),B=f(8195),Y=f(1770),H=f(805);function Q(n,u){if(1&n&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&n){const o=u.$implicit;e.xp6(1),e.Oqu(o.label)}}function K(n,u){if(1&n&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&n){const o=u.$implicit;e.xp6(1),e.Oqu(o.label)}}function C(n,u){if(1&n&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&n){const o=u.$implicit;e.xp6(1),e.Oqu(o.label)}}function Ee(n,u){if(1&n&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&n){const o=u.$implicit;e.xp6(1),e.Oqu(o.label)}}function Fe(n,u){if(1&n&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&n){const o=u.$implicit;e.xp6(1),e.Oqu(o.label)}}function xe(n,u){if(1&n&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&n){const o=u.$implicit;e.xp6(1),e.Oqu(o.label)}}function Ne(n,u){1&n&&(e.ynx(0),e.TgZ(1,"th"),e._uU(2,"Aprobar"),e.qZA(),e.BQk())}function qe(n,u){1&n&&(e.TgZ(0,"span"),e._uU(1,"Por aprobar"),e.qZA())}function Me(n,u){1&n&&(e.TgZ(0,"span"),e._uU(1,"Aprobado"),e.qZA())}const ye=function(n){return{"no-pointer":n}};function Ie(n,u){if(1&n){const o=e.EpF();e.ynx(0),e.TgZ(1,"td")(2,"a",63),e.NdJ("click",function(){e.CHM(o);const r=e.oxw(),a=r.index,l=r.$implicit,p=e.oxw();return p.handleClick(a,l.STATE_GESTOR),e.KtG(p.selectedDeclarationsCount=0)}),e._UZ(3,"i",64),e.qZA()(),e.BQk()}if(2&n){const o=e.oxw().$implicit;e.xp6(2),e.Q6J("ngClass",e.VKq(3,ye,0!==o.STATE_GESTOR)),e.uIk("data-bs-target",0==o.STATE_GESTOR?"#infoModal":null),e.xp6(1),e.Q6J("ngClass",0==o.STATE_GESTOR?"color-verde-opaco":"color-verde")}}function Ue(n,u){if(1&n){const o=e.EpF();e.TgZ(0,"tr")(1,"td")(2,"section",62)(3,"input",23),e.NdJ("ngModelChange",function(r){const l=e.CHM(o).$implicit;return e.KtG(l.isChecked=r)})("change",function(){e.CHM(o);const r=e.oxw();return r.updateCheckboxSelection(),e.KtG(r.index=0)}),e.qZA()()(),e.TgZ(4,"td"),e._uU(5),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.qZA(),e.TgZ(8,"td"),e._uU(9),e.qZA(),e.TgZ(10,"td"),e._uU(11),e.qZA(),e.TgZ(12,"td"),e._uU(13),e.qZA(),e.TgZ(14,"td"),e._uU(15),e.qZA(),e.TgZ(16,"td"),e._uU(17),e.ALo(18,"date"),e.ALo(19,"date"),e.qZA(),e.TgZ(20,"td"),e.YNc(21,qe,2,0,"span",24),e.YNc(22,Me,2,0,"span",24),e.qZA(),e.TgZ(23,"td"),e._uU(24),e.qZA(),e.TgZ(25,"td"),e._uU(26),e.qZA(),e.YNc(27,Ie,4,5,"ng-container",24),e.qZA()}if(2&n){const o=u.$implicit,t=e.oxw();e.xp6(3),e.Q6J("disabled",0!=o.STATE_GESTOR)("ngModel",o.isChecked),e.xp6(2),e.Oqu(o.NAME_BUSINESS),e.xp6(2),e.Oqu(o.NAME_GESTOR),e.xp6(2),e.Oqu(o.NAME_ESTABLISHMENT_REGION),e.xp6(2),e.Oqu(o.TipoTratamiento),e.xp6(2),e.Oqu(o.PRECEDENCE),e.xp6(2),e.Oqu(o.TYPE_RESIDUE),e.xp6(2),e.Oqu(o.FechaMostrar?o.FechaMostrar.length>7?e.xi3(18,14,o.FechaMostrar,"dd-MM-yyyy"):e.xi3(19,17,o.FechaMostrar,"MM-yyyy"):""),e.xp6(4),e.Q6J("ngIf",0==o.STATE_GESTOR),e.xp6(1),e.Q6J("ngIf",0!=o.STATE_GESTOR),e.xp6(2),e.Oqu(t.replaceDot(o.VALUE)),e.xp6(2),e.Oqu(t.formatValue(o.VALUE_DECLARATE)),e.xp6(1),e.Q6J("ngIf",!t.anyCheckboxSelected)}}const De=function(n,u){return{"btn-info":n,"btn-primary":u}};function Re(n,u){if(1&n){const o=e.EpF();e.TgZ(0,"li")(1,"button",65),e.NdJ("click",function(){const a=e.CHM(o).$implicit,l=e.oxw();return e.KtG(l.pagTo(a))}),e._uU(2),e.qZA()()}if(2&n){const o=u.$implicit,t=e.oxw();e.xp6(1),e.Q6J("ngClass",e.WLB(2,De,t.pos===o+1,t.pos!==o+1)),e.xp6(1),e.Oqu(o+1)}}function Oe(n,u){1&n&&(e.TgZ(0,"p"),e._uU(1,"Debe ingresar un n\xfamero de factura."),e.qZA())}function we(n,u){if(1&n&&(e.TgZ(0,"div",66),e.YNc(1,Oe,2,0,"p",24),e.qZA()),2&n){const o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.userForm.controls.invoiceNumber.errors.required)}}function Pe(n,u){1&n&&(e.TgZ(0,"p"),e._uU(1,"El rut de la empresa es requerido."),e.qZA())}function ke(n,u){if(1&n&&(e.TgZ(0,"div",48),e.YNc(1,Pe,2,0,"p",24),e.qZA()),2&n){const o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.userForm.controls.rut.errors.required)}}function Be(n,u){1&n&&e._UZ(0,"input",67)}function We(n,u){if(1&n&&(e.TgZ(0,"option",71),e._uU(1),e.qZA()),2&n){const o=u.$implicit;e.Q6J("value",o.ID),e.xp6(1),e.Oqu(o.NAME)}}function Ge(n,u){if(1&n&&(e.TgZ(0,"select",68)(1,"option",69),e._uU(2,"Seleccione Reciclador"),e.qZA(),e.YNc(3,We,2,2,"option",70),e.qZA()),2&n){const o=e.oxw();e.Q6J("disabled",""==o.userForm.controls.invoiceNumber.value),e.xp6(3),e.Q6J("ngForOf",o.dbBusiness)}}function Je(n,u){1&n&&(e.TgZ(0,"p"),e._uU(1," Reciclador requerido. "),e.qZA())}function $e(n,u){1&n&&(e.TgZ(0,"p"),e._uU(1," Por favor, seleccione un reciclador. "),e.qZA())}function Ve(n,u){1&n&&(e.TgZ(0,"p"),e._uU(1,"El rut de la empresa es requerido."),e.qZA())}function Le(n,u){if(1&n&&(e.TgZ(0,"div",48),e.YNc(1,Ve,2,0,"p",24),e.qZA()),2&n){const o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.userForm.controls.treatmentType.errors.required)}}function Ye(n,u){1&n&&(e.TgZ(0,"p"),e._uU(1,"El rut de la empresa es requerido."),e.qZA())}function Qe(n,u){if(1&n&&(e.TgZ(0,"div",48),e.YNc(1,Ye,2,0,"p",24),e.qZA()),2&n){const o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.userForm.controls.material.errors.required)}}function je(n,u){1&n&&(e.TgZ(0,"p"),e._uU(1,"Debe ingresar una fecha. "),e.qZA())}function ze(n,u){1&n&&(e.TgZ(0,"p"),e._uU(1,"La fecha no puede ser futura."),e.qZA())}function He(n,u){if(1&n&&(e.TgZ(0,"div",66),e.YNc(1,je,2,0,"p",24),e.YNc(2,ze,2,0,"p",24),e.qZA()),2&n){const o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.userForm.controls.entryDate.errors.required),e.xp6(1),e.Q6J("ngIf",o.userForm.controls.entryDate.errors.futureDate)}}function Ke(n,u){1&n&&(e.TgZ(0,"p"),e._uU(1,"Debe ingresar un peso total."),e.qZA())}function Xe(n,u){1&n&&(e.TgZ(0,"p"),e._uU(1,"Debe ingresar un n\xfamero v\xe1lido (con coma)."),e.qZA())}function et(n,u){1&n&&(e.TgZ(0,"p"),e._uU(1,"El valor debe ser mayor que cero."),e.qZA())}function tt(n,u){if(1&n&&(e.TgZ(0,"div",66),e.YNc(1,Ke,2,0,"p",24),e.YNc(2,Xe,2,0,"p",24),e.YNc(3,et,2,0,"p",24),e.qZA()),2&n){const o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.userForm.controls.totalWeight.errors.required),e.xp6(1),e.Q6J("ngIf",o.userForm.controls.totalWeight.errors.pattern),e.xp6(1),e.Q6J("ngIf",o.userForm.controls.totalWeight.errors.minStringValue)}}function ot(n,u){1&n&&(e.TgZ(0,"p"),e._uU(1,"Debe ingresar un peso valorizado."),e.qZA())}function rt(n,u){1&n&&(e.TgZ(0,"p"),e._uU(1,"Debe ingresar un n\xfamero v\xe1lido (Con coma)."),e.qZA())}function at(n,u){1&n&&(e.TgZ(0,"p"),e._uU(1,"El valor debe ser mayor que cero."),e.qZA())}function nt(n,u){if(1&n&&(e.TgZ(0,"div",66),e.YNc(1,ot,2,0,"p",24),e.YNc(2,rt,2,0,"p",24),e.YNc(3,at,2,0,"p",24),e.qZA()),2&n){const o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.userForm.controls.valuedWeight.errors.required),e.xp6(1),e.Q6J("ngIf",o.userForm.controls.valuedWeight.errors.pattern),e.xp6(1),e.Q6J("ngIf",o.userForm.controls.valuedWeight.errors.minStringValue)}}function it(n,u){1&n&&(e.TgZ(0,"div",48)(1,"p"),e._uU(2,"El peso remanente no puede ser menor que cero."),e.qZA()())}function st(n,u){1&n&&(e.TgZ(0,"p"),e._uU(1,"El formato del archivo debe ser PDF, JPEG o JPG."),e.qZA())}function lt(n,u){1&n&&(e.TgZ(0,"p"),e._uU(1,"El tama\xf1o del archivo no debe superar 1 MB."),e.qZA())}function ct(n,u){if(1&n&&(e.TgZ(0,"div",48),e.YNc(1,st,2,0,"p",24),e.YNc(2,lt,2,0,"p",24),e.qZA()),2&n){const o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.userForm.controls.attachment.errors.invalidFileType),e.xp6(1),e.Q6J("ngIf",o.userForm.controls.attachment.errors.invalidFileSize)}}let ut=(()=>{class n{constructor(o,t,r,a,l){this.productorService=o,this.establishmentService=t,this.businessService=r,this.fb=a,this.cdr=l,this.disableWeightFields=!0,this.dbStatements=[],this.db=[],this.pos=1,this.business_name=[],this.establishment_name=[],this.material_name=[],this.treatment_name=[],this.years=[],this.state=[],this.cant=0,this.filteredStatements=[],this.filteredBusinesses=[],this.filteredMaterial=[],this.filteredYear=[],this.filteredBusinessesManager=[],this.filteredTreatment=[],this.filteredState=[],this.selectedBusiness="-1",this.selectedMaterial="-1",this.selectedYear="-1",this.selectedTreatment="-1",this.selectedState="-1",this.selectAllChecked=!1,this.autoFilter=!0,this.isRemainingWeightNegative=!1,this.anyCheckboxSelected=!1,this.gestor_name=[],this.selectedGestor="-1",this.index=0,this.userForm=this.fb.group({empresaGestor:["",c.kI.required],invoiceNumber:["",[c.kI.required]],rut:["",[c.kI.required]],reciclador:["",[this.validRecycler]],treatmentType:["",[c.kI.required]],material:["",[c.kI.required]],entryDate:["",[c.kI.required,this.pastDateValidator()]],totalWeight:["",[c.kI.required,this.minStringValue(0),c.kI.pattern(/^[0-9]+(,[0-9]+)?$/)]],declarateWeight:[""],valuedWeight:["",[c.kI.required,this.minStringValue(0),c.kI.pattern(/^[0-9]+(,[0-9]+)?$/)]],remainingWeight:[""],asoc:[""],declarated:[""],attachment:[null,[c.kI.required,this.fileTypeValidator,this.fileSizeValidator]]}),this.dbBusiness=[],this.selectedDeclarationsCount=0,this.selectedWeight=0,this.isAnyCheckboxSelected=!1,this.businessNoFound=!0}ngOnInit(){this.userData=JSON.parse(sessionStorage.getItem("user")),this.loadStatements().then(()=>{this.filter(),this.pagTo(this.pos-1)}),this.userForm.controls.valuedWeight.disable(),this.userForm.controls.totalWeight.disable(),this.userForm.controls.reciclador.disable()}loadStatements(){return new Promise(o=>{const t=JSON.parse(sessionStorage.getItem("user")).ID_BUSINESS;s().fire({title:"Cargando Datos",text:"Se est\xe1n recuperando datos",timerProgressBar:!0,showConfirmButton:!1,allowEscapeKey:!1,allowOutsideClick:!1}),s().showLoading(),this.establishmentService.getDeclarationEstablishmentByIdGestor(t).subscribe(r=>{r.status&&(r.data=r.data.map(a=>(a.FechaParaOrdenar=""!=a.MesRetiro&&null!=a.MesRetiro?a.MesRetiro:a.FechaRetiro,a)),r.data=r.data.filter(a=>null!=a.TipoTratamiento),r.data=r.data.sort((a,l)=>{const p=new Date(l.FechaRetiro).getTime()-new Date(a.FechaRetiro).getTime();return 0===p?l.ID_DETAIL-a.ID_DETAIL:p}),r.data.forEach(a=>{a.isChecked=!1,a.FechaMostrar=""!=a.MesRetiro&&null!=a.MesRetiro?a.MesRetiro:a.FechaRetiro,-1==this.business_name.indexOf(a.NAME_BUSINESS)&&this.business_name.push(a.NAME_BUSINESS),-1==this.establishment_name.indexOf(a.NAME_ESTABLISHMENT_REGION)&&this.establishment_name.push(a.NAME_ESTABLISHMENT_REGION),-1==this.years.indexOf(a.FechaRetiroTipeada)&&this.years.push(a.FechaRetiroTipeada),-1==this.material_name.indexOf(a.PRECEDENCE)&&this.material_name.push(a.PRECEDENCE),-1===this.treatment_name.indexOf(a.TipoTratamiento)&&this.treatment_name.push(a.TipoTratamiento),-1==this.state.indexOf(a.STATE_GESTOR)&&this.state.push(a.STATE_GESTOR),-1==this.gestor_name.indexOf(a.NAME_GESTOR)&&this.gestor_name.push(a.NAME_GESTOR)}),this.years.sort((a,l)=>l-a),this.dbStatements=r.data,this.cant=Math.ceil(this.dbStatements.length/10),this.db=this.dbStatements.slice(10*(this.pos-1),10*this.pos).sort((a,l)=>{const p=new Date(l.FechaRetiro).getTime()-new Date(a.FechaRetiro).getTime();return 0===p?l.ID_DETAIL-a.ID_DETAIL:p}),s().close()),o()})})}openApprovalModal(){const o=this.db.filter(t=>t.isChecked&&0==t.STATE_GESTOR);o.length>0?(this.userForm.patchValue({declarated:this.selectedWeight,treatmentType:o[0].TipoTratamiento,material:o[0].PRECEDENCE,empresaGestor:o[0].NAME_GESTOR}),document.getElementById("openModalButton")?.click()):console.log("error")}filter(o=!1){const t=this.selectedBusiness?.value||this.selectedBusiness,r=this.selectedGestor?.value||this.selectedGestor,a=this.selectedTreatment?.value||this.selectedTreatment,l=this.selectedMaterial?.value||this.selectedMaterial,p=this.selectedYear?.value||this.selectedYear,i=this.selectedState?.value||this.selectedState;if(o&&!this.autoFilter)return;const _=parseInt(i);this.filteredStatements=this.dbStatements.filter(m=>{const v=parseInt(m.STATE_GESTOR);return!("-1"!==t&&m.NAME_BUSINESS!==t||"-1"!==l&&m.PRECEDENCE!==l||"-1"!==a&&m.TipoTratamiento!==a||"-1"!==p&&m.FechaRetiroTipeada!==p||"-1"!==i&&v!==_||"-1"!==r&&m.NAME_GESTOR!==r)}),this.db=this.filteredStatements.slice(0,10).sort((m,v)=>new Date(v.FechaRetiro).getTime()-new Date(m.FechaRetiro).getTime()||v.ID_DETAIL-m.ID_DETAIL),this.cant=Math.ceil(this.filteredStatements.length/10),this.selectedDeclarationsCount=0,this.selectedWeight=0,this.selectAllChecked=!1,this.filteredStatements.forEach(m=>{m.isChecked=0!=m.STATE_GESTOR&&m.isChecked}),this.anyCheckboxSelected=this.filteredStatements.some(m=>m.isChecked&&0==parseInt(m.STATE_GESTOR)),this.cdr.detectChanges()}filterBusinesses(o){const t=o.query.toLowerCase();this.filteredBusinesses=this.business_name.filter(r=>r.toLowerCase().includes(t)).map(r=>({label:r,value:r})).sort((r,a)=>r.label.localeCompare(a.label)),0===this.filteredBusinesses.length?this.filteredBusinesses=[{label:"Todos",value:"-1"}]:this.filteredBusinesses.unshift({label:"Todos",value:"-1"})}filterBusinessesManager(o){const t=o.query.toLowerCase();this.filteredBusinessesManager=this.gestor_name.filter(r=>r.toLowerCase().includes(t)).map(r=>({label:r,value:r})).sort((r,a)=>r.label.localeCompare(a.label)),0===this.filteredBusinessesManager.length?this.filteredBusinessesManager=[{label:"Todos",value:"-1"}]:this.filteredBusinessesManager.unshift({label:"Todos",value:"-1"})}filterTreatment(o){const t=o.query.toLowerCase();this.filteredTreatment=this.treatment_name.filter(r=>r.toLowerCase().includes(t)).map(r=>({label:r,value:r})).sort((r,a)=>r.label.localeCompare(a.label)),0===this.filteredTreatment.length?this.filteredTreatment=[{label:"Todos",value:"-1"}]:this.filteredTreatment.unshift({label:"Todos",value:"-1"})}filterMaterial(o){const t=o.query.toLowerCase();this.filteredMaterial=this.material_name.filter(r=>r.toLowerCase().includes(t)).map(r=>({label:r,value:r})).sort((r,a)=>r.label.localeCompare(a.label)),0===this.filteredMaterial.length?this.filteredMaterial=[{label:"Todos",value:"-1"}]:this.filteredMaterial.unshift({label:"Todos",value:"-1"})}filterYear(o){const t=o.query.toString();this.filteredYear=this.years.filter(r=>r.toString().includes(t)).map(r=>({label:r.toString(),value:r.toString()})),this.filteredYear.length>0?this.filteredYear.unshift({label:"Todos",value:"-1"}):this.filteredYear=[{label:"Todos",value:"-1"}]}filterState(o){const t=o.query.toLowerCase();this.filteredState=this.state.filter(r=>this.getStateText(r).toLowerCase().includes(t)).map(r=>({label:this.getStateText(r),value:r.toString()})),this.filteredState.length>0?this.filteredState.unshift({label:"Todos",value:"-1"}):this.filteredState=[{label:"Todos",value:"-1"}]}filter_two(o=!1){const t=this.selectedBusiness?.value||this.selectedBusiness,r=this.selectedGestor?.value||this.selectedGestor,a=this.selectedTreatment?.value||this.selectedTreatment,l=this.selectedMaterial?.value||this.selectedMaterial,p=this.selectedYear?.value||this.selectedYear,i=this.selectedState?.value||this.selectedState;if(o&&!this.autoFilter)return;const _=parseInt(i);this.filteredStatements=this.dbStatements.filter(m=>{const v=parseInt(m.STATE_GESTOR);return!("-1"!==t&&m.NAME_BUSINESS!==t||"-1"!==l&&m.PRECEDENCE!==l||"-1"!==a&&m.TipoTratamiento!==a||"-1"!==p&&m.FechaRetiroTipeada!==p||"-1"!==i&&v!==_||"-1"!==r&&m.NAME_GESTOR!==r)}),this.db=this.filteredStatements.slice(0,10).sort((m,v)=>new Date(v.FechaRetiro).getTime()-new Date(m.FechaRetiro).getTime()||v.ID_DETAIL-m.ID_DETAIL),this.cant=Math.ceil(this.filteredStatements.length/10)}updateFilters(){const o=this.selectedBusiness?.value||this.selectedBusiness,t=this.selectedGestor?.value||this.selectedGestor,r=this.selectedTreatment?.value||this.selectedTreatment,a=this.selectedMaterial?.value||this.selectedMaterial,l=this.selectedYear?.value||this.selectedYear,p=this.selectedState?.value||this.selectedState;this.business_name=this.dbStatements.filter(i=>!("-1"!==r&&i.TipoTratamiento!==r||"-1"!==a&&i.PRECEDENCE!==a||"-1"!==l&&i.FechaRetiroTipeada!==l||"-1"!==p&&parseInt(i.STATE_GESTOR)!==parseInt(p)&&void 0!==i.STATE_GESTOR||"-1"!==t&&i.NAME_GESTOR!==t)).map(i=>i.NAME_BUSINESS).filter((i,_,m)=>m.indexOf(i)===_),this.treatment_name=this.dbStatements.filter(i=>!("-1"!==o&&i.NAME_BUSINESS!==o||"-1"!==a&&i.PRECEDENCE!==a||"-1"!==l&&i.FechaRetiroTipeada!==l||"-1"!==p&&parseInt(i.STATE_GESTOR)!==parseInt(p)&&void 0!==i.STATE_GESTOR||"-1"!==t&&i.NAME_GESTOR!==t)).map(i=>i.TipoTratamiento).filter((i,_,m)=>m.indexOf(i)===_),this.material_name=this.dbStatements.filter(i=>!("-1"!==o&&i.NAME_BUSINESS!==o||"-1"!==r&&i.TipoTratamiento!==r||"-1"!==l&&i.FechaRetiroTipeada!==l||"-1"!==p&&parseInt(i.STATE_GESTOR)!==parseInt(p)&&void 0!==i.STATE_GESTOR||"-1"!==t&&i.NAME_GESTOR!==t)).map(i=>i.PRECEDENCE).filter((i,_,m)=>m.indexOf(i)===_),this.years=this.dbStatements.filter(i=>!("-1"!==o&&i.NAME_BUSINESS!==o||"-1"!==r&&i.TipoTratamiento!==r||"-1"!==a&&i.PRECEDENCE!==a||"-1"!==p&&parseInt(i.STATE_GESTOR)!==parseInt(p)&&void 0!==i.STATE_GESTOR||"-1"!==t&&i.NAME_GESTOR!==t)).map(i=>i.FechaRetiroTipeada).filter((i,_,m)=>m.indexOf(i)===_).sort((i,_)=>_-i),this.state=this.dbStatements.filter(i=>!("-1"!==o&&i.NAME_BUSINESS!==o||"-1"!==r&&i.TipoTratamiento!==r||"-1"!==a&&i.PRECEDENCE!==a||"-1"!==l&&i.FechaRetiroTipeada!==l||"-1"!==t&&i.NAME_GESTOR!==t)).map(i=>parseInt(i.STATE_GESTOR)).filter((i,_,m)=>m.indexOf(i)===_),this.gestor_name=this.dbStatements.filter(i=>!("-1"!==o&&i.NAME_BUSINESS!==o||"-1"!==r&&i.TipoTratamiento!==r||"-1"!==a&&i.PRECEDENCE!==a||"-1"!==l&&i.FechaRetiroTipeada!==l||"-1"!==p&&parseInt(i.STATE_GESTOR)!==parseInt(p)&&void 0!==i.STATE_GESTOR)).map(i=>i.NAME_GESTOR).filter((i,_,m)=>m.indexOf(i)===_)}reset(){this.loadStatements().then(()=>{this.filter(),this.pagTo(this.pos-1)}),this.userForm.reset({reciclador:""})}reset_nocheck(){this.userForm.reset({reciclador:""})}pagTo(o){this.pos=o+1,this.db=this.filteredStatements.slice(10*o,10*(o+1)).sort((t,r)=>{const a=new Date(r.FechaRetiro).getTime()-new Date(t.FechaRetiro).getTime();return 0===a?r.ID_DETAIL-t.ID_DETAIL:a})}next(){this.pos>=this.cant||(this.pos++,this.db=this.filteredStatements.slice(10*(this.pos-1),10*this.pos).sort((o,t)=>{const r=new Date(t.FechaRetiro).getTime()-new Date(o.FechaRetiro).getTime();return 0===r?t.ID_DETAIL-o.ID_DETAIL:r}))}previus(){this.pos-1<=0||this.pos>=this.cant+1||(this.pos=this.pos-1,this.db=this.filteredStatements.slice(10*(this.pos-1),10*this.pos).sort((o,t)=>{const r=new Date(t.FechaRetiro).getTime()-new Date(o.FechaRetiro).getTime();return 0===r?t.ID_DETAIL-o.ID_DETAIL:r}))}setArrayFromNumber(){return new Array(this.cant)}visiblePageNumbers(){const o=this.setArrayFromNumber().length,t=[];if(o<=15)for(let r=0;r<o;r++)t.push(r);else{let r=Math.max(0,this.pos-Math.floor(7.5)),a=Math.min(o-1,r+14);a-r+1<15&&(a=o-1,r=Math.max(0,a-14));for(let l=r;l<=a;l++)t.push(l)}return t}getStateText(o){return 0===o?"Por Aprobar":"Aprobado"}handleClick(o,t){this.dbBusiness=[],0===t&&(this.onMaterialTreatmentChange(o),this.index=o)}fileTypeValidator(o){const t=o.value;return t&&!["application/pdf","image/jpeg"].includes(t.type)?{invalidFileType:!0}:null}fileSizeValidator(o){const t=o.value;return t&&t.size>1048576?{invalidFileSize:!0}:null}onFileSelected(o){const t=o.target;if(t&&t.files&&t.files.length>0){const r=t.files[0];this.fileName=r.name,this.fileBuffer=r,this.selectedFile=t.files[0];const a=["pdf","jpeg","jpg"],l=this.selectedFile.name.split(".").pop()?.toLowerCase()||"";a.includes(l)?r.size>1048576?(this.userForm.controls.attachment.setErrors({invalidFileSize:!0}),this.userForm.controls.attachment.markAsTouched()):(this.userForm.controls.attachment.setErrors(null),this.userForm.controls.attachment.markAsTouched()):(this.userForm.controls.attachment.setErrors({invalidFileType:!0}),this.userForm.controls.attachment.markAsTouched())}else this.selectedFile=null}saveInvoice(o){var t=this;return(0,q.Z)(function*(){if(!t.selectedFile)return void console.error("No hay archivo seleccionado");let{rut:r,invoiceNumber:a,entryDate:l,valuedWeight:p,reciclador:i}=t.userForm.value;const _=parseFloat(t.userForm.controls.totalWeight.value.replace(",",".")),m=parseFloat(p.replace(",",".")),v=t.filteredStatements.filter(A=>A.isChecked&&0==A.STATE_GESTOR),y=v.length>0?v:[t.db[o]];s().fire({title:"Cargando Datos",text:"Se est\xe1n recuperando datos",timerProgressBar:!0,showConfirmButton:!1,allowEscapeKey:!1,allowOutsideClick:!1});try{const A=y.reduce((F,D)=>F+parseFloat(D.VALUE),0);for(const F of y){const{TREATMENT_TYPE_NUMBER:D,PRECEDENCE_NUMBER:h,ID_DETAIL:d,VALUE:g,IdGestor:R}=F,G=(parseFloat(g)/A*m).toFixed(2);(yield t.establishmentService.saveInvoice(r,i,a,d,l,G,_,D,h,t.selectedFile,R).toPromise()).status&&t.updateItemState(d,G)}s().close(),yield t.showSuccessMessage(y.length>1)}catch(A){s().close(),console.error("Error:",A)}})()}updateItemState(o,t){const r=this.db.find(a=>a.ID_DETAIL===o);if(r){r.STATE_GESTOR=1;const a=parseFloat(t);r.VALUE_DECLARATE=a%1==0?a.toString().replace(".",","):a.toFixed(2).replace(".",",")}this.cdr.detectChanges()}showSuccessMessage(o){return(0,q.Z)(function*(){yield s().fire({title:o?"Las facturas fueron guardadas exitosamente":"La factura fue guardada exitosamente",icon:"success",showConfirmButton:!0})})()}onChangeVAT(o){this.dbBusiness=[],this.businessService.getBusinessByVAT(o.value).subscribe(t=>{this.dbBusiness=t.status||[],this.userForm.controls.reciclador.enable(),this.businessNoFound=!1,0==this.dbBusiness.length?(this.businessNoFound=!0,this.userForm.controls.reciclador.setValue("")):(this.businessNoFound=!1,this.userForm.controls.reciclador.setValue(""))})}formatNumber(o){return null==o?"":Number.isInteger(o)?o.toString():o.toLocaleString("es")}numberOnly(o){["Backspace","Tab","End","Home","ArrowLeft","ArrowRight","Delete"].includes(o.key)||new RegExp("^[0-9]+$").test(o.key)||o.preventDefault()}onRUTChange(o){var t=this;return(0,q.Z)(function*(){const r=t.userForm.controls.invoiceNumber.value,a=t.db[o].TREATMENT_TYPE_NUMBER,l=t.db[o].PRECEDENCE_NUMBER,p=t.db[o].IdGestor;try{const i=yield t.establishmentService.getInovice(r,a,l,p).toPromise();i.status?(t.businessNoFound=!0,t.userForm.controls.totalWeight.setValue(t.formatNumber(i.data[0]?.invoice_value)),t.userForm.controls.declarateWeight.setValue(t.formatNumber(i.data[0].value_declarated)),t.userForm.controls.asoc.setValue(0!=t.selectedDeclarationsCount?i.data[0].num_asoc+t.selectedDeclarationsCount:i.data[0].num_asoc+1),parseInt(t.userForm.controls.asoc.value||"0")>1&&0==t.selectedDeclarationsCount||i.data[0].num_asoc>0?r?(t.userForm.controls.reciclador.setValue(i.data[0]?.NAME),t.userForm.controls.rut.setValue(i.data[0]?.RUT),t.userForm.controls.valuedWeight.enable(),t.userForm.controls.reciclador.enable(),t.userForm.controls.totalWeight.disable(),t.userForm.controls.rut.enable()):(t.userForm.controls.reciclador.enable(),t.userForm.controls.rut.enable(),t.userForm.controls.reciclador.setValue(""),t.userForm.controls.rut.setValue(""),t.userForm.controls.valuedWeight.disable()):r?(t.userForm.controls.valuedWeight.enable(),t.userForm.controls.totalWeight.enable(),t.userForm.controls.reciclador.setValue(i.data[0]?.NAME),t.userForm.controls.rut.setValue(i.data[0]?.RUT),t.userForm.controls.reciclador.enable(),t.userForm.controls.rut.enable()):(t.userForm.controls.valuedWeight.disable(),t.userForm.controls.totalWeight.disable(),t.userForm.controls.reciclador.enable(),t.userForm.controls.rut.enable(),t.userForm.controls.reciclador.setValue(""),t.userForm.controls.rut.setValue(""))):(t.resetFormControls(),s().fire({icon:"error",text:i.msg}))}catch{t.resetFormControls()}t.userForm.controls.valuedWeight.updateValueAndValidity(),t.userForm.controls.totalWeight.updateValueAndValidity()})()}resetFormControls(){this.userForm.controls.totalWeight.setValue(""),this.userForm.controls.declarateWeight.setValue(""),this.userForm.controls.reciclador.setValue(""),this.userForm.controls.rut.setValue(""),this.userForm.controls.asoc.setValue(""),this.userForm.controls.remainingWeight.setValue(""),this.userForm.controls.valuedWeight.disable(),this.userForm.controls.totalWeight.disable(),this.userForm.controls.reciclador.disable(),this.userForm.controls.rut.disable()}onMaterialTreatmentChange(o){var t=this;return(0,q.Z)(function*(){t.userForm.controls.treatmentType.setValue(t.db[o].TipoTratamiento),t.userForm.controls.material.setValue(t.db[o].PRECEDENCE),t.userForm.controls.empresaGestor.setValue(t.db[o].NAME_GESTOR),t.userForm.controls.declarated.setValue(t.db[o].VALUE?.toString().replace(".",","))})()}verifyRut(o){return(0,T.validate)(o.value)?null:{rut:!0}}isTotalWeightEditable(){return!!this.userForm.controls.invoiceNumber.value&&!!this.userForm.controls.rut.value}getNumericValue(o){return o&&o.value?+o.value.toString().replace(",","."):0}calculateRemainingWeight(){const o=this.userForm.get("totalWeight"),t=this.userForm.get("valuedWeight"),r=this.userForm.get("declarateWeight"),i=this.getNumericValue(o)-this.getNumericValue(t)-this.getNumericValue(r);return this.isRemainingWeightNegative=i<0,i.toFixed(2).replace(".",",")}replaceDot(o){return 2==o.toString().split(".").length?o&&parseFloat(o).toFixed(2).replace(".",","):o&&o.toString().replace(".",",")}minStringValue(o){return t=>{if(!t.value)return null;const r=parseFloat(t.value.replace(",","."));return isNaN(r)||r<=o?{minStringValue:{value:t.value}}:null}}formatValue(o){return null==o?"":o%1==0?o.toString():o.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})}pastDateValidator(){return o=>{const t=new Date(o.value),r=new Date;return r.setHours(0,0,0,0),t>r?{futureDate:{value:o.value}}:null}}updateCheckboxSelection(){const o=this.db.find(a=>a.isChecked)?.NAME_GESTOR;this.filteredStatements=this.dbStatements.filter(a=>0===a.STATE_GESTOR&&a.NAME_GESTOR===o);const t=this.filteredStatements.filter(a=>a.isChecked&&0==a.STATE_GESTOR);this.anyCheckboxSelected=t.length>0,this.selectedDeclarationsCount=t.length;let r=t.reduce((a,l)=>a+parseFloat(l.VALUE),0);this.selectedWeight=r%1==0?r.toLocaleString("es-ES"):r.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2}),t.length>0?(this.selectedGestor=o,this.selectedState="0",this.disableFilters=!0,this.updateFilters()):(this.selectedTreatment="-1",this.selectedMaterial="-1",this.selectedState="-1",this.selectedGestor="-1",this.disableFilters=!1,this.filter_two(),this.updateFilters(),this.pagTo(0)),this.isAnyCheckboxSelected=t.length>0,1==t.length&&(this.filter_two(),this.updateFilters(),this.pagTo(0))}selectAllCheckboxes(o){this.filteredStatements.forEach(t=>{0==t.STATE_GESTOR&&(t.isChecked=o)}),this.db=this.filteredStatements.slice(10*(this.pos-1),10*this.pos),this.updateCheckboxSelection()}onSelectAllCheckboxChange(o){const t=o.target;this.filteredStatements.forEach(l=>{0==l.STATE_GESTOR&&(l.isChecked=t.checked)}),this.db=this.filteredStatements.slice(10*(this.pos-1),10*this.pos);const r=this.filteredStatements.filter(l=>l.isChecked&&0==l.STATE_GESTOR);this.anyCheckboxSelected=this.filteredStatements.some(l=>l.isChecked&&0==l.STATE_GESTOR),this.cdr.detectChanges(),this.selectedDeclarationsCount=r.length,this.disableFilters=0!=this.selectedDeclarationsCount;let a=r.reduce((l,p)=>l+parseFloat(p.VALUE),0);this.selectedWeight=a%1==0?a.toLocaleString("es-ES"):a.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})}validRecycler(o){return""===o.value?{invalidRecycler:!0}:null}}return n.\u0275fac=function(o){return new(o||n)(e.Y36(W.u),e.Y36(k.d),e.Y36(B.m),e.Y36(c.qu),e.Y36(e.sBO))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-statements"]],decls:213,vars:43,consts:[[1,"container","mt-4"],["aria-label","breadcrumb",1,"breadcrumbs","d-none","d-lg-block"],[1,"breadcrumb"],[1,"breadcrumb-item"],["href","#"],["aria-hidden","true",1,"fa","fa-home"],["aria-current","page",1,"breadcrumb-item","active"],[1,"declaracion"],[1,"box","box-form","mb-4"],[1,"row","align-items-end"],[1,"col-12","col-xl-2","mb-3","mb-xl-0"],[1,"form-label"],[1,"input-group"],["field","label","placeholder","Todos",1,"custom-autocomplete",3,"ngModel","suggestions","dropdown","ngModelChange","completeMethod","onSelect"],["pTemplate","item"],[1,"col-12","col-xl-1","mb-3","mb-xl-0"],[1,"btn","btn-primary","w-100",3,"click"],[1,"col-12","col-xl-3","mb-3","mb-xl-0"],["type","text","readonly","",1,"form-control",3,"ngModel","ngModelChange"],[1,"btn","btn-primary","w-100",3,"disabled","click"],[1,"table-responsive"],[1,"table","table-even","table-section","table-borderless","table-radius"],[1,"vertical-middle"],["type","checkbox",3,"disabled","ngModel","ngModelChange","change"],[4,"ngIf"],[4,"ngFor","ngForOf"],["aria-label","Navegaci\xf3n resultados"],[1,"pagination"],[1,"btn","btn-primary",3,"click"],["id","infoModal","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade",3,"hidden.bs.modal"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","exampleModalLabel",1,"modal-title","fs-5"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[3,"formGroup"],["miFormulario","ngForm"],[1,"row","mb-3"],[1,"col-sm-4","col-form-label"],[1,"col-sm-8"],["type","text","formControlName","empresaGestor","readonly","",1,"form-control"],["type","text","placeholder","1234","formControlName","invoiceNumber",1,"form-control",3,"keypress","change"],["class","text-danger",4,"ngIf"],["type","text","placeholder","1-9","formControlName","rut",1,"form-control",3,"readonly","input"],["class","text-danger pl-0",4,"ngIf"],["type","text","class","form-control","placeholder","Ingrese Reciclador","formControlName","reciclador",4,"ngIf"],["class","form-select","formControlName","reciclador",3,"disabled",4,"ngIf"],[1,"text-danger","pl-0"],["type","text","placeholder","Tipo tratamiento","formControlName","treatmentType","readonly","",1,"form-control"],["type","text","placeholder","Tipo material","formControlName","material","readonly","",1,"form-control"],["type","date","placeholder","10/4/2023","formControlName","entryDate",1,"form-control"],["type","text","formControlName","totalWeight",1,"form-control"],["type","text","formControlName","declarated","readonly","",1,"form-control"],["type","text","formControlName","valuedWeight",1,"form-control"],["type","text","formControlName","remainingWeight","readonly","",1,"form-control",3,"value"],["type","text","formControlName","asoc","readonly","",1,"form-control"],["type","file","formControlName","attachment","id","inp_attachment","accept","application/pdf, image/jpeg","required","",1,"form-control",3,"change"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary",3,"click"],["type","button","data-bs-dismiss","modal",1,"btn","btn-primary",3,"disabled","click"],["id","openModalButton","data-bs-toggle","modal","data-bs-target","#infoModal",2,"display","none"],[1,"example-section"],["data-bs-toggle","modal",1,"custom-cursor",3,"ngClass","click"],["aria-hidden","true",1,"fa","fa-check","fa-lg","fa-fw",3,"ngClass"],[1,"border","btn","btn-sm",3,"ngClass","click"],[1,"text-danger"],["type","text","placeholder","Ingrese Reciclador","formControlName","reciclador",1,"form-control"],["formControlName","reciclador",1,"form-select",3,"disabled"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(o,t){if(1&o&&(e.TgZ(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),e._UZ(5,"i",5),e._uU(6," Inicio"),e.qZA()(),e.TgZ(7,"li",6),e._uU(8,"Consulta de Declaraci\xf3n"),e.qZA()()(),e.TgZ(9,"section",7)(10,"h1"),e._uU(11,"Consulta de Declaraci\xf3n"),e.qZA(),e.TgZ(12,"div",8)(13,"div",9)(14,"div",10)(15,"label",11),e._uU(16,"Empresa CI:"),e.qZA(),e.TgZ(17,"div",12)(18,"p-autoComplete",13),e.NdJ("ngModelChange",function(a){return t.selectedBusiness=a})("completeMethod",function(a){return t.filterBusinesses(a)})("onSelect",function(){return t.updateFilters()}),e.YNc(19,Q,2,1,"ng-template",14),e.qZA()()(),e.TgZ(20,"div",10)(21,"label",11),e._uU(22,"Empresa Gestor:"),e.qZA(),e.TgZ(23,"div",12)(24,"p-autoComplete",13),e.NdJ("ngModelChange",function(a){return t.selectedGestor=a})("completeMethod",function(a){return t.filterBusinessesManager(a)})("onSelect",function(){return t.updateFilters()}),e.YNc(25,K,2,1,"ng-template",14),e.qZA()()(),e.TgZ(26,"div",10)(27,"label",11),e._uU(28,"Tipo de tratamiento:"),e.qZA(),e.TgZ(29,"div",12)(30,"p-autoComplete",13),e.NdJ("ngModelChange",function(a){return t.selectedTreatment=a})("completeMethod",function(a){return t.filterTreatment(a)})("onSelect",function(){return t.updateFilters()}),e.YNc(31,C,2,1,"ng-template",14),e.qZA()()(),e.TgZ(32,"div",15)(33,"label",11),e._uU(34,"Material:"),e.qZA(),e.TgZ(35,"div",12)(36,"p-autoComplete",13),e.NdJ("ngModelChange",function(a){return t.selectedMaterial=a})("completeMethod",function(a){return t.filterMaterial(a)})("onSelect",function(){return t.updateFilters()}),e.YNc(37,Ee,2,1,"ng-template",14),e.qZA()()(),e.TgZ(38,"div",10)(39,"label",11),e._uU(40,"Fecha de retiro:"),e.qZA(),e.TgZ(41,"div",12)(42,"p-autoComplete",13),e.NdJ("ngModelChange",function(a){return t.selectedYear=a})("completeMethod",function(a){return t.filterYear(a)})("onSelect",function(){return t.updateFilters()}),e.YNc(43,Fe,2,1,"ng-template",14),e.qZA()()(),e.TgZ(44,"div",10)(45,"label",11),e._uU(46,"Estado:"),e.qZA(),e.TgZ(47,"div",12)(48,"p-autoComplete",13),e.NdJ("ngModelChange",function(a){return t.selectedState=a})("completeMethod",function(a){return t.filterState(a)})("onSelect",function(){return t.updateFilters()}),e.YNc(49,xe,2,1,"ng-template",14),e.qZA()()(),e.TgZ(50,"div",15)(51,"label",11),e._uU(52,"\xa0"),e.qZA(),e.TgZ(53,"div",12)(54,"button",16),e.NdJ("click",function(){return t.autoFilter=!1,t.filter(),t.pagTo(0),t.disableFilters=!1}),e._uU(55,"Mostrar"),e.qZA()()(),e.TgZ(56,"div",17)(57,"label",11),e._uU(58,"N\xfamero de declaraciones seleccionadas:"),e.qZA(),e.TgZ(59,"div",12)(60,"input",18),e.NdJ("ngModelChange",function(a){return t.selectedDeclarationsCount=a}),e.qZA()()(),e.TgZ(61,"div",17),e._UZ(62,"p"),e.TgZ(63,"label",11),e._uU(64,"Peso total declarado seleccionado (Kg):"),e.qZA(),e.TgZ(65,"div",12)(66,"input",18),e.NdJ("ngModelChange",function(a){return t.selectedWeight=a}),e.qZA()()(),e.TgZ(67,"div",10),e._UZ(68,"p"),e.TgZ(69,"label",11),e._uU(70,"\xa0"),e.qZA(),e.TgZ(71,"div",12)(72,"button",19),e.NdJ("click",function(){return t.openApprovalModal()}),e._uU(73," Aprobar Selecci\xf3n "),e.qZA()()()()(),e.TgZ(74,"div",20)(75,"table",21)(76,"thead",22)(77,"tr")(78,"th")(79,"input",23),e.NdJ("ngModelChange",function(a){return t.selectAllChecked=a})("change",function(a){return t.onSelectAllCheckboxChange(a)}),e.qZA(),e._uU(80," Seleccionar todo "),e.qZA(),e.TgZ(81,"th"),e._uU(82,"Empresa CI"),e.qZA(),e.TgZ(83,"th"),e._uU(84,"Empresa Gestor"),e.qZA(),e.TgZ(85,"th"),e._uU(86,"Establecimiento CI"),e.qZA(),e.TgZ(87,"th"),e._uU(88,"Tipo de tratamiento"),e.qZA(),e.TgZ(89,"th"),e._uU(90,"Material"),e.qZA(),e.TgZ(91,"th"),e._uU(92,"Subtipo"),e.qZA(),e.TgZ(93,"th"),e._uU(94,"Fecha Retiro"),e.qZA(),e.TgZ(95,"th"),e._uU(96,"Estado"),e.qZA(),e.TgZ(97,"th"),e._uU(98,"Peso Declarado"),e.qZA(),e.TgZ(99,"th"),e._uU(100,"Peso Valorizado"),e.qZA(),e.YNc(101,Ne,3,0,"ng-container",24),e.qZA()(),e.TgZ(102,"tbody"),e.YNc(103,Ue,28,20,"tr",25),e.qZA()()(),e.TgZ(104,"nav",26)(105,"ul",27)(106,"li")(107,"button",28),e.NdJ("click",function(){return t.pagTo(0)}),e._uU(108,"Primero"),e.qZA()(),e.TgZ(109,"li")(110,"button",28),e.NdJ("click",function(){return t.previus()}),e._uU(111,"Anterior"),e.qZA()(),e.YNc(112,Re,3,5,"li",25),e.TgZ(113,"li")(114,"button",28),e.NdJ("click",function(){return t.next()}),e._uU(115,"Siguiente"),e.qZA()(),e.TgZ(116,"li")(117,"button",28),e.NdJ("click",function(){return t.pagTo(t.cant-1)}),e._uU(118,"\xdaltimo"),e.qZA()()()()()(),e.TgZ(119,"div",29),e.NdJ("hidden.bs.modal",function(){return t.reset_nocheck()}),e.TgZ(120,"div",30)(121,"div",31)(122,"div",32)(123,"h1",33),e._uU(124,"Asignar factura reciclador"),e.qZA(),e._UZ(125,"button",34),e.qZA(),e.TgZ(126,"div",35)(127,"form",36,37)(129,"div",38)(130,"label",39),e._uU(131,"Empresa Gestor"),e.qZA(),e.TgZ(132,"div",40),e._UZ(133,"input",41),e.qZA()(),e.TgZ(134,"div",38)(135,"label",39),e._uU(136,"N\xfam. Factura Reciclador"),e.qZA(),e.TgZ(137,"div",40)(138,"input",42),e.NdJ("keypress",function(a){return t.numberOnly(a)})("change",function(){return t.onRUTChange(t.index)}),e.qZA(),e.YNc(139,we,2,1,"div",43),e.qZA()(),e.TgZ(140,"div",38)(141,"label",39),e._uU(142,"RUT Reciclador"),e.qZA(),e.TgZ(143,"div",40)(144,"input",44),e.NdJ("input",function(a){return t.onChangeVAT(a.target)}),e.qZA(),e.YNc(145,ke,2,1,"div",45),e.qZA()(),e.TgZ(146,"div",38)(147,"label",39),e._uU(148,"Reciclador"),e.qZA(),e.TgZ(149,"div",40),e.YNc(150,Be,1,0,"input",46),e.YNc(151,Ge,4,2,"select",47),e.TgZ(152,"div",48),e.YNc(153,Je,2,0,"p",24),e.YNc(154,$e,2,0,"p",24),e.qZA()()(),e.TgZ(155,"div",38)(156,"label",39),e._uU(157,"Tipo Tratamiento"),e.qZA(),e.TgZ(158,"div",40),e._UZ(159,"input",49),e.YNc(160,Le,2,1,"div",45),e.qZA()(),e.TgZ(161,"div",38)(162,"label",39),e._uU(163,"Material"),e.qZA(),e.TgZ(164,"div",40),e._UZ(165,"input",50),e.YNc(166,Qe,2,1,"div",45),e.qZA()(),e.TgZ(167,"div",38)(168,"label",39),e._uU(169,"Fecha Ingreso PR"),e.qZA(),e.TgZ(170,"div",40),e._UZ(171,"input",51),e.YNc(172,He,3,2,"div",43),e.qZA()(),e.TgZ(173,"div",38)(174,"label",39),e._uU(175,"Peso Total Factura Reciclador"),e.qZA(),e.TgZ(176,"div",40),e._UZ(177,"input",52),e.YNc(178,tt,4,3,"div",43),e.qZA()(),e.TgZ(179,"div",38)(180,"label",39),e._uU(181,"Peso Declarado"),e.qZA(),e.TgZ(182,"div",40),e._UZ(183,"input",53),e.qZA()(),e.TgZ(184,"div",38)(185,"label",39),e._uU(186,"Peso Valorizado"),e.qZA(),e.TgZ(187,"div",40),e._UZ(188,"input",54),e.YNc(189,nt,4,3,"div",43),e.qZA()(),e.TgZ(190,"div",38)(191,"label",39),e._uU(192,"Peso Remanente"),e.qZA(),e.TgZ(193,"div",40),e._UZ(194,"input",55),e.YNc(195,it,3,0,"div",45),e.qZA()(),e.TgZ(196,"div",38)(197,"label",39),e._uU(198,"Num. Declaraciones asociadas"),e.qZA(),e.TgZ(199,"div",40),e._UZ(200,"input",56),e.qZA()(),e.TgZ(201,"div",38)(202,"label",39),e._uU(203,"Adjuntar"),e.qZA(),e.TgZ(204,"div",40)(205,"input",57),e.NdJ("change",function(a){return t.onFileSelected(a)}),e.qZA(),e.YNc(206,ct,3,2,"div",45),e.qZA()()()(),e.TgZ(207,"div",58)(208,"button",59),e.NdJ("click",function(){return t.userForm.reset({reciclador:"0"})}),e._uU(209,"Volver"),e.qZA(),e.TgZ(210,"button",60),e.NdJ("click",function(){return t.saveInvoice(t.index),t.reset(),t.disableFilters=!1}),e._uU(211,"Guardar"),e.qZA()()()()(),e._UZ(212,"a",61)),2&o){let r,a;e.xp6(18),e.Q6J("ngModel",t.selectedBusiness)("suggestions",t.filteredBusinesses)("dropdown",!0),e.xp6(6),e.Q6J("ngModel",t.selectedGestor)("suggestions",t.filteredBusinessesManager)("dropdown",!0),e.xp6(6),e.Q6J("ngModel",t.selectedTreatment)("suggestions",t.filteredTreatment)("dropdown",!0),e.xp6(6),e.Q6J("ngModel",t.selectedMaterial)("suggestions",t.filteredMaterial)("dropdown",!0),e.xp6(6),e.Q6J("ngModel",t.selectedYear)("suggestions",t.filteredYear)("dropdown",!0),e.xp6(6),e.Q6J("ngModel",t.selectedState)("suggestions",t.filteredState)("dropdown",!0),e.xp6(12),e.Q6J("ngModel",t.selectedDeclarationsCount),e.xp6(6),e.Q6J("ngModel",t.selectedWeight),e.xp6(6),e.Q6J("disabled",0==t.selectedDeclarationsCount&&0==t.selectedWeight),e.xp6(7),e.Q6J("disabled",!t.isAnyCheckboxSelected)("ngModel",t.selectAllChecked),e.xp6(22),e.Q6J("ngIf",!t.anyCheckboxSelected),e.xp6(2),e.Q6J("ngForOf",t.db),e.xp6(9),e.Q6J("ngForOf",t.visiblePageNumbers()),e.xp6(15),e.Q6J("formGroup",t.userForm),e.xp6(12),e.Q6J("ngIf",t.userForm.controls.invoiceNumber.errors&&t.userForm.controls.invoiceNumber.touched),e.xp6(5),e.Q6J("readonly",t.userForm.controls.invoiceNumber.invalid),e.xp6(1),e.Q6J("ngIf",t.userForm.controls.rut.errors&&t.userForm.controls.rut.touched),e.xp6(5),e.Q6J("ngIf",t.businessNoFound||0===t.dbBusiness.length),e.xp6(1),e.Q6J("ngIf",!t.businessNoFound&&t.dbBusiness.length>0),e.xp6(2),e.Q6J("ngIf",(t.businessNoFound||0===t.dbBusiness.length)&&(null==(r=t.userForm.get("reciclador"))||null==r.errors?null:r.errors.invalidRecycler)),e.xp6(1),e.Q6J("ngIf",!t.businessNoFound&&t.dbBusiness.length>0&&(null==(a=t.userForm.get("reciclador"))||null==a.errors?null:a.errors.invalidRecycler)),e.xp6(6),e.Q6J("ngIf",t.userForm.controls.treatmentType.errors&&t.userForm.controls.treatmentType.touched),e.xp6(6),e.Q6J("ngIf",t.userForm.controls.material.errors&&t.userForm.controls.material.touched),e.xp6(6),e.Q6J("ngIf",t.userForm.controls.entryDate.errors&&t.userForm.controls.entryDate.touched),e.xp6(6),e.Q6J("ngIf",t.userForm.controls.totalWeight.errors&&t.userForm.controls.totalWeight.touched),e.xp6(11),e.Q6J("ngIf",t.userForm.controls.valuedWeight.errors&&t.userForm.controls.valuedWeight.touched),e.xp6(5),e.Q6J("value",t.calculateRemainingWeight()),e.xp6(1),e.Q6J("ngIf",t.isRemainingWeightNegative),e.xp6(11),e.Q6J("ngIf",t.userForm.controls.attachment.errors&&t.userForm.controls.attachment.touched),e.xp6(4),e.Q6J("disabled",t.userForm.invalid||t.isRemainingWeightNegative)}},dependencies:[E.mk,E.sg,E.O5,c._Y,c.YN,c.Kr,c.Fj,c.Wl,c.EJ,c.JJ,c.JL,c.Q7,c.sg,c.u,c.On,Y.Qc,H.jx,E.uU],styles:["[_nghost-%COMP%]{width:90%!important;padding:1%}.color-verde[_ngcontent-%COMP%]{color:green}.color-verde-opaco[_ngcontent-%COMP%]{color:#0080004d}.custom-cursor[_ngcontent-%COMP%]{cursor:pointer}.no-pointer[_ngcontent-%COMP%]{cursor:default}.example-section[_ngcontent-%COMP%]{margin:0 50px}  .custom-autocomplete .p-autocomplete{width:100%;max-height:300px}  .custom-autocomplete .p-autocomplete-dropdown{width:10%;max-height:300px;background-color:#08a47c}  .select .form-select{width:50!important}"]}),n})();var dt=f(263);let mt=(()=>{class n{constructor(o,t,r){this.fb=o,this.authService=t,this.router=r,this.pos="right",this.horaIngreso=new Date,this.formData=this.fb.group({actual:["",[c.kI.required]],password:["",[c.kI.required,c.kI.minLength(3)]],repeatPassword:["",[c.kI.required,c.kI.minLength(3)]]})}ngOnInit(){this.userData=JSON.parse(sessionStorage.getItem("user")),this.horaIngreso=new Date(sessionStorage.getItem("horaIngreso")),localStorage.removeItem("statementsState")}btnrecovery(){const{actual:o,password:t,repeatPassword:r}=this.formData.value;this.authService.modifyPassword(t,r,o).subscribe({next:a=>{a.status?(s().fire({title:"Cambio de contrase\xf1a",text:"La contrase\xf1a fue cambiada exitosamente",icon:"success"}),this.router.navigate(["/gestor/home"])):(s().fire({title:"Validar informaci\xf3n",text:a.msg,icon:"error"}),this.formData.reset())},error:a=>{s().fire({title:"Formato inv\xe1lido",text:"Contrase\xf1a debe contener al menos 8 caracteres",icon:"error"})}})}displayModifyPassword(){this.pos="right"==this.pos?"down":"right"}}return n.\u0275fac=function(o){return new(o||n)(e.Y36(c.qu),e.Y36(dt.e),e.Y36(M.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-profile"]],decls:81,vars:16,consts:[[1,"container","mt-4"],[1,"mi-perfil"],[1,"box","box-mi-perfil","mb-5","d-flex","align-items-start"],[1,"list","list-data","list-data-title-green","column-md-2","gap-0","list-unstyled"],[1,"list-data__title"],[1,"list-data__text"],[1,"color-verde"],[1,"list","list-links","list-unstyled"],["id","accordionPanelsStayOpenExample",1,"accordion","accordion-flush"],[1,"accordion-item"],["id","panelsStayOpen-headingOne",1,"accordion-header"],["data-bs-toggle","collapse","data-bs-target","#panelsStayOpen-collapseOne",3,"click"],["aria-hidden","true"],["id","panelsStayOpen-collapseOne","aria-labelledby","panelsStayOpen-headingOne",1,"accordion-collapse","collapse"],[1,"accordion-body"],["autocomplete","off",1,"form-recovery",3,"formGroup"],[1,"mb-4"],[1,"input-group"],[1,"input-group-text","input-group-text-left"],["aria-hidden","true",1,"fa","fa-lock","fa-fw"],["type","password","id","password","formControlName","actual","placeholder","Contrase\xf1a actual",1,"form-control"],["type","password","id","password","formControlName","password","placeholder","Nueva contrase\xf1a",1,"form-control"],["type","password","id","repeatPassword","formControlName","repeatPassword","placeholder","Repetir contrase\xf1a",1,"form-control"],["type","button",1,"btn","btn-primary","btn-fa","w-100",3,"click"],["aria-hidden","true",1,"fa","fa-long-arrow-right","fa-fw"]],template:function(o,t){1&o&&(e.TgZ(0,"div",0)(1,"section",1)(2,"h1"),e._uU(3,"Mi Perfil"),e.qZA(),e.TgZ(4,"div",2)(5,"ul",3)(6,"li")(7,"span",4),e._uU(8,"Nombre Usuario"),e.qZA(),e.TgZ(9,"span",5),e._uU(10),e.qZA()(),e.TgZ(11,"li")(12,"span",4),e._uU(13,"Perfil"),e.qZA(),e.TgZ(14,"span",5),e._uU(15),e.qZA()(),e.TgZ(16,"li")(17,"span",4),e._uU(18,"Tel\xe9fono"),e.qZA(),e.TgZ(19,"span",5),e._uU(20),e.qZA()(),e.TgZ(21,"li")(22,"span",4),e._uU(23,"Correo"),e.qZA(),e.TgZ(24,"span",5),e._uU(25),e.qZA()(),e.TgZ(26,"li")(27,"span",4),e._uU(28,"Instituci\xf3n"),e.qZA(),e.TgZ(29,"span",5),e._uU(30),e.qZA()(),e.TgZ(31,"li")(32,"span",4),e._uU(33,"Cargo"),e.qZA(),e.TgZ(34,"span",5),e._uU(35),e.qZA()(),e.TgZ(36,"li")(37,"span",4),e._uU(38,"Tel\xe9fono Oficina"),e.qZA(),e.TgZ(39,"span",5),e._uU(40),e.qZA()(),e.TgZ(41,"li")(42,"span",4)(43,"b"),e._uU(44,"Fecha/ Hora ingreso"),e.qZA()(),e.TgZ(45,"span",5),e._uU(46),e.ALo(47,"date"),e.qZA()()()(),e.TgZ(48,"h2",6),e._uU(49,"Acciones"),e.qZA(),e.TgZ(50,"ul",7)(51,"div",8)(52,"div",9)(53,"h2",10)(54,"li",11),e.NdJ("click",function(){return t.displayModifyPassword()}),e.TgZ(55,"a")(56,"span"),e._uU(57,"Cambio de contrase\xf1a"),e.qZA(),e._UZ(58,"i",12),e.qZA()()(),e.TgZ(59,"div",13)(60,"div",14)(61,"form",15)(62,"div",16)(63,"div",17)(64,"button",18),e._UZ(65,"i",19),e.qZA(),e._UZ(66,"input",20),e.qZA()(),e.TgZ(67,"div",16)(68,"div",17)(69,"button",18),e._UZ(70,"i",19),e.qZA(),e._UZ(71,"input",21),e.qZA()(),e.TgZ(72,"div",16)(73,"div",17)(74,"button",18),e._UZ(75,"i",19),e.qZA(),e._UZ(76,"input",22),e.qZA()(),e.TgZ(77,"div",16)(78,"button",23),e.NdJ("click",function(){return t.btnrecovery()}),e._uU(79," Enviar "),e._UZ(80,"i",24),e.qZA()()()()()()()()()()),2&o&&(e.xp6(10),e.AsE("",t.userData.FIRST_NAME," ",t.userData.LAST_NAME,""),e.xp6(5),e.Oqu(t.userData.ROL_NAME),e.xp6(5),e.Oqu(t.userData.PHONE),e.xp6(5),e.Oqu(t.userData.EMAIL),e.xp6(5),e.Oqu(t.userData.BUSINESS.join(" || ")),e.xp6(5),e.Oqu(t.userData.POSITION),e.xp6(5),e.Oqu(t.userData.PHONE_OFFICE),e.xp6(6),e.Oqu(e.xi3(47,13,t.horaIngreso,"dd-MM-yyyy H:mm:s")),e.xp6(12),e.Gre("fa fa-chevron-",t.pos,""),e.xp6(3),e.Q6J("formGroup",t.formData))},dependencies:[c._Y,c.Fj,c.JJ,c.JL,c.sg,c.u,E.uU]}),n})();var ue=f(574),pt=f(3813);const ht=["fileInput"];function gt(n,u){if(1&n){const o=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.TgZ(13,"td"),e._uU(14),e.qZA(),e.TgZ(15,"td"),e._uU(16),e.qZA(),e.TgZ(17,"td"),e._uU(18),e.qZA(),e.TgZ(19,"td"),e._uU(20),e.qZA(),e.TgZ(21,"td"),e._uU(22),e.qZA(),e.TgZ(23,"td"),e._uU(24),e.qZA(),e.TgZ(25,"td"),e._uU(26),e.qZA(),e.TgZ(27,"td"),e._uU(28),e.qZA(),e.TgZ(29,"td"),e._uU(30),e.qZA(),e.TgZ(31,"td",26)(32,"input",27,17),e.NdJ("change",function(r){const l=e.CHM(o).index,p=e.oxw(2);return e.KtG(p.onInvoiceChange(r,l))}),e.qZA(),e.TgZ(34,"button",14),e.NdJ("click",function(){e.CHM(o);const r=e.MAs(33);return e.KtG(r.click())}),e._UZ(35,"i",18),e._uU(36," Cargar Factura "),e.qZA(),e.TgZ(37,"p"),e._uU(38),e.qZA()(),e.TgZ(39,"td"),e._UZ(40,"i",28),e.qZA()()}if(2&n){const o=u.$implicit,t=u.index,r=e.oxw(2);e.xp6(2),e.Oqu(o.nameBusiness),e.xp6(2),e.Oqu(o.nameGestor),e.xp6(2),e.Oqu(o.establishment),e.xp6(2),e.Oqu(o.treatmentType),e.xp6(2),e.Oqu(o.material),e.xp6(2),e.Oqu(o.subMaterial),e.xp6(2),e.Oqu(o.withdrawalDate.replaceAll("/","-")),e.xp6(2),e.Oqu(o.numberInvoice),e.xp6(2),e.Oqu(o.vat),e.xp6(2),e.Oqu(o.vatCompanyName),e.xp6(2),e.Oqu(o.frontAdmissionDate),e.xp6(2),e.Oqu(o.totalWeightFormated),e.xp6(2),e.Oqu(o.declaratedWeightFormated),e.xp6(2),e.Oqu(o.valuedWeightFormated),e.xp6(2),e.Oqu(o.fixedRemainingWeight.replace(".",",")),e.xp6(8),e.Oqu(r.fileNames[t]),e.xp6(2),e.Q6J("ngClass",r.fileNames[t]?"color-verde":"color-verde-opaco")}}function ft(n,u){if(1&n){const o=e.EpF();e.TgZ(0,"div",20)(1,"table",21)(2,"thead")(3,"tr",22)(4,"th"),e._uU(5,"Empresa CI"),e.qZA(),e.TgZ(6,"th"),e._uU(7,"Empresa Gestor"),e.qZA(),e.TgZ(8,"th"),e._uU(9,"Establecimiento"),e.qZA(),e.TgZ(10,"th"),e._uU(11,"Tipo Tratamiento"),e.qZA(),e.TgZ(12,"th"),e._uU(13,"Material"),e.qZA(),e.TgZ(14,"th"),e._uU(15,"Subtipo"),e.qZA(),e.TgZ(16,"th"),e._uU(17,"Fecha Retiro"),e.qZA(),e.TgZ(18,"th"),e._uU(19,"N\xfam. Factura Reciclador"),e.qZA(),e.TgZ(20,"th"),e._uU(21,"Rut Reciclador"),e.qZA(),e.TgZ(22,"th"),e._uU(23,"Reciclador"),e.qZA(),e.TgZ(24,"th"),e._uU(25,"Fecha ingreso PR"),e.qZA(),e.TgZ(26,"th"),e._uU(27,"Peso Total"),e.qZA(),e.TgZ(28,"th"),e._uU(29,"Peso Declarado"),e.qZA(),e.TgZ(30,"th"),e._uU(31,"Peso Valorizado"),e.qZA(),e.TgZ(32,"th"),e._uU(33,"Peso Remanente"),e.qZA(),e.TgZ(34,"th"),e._uU(35,"Carga Factura"),e.qZA(),e.TgZ(36,"th"),e._uU(37,"Estado"),e.qZA()()(),e.TgZ(38,"tbody"),e.YNc(39,gt,41,17,"tr",23),e.qZA(),e.TgZ(40,"tbody")(41,"tr"),e._UZ(42,"td")(43,"td")(44,"td")(45,"td")(46,"td")(47,"td")(48,"td")(49,"td")(50,"td")(51,"td")(52,"td")(53,"td")(54,"td")(55,"td"),e.TgZ(56,"td",24)(57,"button",25),e.NdJ("click",function(){e.CHM(o);const r=e.oxw();return e.KtG(r.saveAllInvoices())}),e._uU(58," Finalizar "),e.qZA()()()()()()}if(2&n){const o=e.oxw();e.xp6(39),e.Q6J("ngForOf",o.allInvoices),e.xp6(18),e.Q6J("ngClass",o.verification==o.allInvoices.length?"":"disabled")}}let _t=(()=>{class n{constructor(o,t,r){this.establishmentService=o,this.managerService=t,this.businessService=r,this.dbBusiness=[],this.invoices=[],this.invoicesDuplicated=[],this.allInvoices=[],this.index=0,this.fileNames={},this.verification=0,this.fileToUpload={},this.wasteTypes={PapelCart\u00f3n:["Papel","Papel Compuesto (cemento)","Caja Cart\xf3n","Papel/Cart\xf3n Otro"],Metal:["Envase Aluminio","Malla o Reja (IBC)","Envase Hojalata","Metal Otro"],Pl\u00e1stico:["Pl\xe1stico Film Embalaje","Pl\xe1stico Envases R\xedgidos (Incl. Tapas)","Pl\xe1stico Sacos o Maxisacos","Pl\xe1stico EPS (Poliestireno Expandido)","Pl\xe1stico Zuncho","Pl\xe1stico Otro"],Madera:["Caja de Madera","Pallet de Madera"]}}ngOnInit(){this.userData=JSON.parse(sessionStorage.getItem("user")),localStorage.removeItem("statementsState")}downloadExcel(){const o=JSON.parse(sessionStorage.getItem("user")).ID_BUSINESS;s().fire({title:"Generando Excel",text:"Esto puede tardar varios minutos",timerProgressBar:!0,showConfirmButton:!1,allowEscapeKey:!1,allowOutsideClick:!1}),s().showLoading(),this.managerService.downloadExcelTemplateInvoice(o).subscribe({next:t=>{if(t){const r=new Blob([t],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});let a=document.createElement("a");a.href=window.URL.createObjectURL(r),a.download="carga masiva gestor",document.body.appendChild(a),a.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),a.remove(),window.URL.revokeObjectURL(a.href),s().close()}},error:t=>{if(t instanceof Blob){const r=new FileReader;r.onload=()=>{const a=r.result;try{const l=JSON.parse(a);!1===l.status&&l.message?s().fire({icon:"error",text:l.message}):s().fire({icon:"error",text:"Documento para carga masiva no disponible."})}catch{s().fire({icon:"error",text:"Error desconocido al procesar la respuesta."})}},r.readAsText(t)}else s().fire({icon:"error",text:"Error desconocido al procesar la respuesta."})}})}onFileChange(o){const r=o.target;if(1!==r.files.length)return void s().fire({icon:"error",text:"Solo puede cargar un archivo a la vez"});const a=r.files[0];if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(a.type))return void s().fire({icon:"error",text:"Tipo de archivo incorrecto. Por favor, cargue un archivo Excel (.xls o .xlsx)"});if(r.files[0].size>1048576)return void s().fire({icon:"error",text:"Tama\xf1o del archivo excede el l\xedmite (1MB m\xe1ximo)."});const i=new FileReader;i.onload=_=>{const v=ue.ij(_.target.result,{type:"binary"});if(!v.SheetNames.includes("Carga Masiva"))return void s().fire({icon:"error",text:'No se encontr\xf3 la hoja "Carga Masiva" en el archivo.'});const A=ue.P6.sheet_to_json(v.Sheets["Carga Masiva"],{header:1});this.processData(A)},i.readAsBinaryString(a),this.resetFileInput()}resetFileInput(){this.fileInput.nativeElement.value=""}onInvoiceChange(o,t){const a=o.target;if(a.files.length>1)return void s().fire({icon:"error",text:"Solo puede cargar un archivo a la vez"});if(!["application/pdf","image/jpeg"].includes(a.files[0].type))return void s().fire({icon:"error",text:"Tipo de archivo incorrecto. Por favor, cargue un archivo v\xe1lido (.pdf, .jpeg o .jpg)"});if(a.files[0].size>1048576)return void s().fire({icon:"error",text:"Tama\xf1o del archivo excede el l\xedmite (1MB m\xe1ximo)."});const _=o.target.files[0];_&&(this.fileNames[t]=_.name,this.fileToUpload[t]=_,this.verification=Object.keys(this.fileNames).length),this.resetFileInput()}processData(o){var t=this;return(0,q.Z)(function*(){if(s().fire({title:"Procesando datos",text:"Se estan validando los datos",timerProgressBar:!0,showConfirmButton:!1,allowEscapeKey:!1,allowOutsideClick:!1}),s().showLoading(),0==o.length)return void s().fire({icon:"error",text:"Archivo inv\xe1lido. No tiene todas las columnas necesarias"});const r=o.slice(1).filter(h=>h.length>0&&h.some(d=>d)),a=[],l=[];if(0==r.length)return void s().fire({icon:"info",text:"Archivo inv\xe1lido, verifique que no est\xe9 vac\xedo."});if(14!=o[0].length)return void s().fire({icon:"error",text:"Archivo inv\xe1lido, no tiene todas las columnas necesarias."});const p=JSON.parse(sessionStorage.getItem("user")).ID_BUSINESS,_=(yield t.establishmentService.getDeclarationEstablishmentByIdGestor(p).toPromise()).data.filter(h=>0===h.STATE_GESTOR),m=yield t.managerService.getAllMaterials().toPromise(),v=yield t.managerService.getAllTreatments().toPromise(),y=new Set;for(let h=0;h<r.length;h++){const d=r[h],g=h+2;if(0==d.length&&0==h)return void s().fire({icon:"error",text:"Archivo vac\xedo"});const R=d[0];if(!R)return void s().fire({icon:"error",text:`Empresa CI no ingresado en la fila ${g}`});const I=d[1];if(!I)return void s().fire({icon:"error",text:`Empresa Gestor no ingresado en la fila ${g}`});const G=d[2];if(!G)return void s().fire({icon:"error",text:`Establecimiento no ingresado en la fila ${g}`});const J=d[3];if(!J)return void s().fire({icon:"error",text:`Tipo de tratamiento no ingresado en la fila ${g}`});const j=d[4];if(!j)return void s().fire({icon:"error",text:`Material no ingresado en la fila ${g}`});const de=d[5];if(!de)return void s().fire({icon:"error",text:`Subtipo no ingresado en la fila ${g}`});const me=d[6];if(!me)return void s().fire({icon:"error",text:`Fecha retiro no ingresado en la fila ${g}`});const $=d[7];if(!$)return void s().fire({icon:"error",text:`Numero factura no ingresado en la fila ${g}`});if($<=0)return void s().fire({icon:"error",text:`Numero factura ingresado en la fila ${g} debe ser mayor que cero`});const pe=d[8];if(!pe)return void s().fire({icon:"error",text:`RUT no ingresado en la fila ${g}`});let X;const ee=m.status.find(b=>b.MATERIAL===j);if(!ee)return void s().fire({icon:"error",text:`No se encontr\xf3 ningun material con el nombre "${j}" en la fila ${g}`});let te;ee&&(X=ee.ID);const oe=v.status.find(b=>b.NAME===J);if(!oe)return void s().fire({icon:"error",text:`No se encontr\xf3 ningun tipo de tratamiento con el nombre "${J}" en la fila ${g}`});oe&&(te=oe.ID);const he=d[9];if(!he)return void s().fire({icon:"error",text:`Reciclador no ingresado en la fila ${g}`});let ge;ge=d[9];let re=d[15];const ae=d[10];if(!ae)return void s().fire({icon:"error",text:`Fecha ingreso PR no ingresado en la fila ${g}`});const fe=t.isValidDate(ae);if(!fe.valid)return void s().fire({icon:"error",text:`Error en la fila ${g}. ${fe.message}`});let x,U,V;const z=yield t.establishmentService.getInovice($,te,X,re).toPromise();if(!z.status)return void s().fire({icon:"error",text:`La fila ${g} tiene el siguiente error: `+z.msg});if(x=t.formatNumber(z.data[0]?.invoice_value),V=t.formatNumber(z.data[0].value_declarated),0==x&&!d[11])return void s().fire({icon:"error",text:`Peso total no ingresado en la fila ${g}`});if(0==x&&(x=d[11]),0!==x&&x!==d[11])return void s().fire({icon:"info",text:`La factura con numero ${$} de la fila ${g} perteneciente al gestor ${I} ya cuenta con datos existentes, favor de ingresar el peso total registrado previamente (${x})`});const Zt=x.replace(",","."),_e=parseFloat(Zt);if(isNaN(_e))return void s().fire({icon:"error",text:`Peso total ingresado en la fila ${g} no es v\xe1lido, debe ser solo n\xfameros y con comas.`});if(_e<=0)return void s().fire({icon:"error",text:`Peso total ingresado en la fila ${g} debe ser mayor que cero.`});if(U=d[12],0==U&&!d[12])return void s().fire({icon:"error",text:`Peso declarado no ingresado en la fila ${g}`});0==U&&(U=d[12]);const w=d[13];if(!w)return void s().fire({icon:"error",text:`Peso valorizado no ingresado en la fila ${g}`});const At=w.replace(",","."),Te=parseFloat(At);if(isNaN(Te))return void s().fire({icon:"error",text:`Peso valorizado ingresado en la fila ${g} no es v\xe1lido, debe ser solo n\xfameros y con comas.`});if(Te<=0)return void s().fire({icon:"error",text:`Peso valorizado ingresado en la fila ${g} debe ser mayor que cero.`});const ve=parseFloat(x.toString().replace(",",".")),be=parseFloat(w.toString().replace(",","."));let L;if(0!==V){const N=ve-parseFloat(V.toString().replace(",",".")),Ce=N-be;if(L=Ce.toFixed(2).replace(".",","),Ce<0)return void s().fire({icon:"error",text:`Peso remanente calculado en la fila ${g} no puede ser menor que cero.\n ${N} - ${w}  = ${L}`})}if(0==V){const b=ve-be;if(L=b.toFixed(2).replace(".",","),b<0)return void s().fire({icon:"error",text:`Peso remanente calculado en la fila ${g} no puede ser menor que cero.\n ${x} - ${w}  = ${L}`})}for(let b=h+1;b<r.length;b++){const N=r[b];if(N[7]===d[7]&&N[11]!==d[11]&&N[15]==d[15])return void s().fire({icon:"info",text:`Ingresar el mismo peso total para todas las facturas iguales con numero ${d[7]} del gestor ${I}`});if(N[14]==d[14])return void s().fire({icon:"info",text:`Error en fila ${g}, No se puede aprobar m\xe1s de una vez una misma declaraci\xf3n`});N[7]===d[7]&&N[15]==d[15]&&(y.add(d),y.add(N))}const Se=d[14],ne=ae.split("/"),Ze=new Date(`${ne[2]}-${ne[1]}-${ne[0]}`).toISOString().split("T")[0],ie=Ze.split("-"),Et=`${ie[2]}-${ie[1]}-${ie[0]}`;if(!_.find(b=>b.ID_DETAIL==parseInt(Se)))return void s().fire({icon:"error",text:`No se encontr\xf3 ninguna factura pendiente en la base de datos con los registros de la fila ${g}`});const Ft=parseFloat(x.replace(",",".")).toFixed(2).replace(".",",").toString(),xt=parseFloat(w.replace(",",".")).toFixed(2).replace(".",",").toString();let se;"number"==typeof U&&(se=parseFloat(U.toString().replace(",",".")).toFixed(2).replace(".",",").toString()),"string"==typeof U&&(se=parseFloat(U.replace(",",".")).toFixed(2).replace(".",",").toString());const Ae={nameBusiness:R,idBusiness:ge,establishment:G,treatmentType:J,material:j,subMaterial:de,withdrawalDate:me,numberInvoice:$,vat:pe,vatCompanyName:he,backAdmissionDate:Ze,totalWeight:x,declaratedWeight:U,valuedWeight:w,fixedRemainingWeight:L,idDetail:Se,frontAdmissionDate:Et,totalWeightFormated:Ft,valuedWeightFormated:xt,declaratedWeightFormated:se,declaratedWeightResponse:V,materialTypeNum:X,treatmentTypeNum:te,nameGestor:I,idGestor:re};let le=!1;for(const b of y)b.includes(re)&&(le=!0);0==le&&a.push(Ae),1==le&&l.push(Ae)}const A={},F={},D={};for(const h of l){const d=`${h.numberInvoice} ${h.nameGestor}`;if(A[d]||(A[d]={tipo_tratamiento:h.treatmentType,material:h.material,numero_factura:h.numberInvoice,remanente_total:0}),void 0===F[d]&&void 0===D[d]){if(0!==parseFloat(h.declaratedWeightResponse)){let R=parseFloat(h.totalWeight.toString().replace(",",".")),I=parseFloat(h.declaratedWeightResponse.toString().replace(",","."));F[d]=R-I}else F[d]=parseFloat(h.totalWeight.replace(",","."));D[d]=h.numberInvoice}if(D[d]!==h.numberInvoice){if(0!==parseFloat(h.declaratedWeightResponse)){let R=parseFloat(h.totalWeight.toString().replace(",",".")),I=parseFloat(h.declaratedWeightResponse.toString().replace(",","."));F[d]=R-I}else F[d]=parseFloat(h.totalWeight.replace(",","."));D[d]=h.numberInvoice}const g=parseFloat(h.valuedWeight.replace(",","."));F[d]-=g,h.fixedRemainingWeight=F[d].toFixed(2).replace(".",",").toString(),A[d].remanente_total=F[d]}for(const h in A)if(A.hasOwnProperty(h)){const d=A[h].remanente_total;if(d<0)return void s().fire({icon:"error",text:`Los remanentes totales para las facturas con numero ${h} son menores a cero: ${d}`})}t.invoices=a,t.invoicesDuplicated=l,t.allInvoices=Array.from([...a,...l]),s().close()})()}saveAllInvoices(){var o=this;return(0,q.Z)(function*(){s().fire({title:"Ingresando datos",text:"Se estan cargando los datos",timerProgressBar:!0,showConfirmButton:!1,allowEscapeKey:!1,allowOutsideClick:!1}),s().showLoading();let t=!1;for(let r=0;r<o.allInvoices.length;r++){const a=o.allInvoices[r];if(o.allInvoices.length==Object.keys(o.fileNames).length&&o.fileNames[r])try{if(!(yield Promise.race([o.establishmentService.saveInvoice(a.vat,a.idBusiness,a.numberInvoice,a.idDetail,a.backAdmissionDate,a.valuedWeight.replace(",","."),a.totalWeight.replace(",","."),a.treatmentTypeNum,a.materialTypeNum,o.fileToUpload[r],a.idGestor).toPromise(),new Promise((p,i)=>{setTimeout(()=>i(new Error("Timeout")),3e4)})])).status)return t=!0,o.allInvoices=[],s().close(),void s().fire({icon:"error",text:"Ha habido un error y el proceso se ha detenido, consulte m\xe1s tarde el estado de sus declaraciones para ver cuales fueron exitosamente aprobadas y cuales no."})}catch(l){if("Timeout"===l.message)return t=!0,o.allInvoices=[],s().close(),void s().fire({icon:"error",text:"Ha habido un error y el proceso se ha detenido, consulte m\xe1s tarde el estado de sus declaraciones para ver cuales fueron exitosamente aprobadas y cuales no."});throw t=!0,o.allInvoices=[],s().close(),s().fire({icon:"error",text:"Ha habido un error y el proceso se ha detenido, consulte m\xe1s tarde el estado de sus declaraciones para ver cuales fueron exitosamente aprobadas y cuales no."}),l}}o.allInvoices=[],t||(s().close(),s().fire({icon:"success",text:"Sus facturas han sido ingresadas correctamente"}))})()}formatNumber(o){return null==o?0:Number.isInteger(o)?o.toString():o.toLocaleString("es")}isValidDate(o){if(typeof o>"u"||""===o.trim())return{valid:!1,message:"Fecha no puede estar vac\xeda."};const t=o.split("/");if(3!==t.length||isNaN(+t[0])||isNaN(+t[1])||isNaN(+t[2]))return{valid:!1,message:"Formato de la fecha es incorrecto. Formato requerido: DD/MM/AAAA"};const r=new Date(+t[2],+t[1]-1,+t[0]),a=new Date;return a.setHours(0,0,0,0),r>a?{valid:!1,message:"Fecha no debe ser futura."}:r.getDate()!==+t[0]||r.getMonth()!==+t[1]-1||r.getFullYear()!==+t[2]?{valid:!1,message:"Fecha proporcionada no es v\xe1lida."}:{valid:!0,message:""}}}return n.\u0275fac=function(o){return new(o||n)(e.Y36(k.d),e.Y36(pt.b),e.Y36(B.m))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-bulk-upload"]],viewQuery:function(o,t){if(1&o&&e.Gf(ht,5),2&o){let r;e.iGM(r=e.CRH())&&(t.fileInput=r.first)}},decls:28,vars:1,consts:[[1,"container","mt-4"],["aria-label","breadcrumb",1,"breadcrumbs","d-none","d-lg-block"],[1,"breadcrumb"],[1,"breadcrumb-item"],["href","#"],["aria-hidden","true",1,"fa","fa-home"],["aria-current","page",1,"breadcrumb-item","active"],[1,"declaracion"],[1,"d-sm-flex","justify-content-between","mb-3","mb-md-0"],[1,"box","box-form","mb-4"],[1,"row","align-items-end"],[1,"col-12","col-xl-12"],[1,"row"],[1,"col-6"],[1,"btn","btn-primary","col-12",3,"click"],[1,"fas","fa-download"],["type","file","id","file-input","accept",".xls,.xlsx,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",2,"display","none",3,"change"],["fileInput",""],[1,"fas","fa-upload"],["class","box box-form mb-12",4,"ngIf"],[1,"box","box-form","mb-12"],[1,"table","table-even","table-section","table-borderless","table-radius"],["align","center"],[4,"ngFor","ngForOf"],["colspan","2"],[1,"btn","btn-primary","col-12",3,"ngClass","click"],[2,"width","1000px"],["type","file","id","file-input","accept",".pdf,.jpeg,.jpg",2,"display","none",3,"change"],["aria-hidden","true","id","submit",1,"fa","fa-check","fa-lg","fa-fw",3,"ngClass"]],template:function(o,t){if(1&o){const r=e.EpF();e.TgZ(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),e._UZ(5,"i",5),e._uU(6," Inicio"),e.qZA()(),e.TgZ(7,"li",6),e._uU(8,"Carga Masiva Factura Reciclador"),e.qZA()()(),e.TgZ(9,"section",7)(10,"h1"),e._uU(11,"Carga Masiva Factura Reciclador"),e.qZA(),e._UZ(12,"div",8),e.TgZ(13,"div",9)(14,"div",10)(15,"div",11)(16,"div",12)(17,"div",13)(18,"button",14),e.NdJ("click",function(){return t.downloadExcel()}),e._UZ(19,"i",15),e._uU(20," Descargar declaraciones pendientes por aprobar "),e.qZA()(),e.TgZ(21,"div",13)(22,"input",16,17),e.NdJ("change",function(l){return t.onFileChange(l)}),e.qZA(),e.TgZ(24,"button",14),e.NdJ("click",function(){e.CHM(r);const l=e.MAs(23);return e.KtG(l.click())}),e._UZ(25,"i",18),e._uU(26," Cargar declaraciones "),e.qZA()()()()()(),e.YNc(27,ft,59,2,"div",19),e.qZA()()}2&o&&(e.xp6(27),e.Q6J("ngIf",t.allInvoices.length>0))},dependencies:[E.mk,E.sg,E.O5],styles:["[_nghost-%COMP%]{width:90%!important;padding:1%}.color-verde[_ngcontent-%COMP%]{color:green}.color-verde-opaco[_ngcontent-%COMP%]{color:#0080004d}.circle[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:50%;display:inline-block;margin-right:5px}.green-circle[_ngcontent-%COMP%]{background-color:green}.red-circle[_ngcontent-%COMP%]{background-color:red}"]}),n})();var Tt=f(9314);const vt=[{path:"",component:O.$,children:[{path:"home",component:S},{path:"statements",component:ut},{path:"profile",component:mt},{path:"faq",component:Tt.v},{path:"bulk-upload-invoice",component:_t},{path:"**",redirectTo:"home",pathMatch:"full"}]}];let bt=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[M.Bz.forChild(vt),M.Bz]}),n})(),St=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[E.ez,bt,c.UX,c.u5,Y.WN]}),n})()}}]);