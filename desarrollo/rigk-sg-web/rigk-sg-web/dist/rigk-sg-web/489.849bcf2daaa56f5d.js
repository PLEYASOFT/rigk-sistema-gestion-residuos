"use strict";(self.webpackChunkrigk_sg_web=self.webpackChunkrigk_sg_web||[]).push([[489],{6489:(U,m,l)=>{l.r(m),l.d(m,{AuthModule:()=>T});var u=l(6895),c=l(5792),n=l(433),t=l(8256),p=l(263);function v(o,s){if(1&o&&(t.TgZ(0,"div",26),t._uU(1),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.hij(" ",e.msg," ")}}function b(o,s){1&o&&t._UZ(0,"div",27)}function Z(o,s){if(1&o&&(t.TgZ(0,"option",43),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.Q6J("value",e.id),t.xp6(1),t.Oqu(e.name)}}function _(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",28)(1,"div",29)(2,"div",30)(3,"div",31)(4,"h5",32),t._uU(5,"Por favor, elija el rol:"),t.qZA(),t.TgZ(6,"div",33),t._UZ(7,"img",34),t.TgZ(8,"button",35),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return r.multiRol=!1,t.KtG(r.closeModal())}),t.qZA()()(),t.TgZ(9,"div",36)(10,"div",37)(11,"select",38),t.NdJ("ngModelChange",function(r){t.CHM(e);const a=t.oxw();return t.KtG(a.rol=r)}),t.TgZ(12,"option",39),t._uU(13,"Seleccione Rol"),t.qZA(),t.YNc(14,Z,2,2,"option",40),t.qZA()()(),t.TgZ(15,"div",41)(16,"button",42),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.selectRoleAndLogin())}),t._uU(17,"Ingresar con rol seleccionado"),t.qZA()()()()()}if(2&o){const e=t.oxw();t.xp6(11),t.Q6J("ngModel",e.rol),t.xp6(3),t.Q6J("ngForOf",e.userRoles),t.xp6(2),t.Q6J("disabled",!e.rol)}}const f=".modal-backdrop[_ngcontent-%COMP%]{background-color:#00000080;position:fixed;top:0;left:0;width:100%;height:100%;z-index:999;opacity:1;transition:opacity .8s ease-in-out}.modal-dialog[_ngcontent-%COMP%]{z-index:1000;margin-top:80px;box-shadow:0 4px 8px #3bffb428}.modal-content[_ngcontent-%COMP%]{border-radius:8px;overflow:hidden;background-color:#fff}.modal-body[_ngcontent-%COMP%], .modal-footer[_ngcontent-%COMP%]{padding:20px}.custom-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.header-right[_ngcontent-%COMP%]{display:flex;align-items:center}.header-right[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-right:15px}";let y=(()=>{class o{constructor(e,i,r,a){this.fb=e,this.authService=i,this.router=r,this.actived=a,this.error=!1,this.msg="",this.rol="",this.multiRol=!1,this.userRoles=[],this.formData=this.fb.group({user:["",[n.kI.required,n.kI.email]],password:["",[n.kI.required,n.kI.minLength(8)]]}),this.actived.queryParams.subscribe(d=>{d.logout&&sessionStorage.clear()})}ngOnInit(){sessionStorage.getItem("token")&&this.router.navigate(["/productor"])}btnLogin(){const{user:e,password:i}=this.formData.value;this.authService.login(e,i).subscribe({next:r=>{if(r.body.status){const a=new Date;if(sessionStorage.setItem("user",JSON.stringify(r.body.data.user)),sessionStorage.setItem("horaIngreso",a.toString()),1==r.body.data.user.ROLES.length){const d=r.body.data.user.ROLES[0].id,h=JSON.parse(sessionStorage.getItem("user"));h.ROL=d,sessionStorage.setItem("user",JSON.stringify(h)),9==d?this.router.navigate(["/productor"]):10==d?this.router.navigate(["/mantenedor"]):11==d?this.router.navigate(["/consumidor"]):12==d&&this.router.navigate(["/gestor"])}else this.multiRol=!0,this.userRoles=r.body.data.user.ROLES,this.data=r.body.data.user}else this.error=!0,this.msg=r.body.msg},error:r=>{this.error=!0,this.msg=r.msg}})}selectRoleAndLogin(){this.rol?(this.navigateToRole(this.rol),this.multiRol=!1):alert("Por favor, seleccione un rol.")}navigateToRole(e){if(9==e){this.data.ROL=9,this.data.ROL_NAME="Productor";const i=new Date;sessionStorage.setItem("user",JSON.stringify(this.data)),sessionStorage.setItem("horaIngreso",i.toString()),this.router.navigate(["/productor"])}else if(10==e){this.data.ROL=10,this.data.ROL_NAME="Admin";const i=new Date;sessionStorage.setItem("user",JSON.stringify(this.data)),sessionStorage.setItem("horaIngreso",i.toString()),this.router.navigate(["/mantenedor"])}else if(11==e){this.data.ROL=11,this.data.ROL_NAME="Consumidor";const i=new Date;sessionStorage.setItem("user",JSON.stringify(this.data)),sessionStorage.setItem("horaIngreso",i.toString()),this.router.navigate(["/consumidor"])}else if(12==e){this.data.ROL=12,this.data.ROL_NAME="Gestor";const i=new Date;sessionStorage.setItem("user",JSON.stringify(this.data)),sessionStorage.setItem("horaIngreso",i.toString()),this.router.navigate(["/gestor"])}}closeModal(){sessionStorage.clear(),this.multiRol=!1}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(n.qu),t.Y36(p.e),t.Y36(c.F0),t.Y36(c.gz))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-login"]],decls:36,vars:4,consts:[["lang","es"],["charset","UTF-8"],["http-equiv","X-UA-Compatible","content","IE=edge"],["name","viewport","content","width=device-width, initial-scale=1.0"],["rel","preconnect","href","https://fonts.googleapis.com"],["rel","preconnect","href","https://fonts.gstatic.com","crossorigin",""],["href","https://fonts.googleapis.com/css2?family=Jost:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,400;0,700;1,300;1,700&display=swap","rel","stylesheet"],[1,"body-login"],[1,"container","d-flex"],[1,"box","box-login","text-center","col-12","col-md-6","col-xl-4","position-relative"],[1,"mb-4"],["href","login.component.html"],["src","assets/images/logo-prorep-w.png","width","240","alt","Ir al inicio"],["autocomplete","off",1,"form-login",3,"formGroup","ngSubmit"],[1,"input-group"],[1,"input-group-text","input-group-text-left"],["aria-hidden","true",1,"fa","fa-user","fa-fw"],["type","user","id","usuario","formControlName","user","placeholder","Usuario",1,"form-control"],["aria-hidden","true",1,"fa","fa-lock","fa-fw"],["type","password","id","password","formControlName","password","placeholder","Contrase\xf1a",1,"form-control"],["class","event","style","color: red; font-style: italic; font-weight: bolder; margin-bottom: 5%; font-size: small;",4,"ngIf"],["type","submit",1,"btn","btn-primary","btn-fa","w-100"],["aria-hidden","true",1,"fa","fa-long-arrow-right","fa-fw"],["routerLink","/auth/sendCode","href","#",1,"text-center"],["class","modal-backdrop",4,"ngIf"],["class","modal show","id","roleSelectionModal","tabindex","-1","aria-labelledby","roleSelectionModalLabel","style","display: block; padding-right: 17px;",4,"ngIf"],[1,"event",2,"color","red","font-style","italic","font-weight","bolder","margin-bottom","5%","font-size","small"],[1,"modal-backdrop"],["id","roleSelectionModal","tabindex","-1","aria-labelledby","roleSelectionModalLabel",1,"modal","show",2,"display","block","padding-right","17px"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header","custom-header"],["id","roleSelectionModalLabel",1,"modal-title"],[1,"header-right"],["src","assets/images/logo-prorep-c.png","width","120","alt","PROREP Logo"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"form-group"],["id","roleSelector",1,"form-control",3,"ngModel","ngModelChange"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[3,"value"]],template:function(e,i){1&e&&(t.TgZ(0,"html",0)(1,"head"),t._UZ(2,"meta",1)(3,"meta",2)(4,"meta",3),t.TgZ(5,"title"),t._uU(6,"PROREP"),t.qZA(),t._UZ(7,"link",4)(8,"link",5)(9,"link",6),t.qZA(),t.TgZ(10,"body",7)(11,"div",8)(12,"div",9)(13,"div",10)(14,"a",11),t._UZ(15,"img",12),t.qZA()(),t.TgZ(16,"form",13),t.NdJ("ngSubmit",function(){return i.btnLogin()}),t.TgZ(17,"div",10)(18,"div",14)(19,"button",15),t._UZ(20,"i",16),t.qZA(),t._UZ(21,"input",17),t.qZA()(),t.TgZ(22,"div",10)(23,"div",14)(24,"button",15),t._UZ(25,"i",18),t.qZA(),t._UZ(26,"input",19),t.qZA()(),t.YNc(27,v,2,1,"div",20),t.TgZ(28,"div",10)(29,"button",21),t._uU(30,"Iniciar Sesi\xf3n "),t._UZ(31,"i",22),t.qZA()(),t.TgZ(32,"a",23),t._uU(33,"\xbfOlvid\xf3 su contrase\xf1a?"),t.qZA()()()(),t.YNc(34,b,1,0,"div",24),t.YNc(35,_,18,3,"div",25),t.qZA()()),2&e&&(t.xp6(16),t.Q6J("formGroup",i.formData),t.xp6(11),t.Q6J("ngIf",i.error),t.xp6(7),t.Q6J("ngIf",i.multiRol),t.xp6(1),t.Q6J("ngIf",i.multiRol))},dependencies:[u.sg,u.O5,c.yS,n._Y,n.YN,n.Kr,n.Fj,n.EJ,n.JJ,n.JL,n.On,n.sg,n.u],styles:[f,f]}),o})();var C=l(5226),g=l.n(C);function S(o,s){1&o&&(t.TgZ(0,"div",10)(1,"div",17)(2,"button",18),t._UZ(3,"i",19),t.qZA(),t._UZ(4,"input",20),t.qZA()())}function w(o,s){1&o&&(t.TgZ(0,"div",10)(1,"div",10)(2,"div",17)(3,"button",18),t._UZ(4,"i",19),t.qZA(),t._UZ(5,"input",21),t.qZA()(),t.TgZ(6,"div",17)(7,"button",18),t._UZ(8,"i",19),t.qZA(),t._UZ(9,"input",22),t.qZA()())}function I(o,s){1&o&&(t.TgZ(0,"div",10)(1,"div",10)(2,"div",17)(3,"button",18),t._UZ(4,"i",19),t.qZA(),t._UZ(5,"input",21),t.qZA()(),t.TgZ(6,"div",10)(7,"div",17)(8,"button",18),t._UZ(9,"i",19),t.qZA(),t._UZ(10,"input",23),t.qZA()(),t.TgZ(11,"div",10)(12,"div",17)(13,"button",18),t._UZ(14,"i",24),t.qZA(),t._UZ(15,"input",25),t.qZA()(),t.TgZ(16,"div",10)(17,"div",17)(18,"button",18),t._UZ(19,"i",24),t.qZA(),t._UZ(20,"input",26),t.qZA()()())}const x=[{path:"",children:[{path:"login",component:y},{path:"sendCode",component:(()=>{class o{constructor(e,i,r){this.fb=e,this.authService=i,this.router=r,this.step=0,this.msg="",this.formData=this.fb.group({user:["",[n.kI.required,n.kI.email]],code:["",[n.kI.required,n.kI.minLength(6),n.kI.maxLength(6)]],password:["",[n.kI.required,n.kI.minLength(3)]],repeatPassword:["",[n.kI.required,n.kI.minLength(3)]]})}btnSendCode(){if(0==this.step){const{user:e}=this.formData.value;this.authService.sendCode(e).subscribe(i=>{i.status?this.step++:g().fire({title:"Correo no es  correcto, intente nuevamente",icon:"error"})})}if(1==this.step){const{user:e,code:i}=this.formData.value;this.authService.verifyCode(i,e).subscribe({next:r=>{r.status?this.step++:(this.msg=r.msg,g().fire({title:this.msg,icon:"error"}))},error:r=>{this.msg=r.msg}})}if(2==this.step){const{user:e,password:i,repeatPassword:r}=this.formData.value;this.authService.recovery(e,i,r).subscribe({next:a=>{a.status?(g().fire({title:"Contrase\xf1a modificada exitosamente",icon:"success"}),this.router.navigate(["/auth/login"])):(this.msg=a.msg,g().fire({title:this.msg,icon:"error"}))},error:a=>{this.msg=a.msg,g().fire({title:this.msg,icon:"error"})}})}}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(n.qu),t.Y36(p.e),t.Y36(c.F0))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-send-code"]],decls:24,vars:4,consts:[["lang","es"],["charset","UTF-8"],["http-equiv","X-UA-Compatible","content","IE=edge"],["name","viewport","content","width=device-width, initial-scale=1.0"],["rel","preconnect","href","https://fonts.googleapis.com"],["rel","preconnect","href","https://fonts.gstatic.com","crossorigin",""],["href","https://fonts.googleapis.com/css2?family=Jost:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,400;0,700;1,300;1,700&display=swap","rel","stylesheet"],[1,"body-login"],[1,"container","d-flex"],[1,"box","box-login","text-center","col-12","col-md-6","col-xl-4","position-relative"],[1,"mb-4"],["href","send-code.component.html"],["src","assets/images/logo-prorep-w.png","width","240","alt","Ir al inicio"],["autocomplete","off",1,"form-sendCode",3,"formGroup","ngSubmit"],["class","mb-4",4,"ngIf"],["type","submit",1,"btn","btn-primary","btn-fa","w-100"],["aria-hidden","true",1,"fa","fa-long-arrow-right","fa-fw"],[1,"input-group"],[1,"input-group-text","input-group-text-left"],["aria-hidden","true",1,"fa","fa-user","fa-fw"],["type","user","id","usuario","formControlName","user","placeholder","Ingrese su correo",1,"form-control"],["type","user","readonly","","id","usuario","formControlName","user","placeholder","Ingrese su correo",1,"form-control"],["type","code","id","code","formControlName","code","placeholder","Ingrese c\xf3digo",1,"form-control"],["type","code","readonly","","id","code","formControlName","code","placeholder","Ingrese c\xf3digo",1,"form-control"],["aria-hidden","true",1,"fa","fa-lock","fa-fw"],["type","password","id","password","formControlName","password","placeholder","Nueva contrase\xf1a",1,"form-control"],["type","password","id","repeatPassword","formControlName","repeatPassword","placeholder","Repetir contrase\xf1a",1,"form-control"]],template:function(e,i){1&e&&(t.TgZ(0,"html",0)(1,"head"),t._UZ(2,"meta",1)(3,"meta",2)(4,"meta",3),t.TgZ(5,"title"),t._uU(6,"PROREP"),t.qZA(),t._UZ(7,"link",4)(8,"link",5)(9,"link",6),t.qZA(),t.TgZ(10,"body",7)(11,"div",8)(12,"div",9)(13,"div",10)(14,"a",11),t._UZ(15,"img",12),t.qZA()(),t.TgZ(16,"form",13),t.NdJ("ngSubmit",function(){return i.btnSendCode()}),t.YNc(17,S,5,0,"div",14),t.YNc(18,w,10,0,"div",14),t.YNc(19,I,21,0,"div",14),t.TgZ(20,"div",10)(21,"button",15),t._uU(22,"Enviar "),t._UZ(23,"i",16),t.qZA()()()()()()()),2&e&&(t.xp6(16),t.Q6J("formGroup",i.formData),t.xp6(1),t.Q6J("ngIf",0==i.step),t.xp6(1),t.Q6J("ngIf",1==i.step),t.xp6(1),t.Q6J("ngIf",i.step>=2))},dependencies:[u.O5,n._Y,n.Fj,n.JJ,n.JL,n.sg,n.u]}),o})()},{path:"**",redirectTo:"login",pathMatch:"full"}]}];let A=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[c.Bz.forChild(x),c.Bz]}),o})(),T=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[u.ez,A,n.u5,n.UX]}),o})()}}]);