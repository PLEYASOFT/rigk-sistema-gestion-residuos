"use strict";(self.webpackChunkrigk_sg_web=self.webpackChunkrigk_sg_web||[]).push([[744],{9821:(ue,O,m)=>{m.d(O,{d:()=>e});var Z=m(2340),C=m(8256),R=m(529);let e=(()=>{class T{constructor(s){this.http=s,this.url=`${Z.N.API_V1_URL}/establishment`}getAllEstablishment(){return this.http.get(`${this.url}/all/`)}getInovice(s,b,A,a){return this.http.post(`${this.url}/get/invoice/`,{invoice_number:s,vat:b,treatment_type:A,material_type:a})}saveInvoice(s,b,A,a,J,P,w,H,K,Q){const S=new FormData;return S.append("vat",s),S.append("id_business",b),S.append("invoice_number",A),S.append("id_detail",a),S.append("date_pr",J),S.append("value",P),S.append("valued_total",w),S.append("treatment",H),S.append("id_material",K),S.append("file",Q,Q.name),this.http.post(`${this.url}/invoice/`,S)}addEstablishment(s,b,A,a,J,P,w){return this.http.post(`${this.url}/add/`,{name:s,name_region:b,v_unica:A,id_region:a,id_comuna:J,address:P,id_business:w})}deleteEstablishment(s){return this.http.delete(`${this.url}/delete/${s}`)}getEstablishment(s){return this.http.get(`${this.url}/${s}`)}getEstablishmentByID(s){return this.http.get(`${this.url}/get/${s}`)}getIdByEstablishment(s,b,A,a){return this.http.get(`${this.url}/getIdByEstablishment/${s}/${b}/${A}/${a}`)}getDeclarationEstablishment(){return this.http.get(`${this.url}/declaration/`)}}return T.\u0275fac=function(s){return new(s||T)(C.LFG(R.eN))},T.\u0275prov=C.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})()},3813:(ue,O,m)=>{m.d(O,{b:()=>e});var Z=m(2340),C=m(529),R=m(8256);let e=(()=>{class T{constructor(s){this.http=s,this.url=`${Z.N.API_V1_URL}/manager`}getAllManager(){return this.http.get(`${this.url}/all/`)}addManager(s,b,A,a){return this.http.post(`${this.url}/add/`,{type_material:s,region:b,id_business:A,id_region:a})}deleteManager(s){return this.http.delete(`${this.url}/delete/${s}`)}getManager(s){return this.http.get(`${this.url}/${s}`)}getAllMaterials(){return this.http.get(`${this.url}/allMaterials/`)}getAllTreatments(){return this.http.get(`${this.url}/allTreatments/`)}getAllRegions(){return this.http.get(`${this.url}/regiones/`)}getRegionFromID(s){return this.http.get(`${this.url}/regiones/${s}/`)}getAllCommunes(){return this.http.get(`${this.url}/comunas/`)}getCommunesFormatted(){return this.http.get(`${this.url}/communesFormatted/`)}getAllSubmaterial(){return this.http.get(`${this.url}/submaterial/`)}getAllSubmaterialFormatted(){return this.http.get(`${this.url}/submaterialFormatted/`)}getManagersByMaterials(s,b){const A=s.join(",");return this.http.get(`${this.url}/materials/${A}/region/${b}`)}downloadExcelTemplateInvoice(){let s=new C.WM;return s=s.set("Accept","application/vnd.ms-excel"),this.http.get(`${this.url}/excel`,{headers:s,responseType:"blob"})}}return T.\u0275fac=function(s){return new(s||T)(R.LFG(C.eN))},T.\u0275prov=R.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})()},3744:(ue,O,m)=>{m.r(O),m.d(O,{ManagerStatementModule:()=>gt});var Z=m(6895),C=m(5792),R=m(4135),e=m(8256);let T=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-home"]],decls:22,vars:0,consts:[["id","content"],["aria-label","breadcrumb",1,"breadcrumbs","d-none","d-lg-block"],[1,"breadcrumb"],["aria-current","page",1,"breadcrumb-item"],["aria-hidden","true",1,"fa","fa-home"],[1,"inicio"],[1,"box","box-inicio"],[1,"row"],[1,"col-12","col-md-8"],[1,"h1"],[2,"visibility","hidden"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3),e._UZ(4,"i",4),e._uU(5," Inicio"),e.qZA()()(),e.TgZ(6,"section",5)(7,"h1"),e._uU(8,"Inicio"),e.qZA(),e.TgZ(9,"div",6)(10,"div",7)(11,"div",8)(12,"h2",9),e._uU(13,"Bienvenido/a a M\xf3dulo de Gestores"),e.qZA(),e.TgZ(14,"p",10),e._uU(15,"Como parte de las obligaciones que establece la Ley REP, los Productores deben informar la cantidad de EyE no domiciliarios (POM) puestos en el mercado el a\xf1o anterior."),e.qZA(),e.TgZ(16,"p",10),e._uU(17,"ProREP pone a disposici\xf3n de sus socios la plataforma de declaraci\xf3n que dar\xe1 cumplimiento a la obligaci\xf3n de informar sus EyE."),e.qZA(),e.TgZ(18,"p",10),e._uU(19,"La informaci\xf3n deber\xe1 subirse en los meses de enero y febrero."),e.qZA(),e.TgZ(20,"p",10),e._uU(21,"En caso de tener dudas con respecto a su declaraci\xf3n puede ver los tutoriales y preguntas frecuentes."),e.qZA()()()()()())}}),n})();var x=m(5861),s=m(433),b=m(3224),A=m(5226),a=m.n(A),J=m(371),P=m(9821),w=m(8195);function H(n,l){if(1&n&&(e.TgZ(0,"option",60),e._uU(1),e.qZA()),2&n){const t=l.$implicit;e.s9C("value",t),e.xp6(1),e.Oqu(t)}}function K(n,l){if(1&n&&(e.TgZ(0,"option",60),e._uU(1),e.qZA()),2&n){const t=l.$implicit;e.s9C("value",t),e.xp6(1),e.Oqu(t)}}function Q(n,l){if(1&n&&(e.TgZ(0,"option",60),e._uU(1),e.qZA()),2&n){const t=l.$implicit;e.s9C("value",t),e.xp6(1),e.Oqu(t)}}function S(n,l){if(1&n&&(e.TgZ(0,"option",60),e._uU(1),e.qZA()),2&n){const t=l.$implicit;e.s9C("value",t),e.xp6(1),e.Oqu(t)}}function Se(n,l){if(1&n&&(e.TgZ(0,"option",60),e._uU(1),e.qZA()),2&n){const t=l.$implicit,r=e.oxw();e.Q6J("value",t),e.xp6(1),e.Oqu(r.getStateText(t))}}function Ee(n,l){1&n&&(e.TgZ(0,"span"),e._uU(1,"Por aprobar"),e.qZA())}function Fe(n,l){1&n&&(e.TgZ(0,"span"),e._uU(1,"Aprobado"),e.qZA())}const xe=function(n){return{"no-pointer":n}};function Ce(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.ALo(13,"date"),e.qZA(),e.TgZ(14,"td"),e.YNc(15,Ee,2,0,"span",47),e.YNc(16,Fe,2,0,"span",47),e.qZA(),e.TgZ(17,"td"),e._uU(18),e.qZA(),e.TgZ(19,"td"),e._uU(20),e.qZA(),e.TgZ(21,"td")(22,"a",61),e.NdJ("click",function(){const o=e.CHM(t),i=o.index,d=o.$implicit,f=e.oxw();return e.KtG(f.handleClick(i,d.STATE_GESTOR))}),e._UZ(23,"i",62),e.qZA()()()}if(2&n){const t=l.$implicit,r=e.oxw();e.xp6(2),e.Oqu(t.NAME_BUSINESS),e.xp6(2),e.Oqu(t.NAME_ESTABLISHMENT_REGION),e.xp6(2),e.Oqu(t.TipoTratamiento),e.xp6(2),e.Oqu(t.PRECEDENCE),e.xp6(2),e.Oqu(t.TYPE_RESIDUE),e.xp6(2),e.Oqu(e.xi3(13,13,t.FechaRetiro,"dd-MM-yyyy")),e.xp6(3),e.Q6J("ngIf",0==t.STATE_GESTOR),e.xp6(1),e.Q6J("ngIf",0!=t.STATE_GESTOR),e.xp6(2),e.Oqu(r.replaceDot(t.VALUE)),e.xp6(2),e.Oqu(r.formatValue(t.VALUE_DECLARATE)),e.xp6(2),e.Q6J("ngClass",e.VKq(16,xe,0!==t.STATE_GESTOR)),e.uIk("data-bs-target",0==t.STATE_GESTOR?"#infoModal":null),e.xp6(1),e.Q6J("ngClass",0==t.STATE_GESTOR?"color-verde-opaco":"color-verde")}}const qe=function(n,l){return{"btn-info":n,"btn-primary":l}};function Ue(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"li")(1,"button",63),e.NdJ("click",function(){const i=e.CHM(t).index,d=e.oxw();return e.KtG(d.pagTo(i))}),e._uU(2),e.qZA()()}if(2&n){const t=l.index,r=e.oxw();e.xp6(1),e.Q6J("ngClass",e.WLB(2,qe,r.pos==t+1,r.pos!=t+1)),e.xp6(1),e.Oqu(t+1)}}function Ne(n,l){1&n&&(e.TgZ(0,"p"),e._uU(1,"Debe ingresar un n\xfamero de factura."),e.qZA())}function ye(n,l){if(1&n&&(e.TgZ(0,"div",64),e.YNc(1,Ne,2,0,"p",47),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.userForm.controls.invoiceNumber.errors.required)}}function Ie(n,l){1&n&&(e.TgZ(0,"p"),e._uU(1,"El rut de la empresa es requerido."),e.qZA())}function Me(n,l){1&n&&(e.TgZ(0,"p"),e._uU(1,"El formato del RUT es inv\xe1lido (Sin puntos y con gui\xf3n)."),e.qZA())}function De(n,l){1&n&&(e.TgZ(0,"p"),e._uU(1,"El digito verificador es incorrecto. "),e.qZA())}function Oe(n,l){if(1&n&&(e.TgZ(0,"div",46),e.YNc(1,Ie,2,0,"p",47),e.YNc(2,Me,2,0,"p",47),e.YNc(3,De,2,0,"p",47),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.userForm.controls.rut.errors.required),e.xp6(1),e.Q6J("ngIf",t.userForm.controls.rut.errors.pattern),e.xp6(1),e.Q6J("ngIf",t.userForm.controls.rut.errors.rut)}}function Re(n,l){if(1&n&&(e.TgZ(0,"option",60),e._uU(1),e.qZA()),2&n){const t=l.$implicit;e.s9C("value",t.ID),e.xp6(1),e.Oqu(t.NAME)}}function Pe(n,l){1&n&&(e.TgZ(0,"p"),e._uU(1,"Rut no se encuentra registrado en el sistema. "),e.qZA())}function we(n,l){1&n&&(e.TgZ(0,"p"),e._uU(1,"El rut de la empresa es requerido."),e.qZA())}function We(n,l){if(1&n&&(e.TgZ(0,"div",46),e.YNc(1,we,2,0,"p",47),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.userForm.controls.treatmentType.errors.required)}}function $e(n,l){1&n&&(e.TgZ(0,"p"),e._uU(1,"El rut de la empresa es requerido."),e.qZA())}function Je(n,l){if(1&n&&(e.TgZ(0,"div",46),e.YNc(1,$e,2,0,"p",47),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.userForm.controls.material.errors.required)}}function Be(n,l){1&n&&(e.TgZ(0,"p"),e._uU(1,"Debe ingresar una fecha."),e.qZA())}function ke(n,l){1&n&&(e.TgZ(0,"p"),e._uU(1,"La fecha no puede ser futura."),e.qZA())}function Ye(n,l){if(1&n&&(e.TgZ(0,"div",64),e.YNc(1,Be,2,0,"p",47),e.YNc(2,ke,2,0,"p",47),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.userForm.controls.entryDate.errors.required),e.xp6(1),e.Q6J("ngIf",t.userForm.controls.entryDate.errors.futureDate)}}function Le(n,l){1&n&&(e.TgZ(0,"p"),e._uU(1,"Debe ingresar un peso total."),e.qZA())}function Ve(n,l){1&n&&(e.TgZ(0,"p"),e._uU(1,"Debe ingresar un n\xfamero v\xe1lido (con coma)."),e.qZA())}function Qe(n,l){1&n&&(e.TgZ(0,"p"),e._uU(1,"El valor debe ser mayor que cero."),e.qZA())}function Ge(n,l){if(1&n&&(e.TgZ(0,"div",64),e.YNc(1,Le,2,0,"p",47),e.YNc(2,Ve,2,0,"p",47),e.YNc(3,Qe,2,0,"p",47),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.userForm.controls.totalWeight.errors.required),e.xp6(1),e.Q6J("ngIf",t.userForm.controls.totalWeight.errors.pattern),e.xp6(1),e.Q6J("ngIf",t.userForm.controls.totalWeight.errors.minStringValue)}}function je(n,l){1&n&&(e.TgZ(0,"p"),e._uU(1,"Debe ingresar un peso valorizado."),e.qZA())}function ze(n,l){1&n&&(e.TgZ(0,"p"),e._uU(1,"Debe ingresar un n\xfamero v\xe1lido (Con coma)."),e.qZA())}function He(n,l){1&n&&(e.TgZ(0,"p"),e._uU(1,"El valor debe ser mayor que cero."),e.qZA())}function Ke(n,l){if(1&n&&(e.TgZ(0,"div",64),e.YNc(1,je,2,0,"p",47),e.YNc(2,ze,2,0,"p",47),e.YNc(3,He,2,0,"p",47),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.userForm.controls.valuedWeight.errors.required),e.xp6(1),e.Q6J("ngIf",t.userForm.controls.valuedWeight.errors.pattern),e.xp6(1),e.Q6J("ngIf",t.userForm.controls.valuedWeight.errors.minStringValue)}}function Xe(n,l){1&n&&(e.TgZ(0,"div",46)(1,"p"),e._uU(2,"El peso remanente no puede ser menor que cero."),e.qZA()())}function et(n,l){1&n&&(e.TgZ(0,"p"),e._uU(1,"El formato del archivo debe ser PDF, JPEG o JPG."),e.qZA())}function tt(n,l){1&n&&(e.TgZ(0,"p"),e._uU(1,"El tama\xf1o del archivo no debe superar 1 MB."),e.qZA())}function rt(n,l){if(1&n&&(e.TgZ(0,"div",46),e.YNc(1,et,2,0,"p",47),e.YNc(2,tt,2,0,"p",47),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.userForm.controls.attachment.errors.invalidFileType),e.xp6(1),e.Q6J("ngIf",t.userForm.controls.attachment.errors.invalidFileSize)}}let ot=(()=>{class n{constructor(t,r,o,i){this.productorService=t,this.establishmentService=r,this.businessService=o,this.fb=i,this.disableWeightFields=!0,this.dbStatements=[],this.db=[],this.pos=1,this.business_name=[],this.establishment_name=[],this.material_name=[],this.treatment_name=[],this.years=[],this.state=[],this.cant=0,this.filteredStatements=[],this.selectedBusiness="-1",this.selectedMaterial="-1",this.selectedYear="-1",this.selectedTreatment="-1",this.selectedState="-1",this.autoFilter=!0,this.isRemainingWeightNegative=!1,this.index=0,this.userForm=this.fb.group({invoiceNumber:["",[s.kI.required]],rut:["",[s.kI.required,s.kI.pattern("^[0-9]{1,2}[0-9]{3}[0-9]{3}-[0-9Kk]{1}$"),this.verifyRut]],reciclador:["0",[s.kI.required]],treatmentType:["",[s.kI.required]],material:["",[s.kI.required]],entryDate:["",[s.kI.required,this.pastDateValidator()]],totalWeight:["",[s.kI.required,this.minStringValue(0),s.kI.pattern(/^[0-9]+(,[0-9]+)?$/)]],declarateWeight:[""],valuedWeight:["",[s.kI.required,this.minStringValue(0),s.kI.pattern(/^[0-9]+(,[0-9]+)?$/)]],remainingWeight:[""],asoc:[""],declarated:[""],attachment:[null,[s.kI.required,this.fileTypeValidator,this.fileSizeValidator]]}),this.dbBusiness=[],this.businessNoFound=!1}ngOnInit(){this.userData=JSON.parse(sessionStorage.getItem("user")),this.loadStatements().then(()=>{this.filter(),this.pagTo(this.pos-1)}),this.userForm.controls.valuedWeight.disable(),this.userForm.controls.totalWeight.disable(),this.userForm.controls.reciclador.disable()}loadStatements(){return new Promise(t=>{a().fire({title:"Cargando Datos",text:"Se est\xe1n recuperando datos",timerProgressBar:!0,showConfirmButton:!1,allowEscapeKey:!1,allowOutsideClick:!1}),a().showLoading(),this.establishmentService.getDeclarationEstablishment().subscribe(r=>{r.status&&(r.status=r.status.sort((o,i)=>{const d=new Date(i.FechaRetiro).getTime()-new Date(o.FechaRetiro).getTime();return 0===d?i.ID_DETAIL-o.ID_DETAIL:d}),r.status.forEach(o=>{-1==this.business_name.indexOf(o.NAME_BUSINESS)&&this.business_name.push(o.NAME_BUSINESS),-1==this.establishment_name.indexOf(o.NAME_ESTABLISHMENT_REGION)&&this.establishment_name.push(o.NAME_ESTABLISHMENT_REGION),-1==this.years.indexOf(o.FechaRetiroTipeada)&&this.years.push(o.FechaRetiroTipeada),-1==this.material_name.indexOf(o.PRECEDENCE)&&this.material_name.push(o.PRECEDENCE),-1==this.treatment_name.indexOf(o.TipoTratamiento)&&this.treatment_name.push(o.TipoTratamiento),-1==this.state.indexOf(o.STATE_GESTOR)&&this.state.push(o.STATE_GESTOR)}),this.years.sort((o,i)=>i-o),this.dbStatements=r.status,this.cant=Math.ceil(this.dbStatements.length/10),this.db=this.dbStatements.slice(10*(this.pos-1),10*this.pos).sort((o,i)=>{const d=new Date(i.FechaRetiro).getTime()-new Date(o.FechaRetiro).getTime();return 0===d?i.ID_DETAIL-o.ID_DETAIL:d}),a().close()),t()})})}filter(t=!1){t&&!this.autoFilter||(this.filteredStatements=this.dbStatements.filter(r=>!("-1"!==this.selectedBusiness&&r.NAME_BUSINESS!==this.selectedBusiness||"-1"!==this.selectedMaterial&&r.PRECEDENCE!==this.selectedMaterial||"-1"!==this.selectedTreatment&&r.TipoTratamiento!==this.selectedTreatment||"-1"!==this.selectedYear&&r.FechaRetiroTipeada!==this.selectedYear||"-1"!==this.selectedState&&parseInt(r.STATE_GESTOR)!==parseInt(this.selectedState))),this.db=this.filteredStatements.slice(0,10).sort((r,o)=>{const i=new Date(o.FechaRetiro).getTime()-new Date(r.FechaRetiro).getTime();return 0===i?o.ID_DETAIL-r.ID_DETAIL:i}),this.cant=Math.ceil(this.filteredStatements.length/10))}updateFilters(){this.business_name=this.dbStatements.filter(t=>!("-1"!==this.selectedTreatment&&t.TipoTratamiento!==this.selectedTreatment||"-1"!==this.selectedMaterial&&t.PRECEDENCE!==this.selectedMaterial||"-1"!==this.selectedYear&&t.FechaRetiroTipeada!==this.selectedYear||"-1"!==this.selectedState&&parseInt(t.STATE_GESTOR)!==parseInt(this.selectedState)&&void 0!==t.STATE_GESTOR)).map(t=>t.NAME_BUSINESS).filter((t,r,o)=>o.indexOf(t)===r),this.treatment_name=this.dbStatements.filter(t=>!("-1"!==this.selectedBusiness&&t.NAME_BUSINESS!==this.selectedBusiness||"-1"!==this.selectedMaterial&&t.PRECEDENCE!==this.selectedMaterial||"-1"!==this.selectedYear&&t.FechaRetiroTipeada!==this.selectedYear||"-1"!==this.selectedState&&parseInt(t.STATE_GESTOR)!==parseInt(this.selectedState)&&void 0!==t.STATE_GESTOR)).map(t=>t.TipoTratamiento).filter((t,r,o)=>o.indexOf(t)===r),this.material_name=this.dbStatements.filter(t=>!("-1"!==this.selectedBusiness&&t.NAME_BUSINESS!==this.selectedBusiness||"-1"!==this.selectedTreatment&&t.TipoTratamiento!==this.selectedTreatment||"-1"!==this.selectedYear&&t.FechaRetiroTipeada!==this.selectedYear||"-1"!==this.selectedState&&parseInt(t.STATE_GESTOR)!==parseInt(this.selectedState)&&void 0!==t.STATE_GESTOR)).map(t=>t.PRECEDENCE).filter((t,r,o)=>o.indexOf(t)===r),this.years=this.dbStatements.filter(t=>!("-1"!==this.selectedBusiness&&t.NAME_BUSINESS!==this.selectedBusiness||"-1"!==this.selectedTreatment&&t.TipoTratamiento!==this.selectedTreatment||"-1"!==this.selectedMaterial&&t.PRECEDENCE!==this.selectedMaterial||"-1"!==this.selectedState&&parseInt(t.STATE_GESTOR)!==parseInt(this.selectedState)&&void 0!==t.STATE_GESTOR)).map(t=>t.FechaRetiroTipeada).filter((t,r,o)=>o.indexOf(t)===r).sort((t,r)=>r-t),this.state=this.dbStatements.filter(t=>!("-1"!==this.selectedBusiness&&t.NAME_BUSINESS!==this.selectedBusiness||"-1"!==this.selectedTreatment&&t.TipoTratamiento!==this.selectedTreatment||"-1"!==this.selectedMaterial&&t.PRECEDENCE!==this.selectedMaterial||"-1"!==this.selectedYear&&t.FechaRetiroTipeada!==this.selectedYear)).map(t=>parseInt(t.STATE_GESTOR)).filter((t,r,o)=>o.indexOf(t)===r)}reset(){this.loadStatements().then(()=>{this.filter(),this.pagTo(this.pos-1)}),this.userForm.reset({reciclador:"0"})}pagTo(t){this.pos=t+1,this.db=this.filteredStatements.slice(10*t,10*(t+1)).sort((r,o)=>{const i=new Date(o.FechaRetiro).getTime()-new Date(r.FechaRetiro).getTime();return 0===i?o.ID_DETAIL-r.ID_DETAIL:i})}next(){this.pos>=this.cant||(this.pos++,this.db=this.filteredStatements.slice(10*(this.pos-1),10*this.pos).sort((t,r)=>{const o=new Date(r.FechaRetiro).getTime()-new Date(t.FechaRetiro).getTime();return 0===o?r.ID_DETAIL-t.ID_DETAIL:o}))}previus(){this.pos-1<=0||this.pos>=this.cant+1||(this.pos=this.pos-1,this.db=this.filteredStatements.slice(10*(this.pos-1),10*this.pos).sort((t,r)=>{const o=new Date(r.FechaRetiro).getTime()-new Date(t.FechaRetiro).getTime();return 0===o?r.ID_DETAIL-t.ID_DETAIL:o}))}setArrayFromNumber(){return new Array(this.cant)}getStateText(t){return 0===t?"Por aprobar":"Aprobado"}handleClick(t,r){this.dbBusiness=[],0===r&&(this.onMaterialTreatmentChange(t),this.index=t)}fileTypeValidator(t){const r=t.value;return r&&!["application/pdf","image/jpeg"].includes(r.type)?{invalidFileType:!0}:null}fileSizeValidator(t){const r=t.value;return r&&r.size>1048576?{invalidFileSize:!0}:null}onFileSelected(t){const r=t.target;if(r&&r.files&&r.files.length>0){const o=r.files[0];this.fileName=o.name,this.fileBuffer=o,this.selectedFile=r.files[0];const i=["pdf","jpeg","jpg"],d=this.selectedFile.name.split(".").pop()?.toLowerCase()||"";i.includes(d)?o.size>1048576?(this.userForm.controls.attachment.setErrors({invalidFileSize:!0}),this.userForm.controls.attachment.markAsTouched()):(this.userForm.controls.attachment.setErrors(null),this.userForm.controls.attachment.markAsTouched()):(this.userForm.controls.attachment.setErrors({invalidFileType:!0}),this.userForm.controls.attachment.markAsTouched())}else this.selectedFile=null}saveInvoice(t){var r=this;return(0,x.Z)(function*(){if(r.selectedFile){const{rut:o,invoiceNumber:i,entryDate:d,valuedWeight:f,reciclador:v}=r.userForm.value,_=r.userForm.controls.totalWeight.value,N=r.db[t].TREATMENT_TYPE_NUMBER,W=r.db[t].PRECEDENCE_NUMBER,y=r.db[t].ID_DETAIL;try{(yield r.establishmentService.saveInvoice(o,v,i,y,d,f.replace(",","."),_.replace(",","."),N,W,r.selectedFile).toPromise()).status&&setTimeout((0,x.Z)(function*(){yield a().fire({title:"La factura fue guardada exitosamente",text:"",icon:"success",showConfirmButton:!0})}),1500)}catch(F){console.error("Error:",F)}}else console.error("No file selected")})()}onChangeVAT(t){this.dbBusiness=[],this.businessService.getBusinessByVAT(t.value).subscribe(r=>{this.dbBusiness=r.status||[],this.userForm.controls.reciclador.enable(),this.businessNoFound=!1,0==this.dbBusiness.length&&(this.businessNoFound=!0,this.userForm.controls.reciclador.disable(),this.userForm.controls.reciclador.setValue("0"))})}formatNumber(t){return null==t?"":Number.isInteger(t)?t.toString():t.toLocaleString("es")}onRUTChange(t){var r=this;return(0,x.Z)(function*(){const o=r.userForm.controls.rut.value,i=r.userForm.controls.invoiceNumber.value,d=r.db[t].TREATMENT_TYPE_NUMBER,f=r.db[t].PRECEDENCE_NUMBER;if(o)try{const _=yield r.establishmentService.getInovice(i,o,d,f).toPromise();_.status?(r.userForm.controls.totalWeight.setValue(r.formatNumber(_.data[0]?.invoice_value)),r.userForm.controls.declarateWeight.setValue(r.formatNumber(_.data[0].value_declarated)),r.userForm.controls.asoc.setValue(_.data[0].num_asoc+1),parseInt(r.userForm.controls.asoc.value||"0")>1?i?r.userForm.controls.valuedWeight.enable():r.userForm.controls.valuedWeight.disable():i?(r.userForm.controls.valuedWeight.enable(),r.userForm.controls.totalWeight.enable()):(r.userForm.controls.valuedWeight.disable(),r.userForm.controls.totalWeight.disable())):(a().fire({icon:"error",text:_.msg}),r.userForm.controls.totalWeight.setValue(""),r.userForm.controls.declarateWeight.setValue(""),r.userForm.controls.asoc.setValue(""),r.userForm.controls.remainingWeight.setValue(""),r.userForm.controls.valuedWeight.disable(),r.userForm.controls.totalWeight.disable())}catch{r.userForm.controls.totalWeight.setValue(""),r.userForm.controls.declarateWeight.setValue(""),r.userForm.controls.asoc.setValue(""),r.userForm.controls.remainingWeight.setValue(""),r.userForm.controls.valuedWeight.disable(),r.userForm.controls.totalWeight.disable()}else r.userForm.controls.totalWeight.setValue(""),r.userForm.controls.declarateWeight.setValue(""),r.userForm.controls.asoc.setValue(""),r.userForm.controls.remainingWeight.setValue(""),r.userForm.controls.valuedWeight.disable(),r.userForm.controls.totalWeight.disable();r.userForm.controls.valuedWeight.updateValueAndValidity(),r.userForm.controls.totalWeight.updateValueAndValidity()})()}onMaterialTreatmentChange(t){var r=this;return(0,x.Z)(function*(){r.userForm.controls.treatmentType.setValue(r.db[t].TipoTratamiento),r.userForm.controls.material.setValue(r.db[t].PRECEDENCE),r.userForm.controls.declarated.setValue(r.db[t].VALUE?.toString().replace(".",","))})()}verifyRut(t){return(0,b.validate)(t.value)?null:{rut:!0}}isTotalWeightEditable(){return!!this.userForm.controls.invoiceNumber.value&&!!this.userForm.controls.rut.value}getNumericValue(t){return t&&t.value?+t.value.toString().replace(",","."):0}calculateRemainingWeight(){const t=this.userForm.get("totalWeight"),r=this.userForm.get("valuedWeight"),o=this.userForm.get("declarateWeight"),v=this.getNumericValue(t)-this.getNumericValue(r)-this.getNumericValue(o);return this.isRemainingWeightNegative=v<0,v.toFixed(2).replace(".",",")}replaceDot(t){return 2==t.toString().split(".").length?t&&parseFloat(t).toFixed(2).replace(".",","):t&&t.toString().replace(".",",")}minStringValue(t){return r=>{if(!r.value)return null;const o=parseFloat(r.value.replace(",","."));return isNaN(o)||o<=t?{minStringValue:{value:r.value}}:null}}formatValue(t){return null==t?"":t%1==0?t.toString():t.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})}pastDateValidator(){return t=>{const r=new Date(t.value),o=new Date;return o.setHours(0,0,0,0),r>o?{futureDate:{value:t.value}}:null}}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(J.u),e.Y36(P.d),e.Y36(w.m),e.Y36(s.qu))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-statements"]],decls:190,vars:28,consts:[[1,"container","mt-4"],["aria-label","breadcrumb",1,"breadcrumbs","d-none","d-lg-block"],[1,"breadcrumb"],[1,"breadcrumb-item"],["href","#"],["aria-hidden","true",1,"fa","fa-home"],["aria-current","page",1,"breadcrumb-item","active"],[1,"declaracion"],[1,"box","box-form","mb-4"],[1,"row","align-items-end"],[1,"col-12","col-xl-2","mb-3","mb-xl-0"],[1,"form-label"],[1,"input-group"],["id","f_name",1,"form-select",3,"ngModel","ngModelChange","change"],["value","-1","selected",""],[3,"value",4,"ngFor","ngForOf"],["id","f_establishment",1,"form-select",3,"ngModel","ngModelChange","change"],["id","f_material",1,"form-select",3,"ngModel","ngModelChange","change"],["id","f_year",1,"form-select",3,"ngModel","ngModelChange","change"],["id","f_state",1,"form-select",3,"ngModel","ngModelChange","change"],[1,"btn","btn-primary","w-100",3,"click"],[1,"table-responsive"],[1,"table","table-even","table-section","table-borderless","table-radius"],[1,"vertical-middle"],[4,"ngFor","ngForOf"],["aria-label","Navegaci\xf3n resultados"],[1,"pagination"],[1,"btn","btn-primary",3,"click"],["id","infoModal","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade",3,"hidden.bs.modal"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","exampleModalLabel",1,"modal-title","fs-5"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[3,"formGroup"],["miFormulario","ngForm"],[1,"row","mb-3"],[1,"col-sm-4","col-form-label"],[1,"col-sm-8"],["type","text","placeholder","1234","formControlName","invoiceNumber",1,"form-control",3,"input"],["class","text-danger",4,"ngIf"],["type","text","placeholder","1-9","formControlName","rut",1,"form-control",3,"readonly","change"],["class","text-danger pl-0",4,"ngIf"],["formControlName","reciclador",1,"form-select",3,"disabled","change"],["value","0"],[1,"text-danger","pl-0"],[4,"ngIf"],["type","text","placeholder","Tipo tratamiento","formControlName","treatmentType","readonly","",1,"form-control"],["type","text","placeholder","Tipo material","formControlName","material","readonly","",1,"form-control"],["type","date","placeholder","10/4/2023","formControlName","entryDate",1,"form-control"],["type","text","formControlName","totalWeight",1,"form-control"],["type","text","formControlName","declarated","readonly","",1,"form-control"],["type","text","formControlName","valuedWeight",1,"form-control"],["type","text","formControlName","remainingWeight","readonly","",1,"form-control",3,"value"],["type","text","formControlName","asoc","readonly","",1,"form-control"],["type","file","formControlName","attachment","id","inp_attachment","accept","application/pdf, image/jpeg","required","",1,"form-control",3,"change"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary",3,"click"],["type","button","data-bs-dismiss","modal",1,"btn","btn-primary",3,"disabled","click"],[3,"value"],["data-bs-toggle","modal",1,"custom-cursor",3,"ngClass","click"],["aria-hidden","true",1,"fa","fa-check","fa-lg","fa-fw",3,"ngClass"],[1,"border","btn","btn-sm",3,"ngClass","click"],[1,"text-danger"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),e._UZ(5,"i",5),e._uU(6," Inicio"),e.qZA()(),e.TgZ(7,"li",6),e._uU(8,"Consulta de Declaraci\xf3n"),e.qZA()()(),e.TgZ(9,"section",7)(10,"h1"),e._uU(11,"Consulta de Declaraci\xf3n"),e.qZA(),e.TgZ(12,"div",8)(13,"div",9)(14,"div",10)(15,"label",11),e._uU(16,"Empresa CI:"),e.qZA(),e.TgZ(17,"div",12)(18,"select",13),e.NdJ("ngModelChange",function(i){return r.selectedBusiness=i})("change",function(){return r.updateFilters()}),e.TgZ(19,"option",14),e._uU(20,"Todos"),e.qZA(),e.YNc(21,H,2,2,"option",15),e.qZA()()(),e.TgZ(22,"div",10)(23,"label",11),e._uU(24,"Tipo de tratamiento:"),e.qZA(),e.TgZ(25,"div",12)(26,"select",16),e.NdJ("ngModelChange",function(i){return r.selectedTreatment=i})("change",function(){return r.updateFilters()}),e.TgZ(27,"option",14),e._uU(28,"Todos"),e.qZA(),e.YNc(29,K,2,2,"option",15),e.qZA()()(),e.TgZ(30,"div",10)(31,"label",11),e._uU(32,"Material:"),e.qZA(),e.TgZ(33,"div",12)(34,"select",17),e.NdJ("ngModelChange",function(i){return r.selectedMaterial=i})("change",function(){return r.updateFilters()}),e.TgZ(35,"option",14),e._uU(36,"Todos"),e.qZA(),e.YNc(37,Q,2,2,"option",15),e.qZA()()(),e.TgZ(38,"div",10)(39,"label",11),e._uU(40,"Fecha de retiro:"),e.qZA(),e.TgZ(41,"div",12)(42,"select",18),e.NdJ("ngModelChange",function(i){return r.selectedYear=i})("change",function(){return r.updateFilters()}),e.TgZ(43,"option",14),e._uU(44,"Todos"),e.qZA(),e.YNc(45,S,2,2,"option",15),e.qZA()()(),e.TgZ(46,"div",10)(47,"label",11),e._uU(48,"Estado:"),e.qZA(),e.TgZ(49,"div",12)(50,"select",19),e.NdJ("ngModelChange",function(i){return r.selectedState=i})("change",function(){return r.updateFilters()}),e.TgZ(51,"option",14),e._uU(52,"Todos"),e.qZA(),e.YNc(53,Se,2,2,"option",15),e.qZA()()(),e.TgZ(54,"div",10)(55,"label",11),e._uU(56,"\xa0"),e.qZA(),e.TgZ(57,"div",12)(58,"button",20),e.NdJ("click",function(){return r.autoFilter=!1,r.filter(),r.pagTo(0)}),e._uU(59,"Mostrar"),e.qZA()()()()(),e.TgZ(60,"div",21)(61,"table",22)(62,"thead",23)(63,"tr")(64,"th"),e._uU(65,"Empresa CI"),e.qZA(),e.TgZ(66,"th"),e._uU(67,"Establecimiento CI"),e.qZA(),e.TgZ(68,"th"),e._uU(69,"Tipo de tratamiento"),e.qZA(),e.TgZ(70,"th"),e._uU(71,"Material"),e.qZA(),e.TgZ(72,"th"),e._uU(73,"Subtipo"),e.qZA(),e.TgZ(74,"th"),e._uU(75,"Fecha Retiro"),e.qZA(),e.TgZ(76,"th"),e._uU(77,"Estado"),e.qZA(),e.TgZ(78,"th"),e._uU(79,"Peso Declarado"),e.qZA(),e.TgZ(80,"th"),e._uU(81,"Peso Valorizado"),e.qZA(),e.TgZ(82,"th"),e._uU(83,"Aprobar"),e.qZA()()(),e.TgZ(84,"tbody"),e.YNc(85,Ce,24,18,"tr",24),e.qZA()()(),e.TgZ(86,"nav",25)(87,"ul",26)(88,"li")(89,"button",27),e.NdJ("click",function(){return r.pagTo(0)}),e._uU(90,"Primero"),e.qZA()(),e.TgZ(91,"li")(92,"button",27),e.NdJ("click",function(){return r.previus()}),e._uU(93,"Anterior"),e.qZA()(),e.YNc(94,Ue,3,5,"li",24),e.TgZ(95,"li")(96,"button",27),e.NdJ("click",function(){return r.next()}),e._uU(97,"Siguiente"),e.qZA()(),e.TgZ(98,"li")(99,"button",27),e.NdJ("click",function(){return r.pagTo(r.cant-1)}),e._uU(100,"\xdaltimo"),e.qZA()()()()()(),e.TgZ(101,"div",28),e.NdJ("hidden.bs.modal",function(){return r.reset()}),e.TgZ(102,"div",29)(103,"div",30)(104,"div",31)(105,"h1",32),e._uU(106,"Asignar factura reciclador"),e.qZA(),e._UZ(107,"button",33),e.qZA(),e.TgZ(108,"div",34)(109,"form",35,36)(111,"div",37)(112,"label",38),e._uU(113,"N\xfam. Factura Reciclador"),e.qZA(),e.TgZ(114,"div",39)(115,"input",40),e.NdJ("input",function(){return r.onRUTChange(r.index)}),e.qZA(),e.YNc(116,ye,2,1,"div",41),e.qZA()(),e.TgZ(117,"div",37)(118,"label",38),e._uU(119,"RUT Reciclador"),e.qZA(),e.TgZ(120,"div",39)(121,"input",42),e.NdJ("change",function(i){return r.onChangeVAT(i.target)}),e.qZA(),e.YNc(122,Oe,4,3,"div",43),e.qZA()(),e.TgZ(123,"div",37)(124,"label",38),e._uU(125,"Reciclador"),e.qZA(),e.TgZ(126,"div",39)(127,"select",44),e.NdJ("change",function(){return r.onRUTChange(r.index)}),e.TgZ(128,"option",45),e._uU(129,"Seleccione Reciclador"),e.qZA(),e.YNc(130,Re,2,2,"option",15),e.qZA(),e.TgZ(131,"div",46),e.YNc(132,Pe,2,0,"p",47),e.qZA()()(),e.TgZ(133,"div",37)(134,"label",38),e._uU(135,"Tipo Tratamiento"),e.qZA(),e.TgZ(136,"div",39),e._UZ(137,"input",48),e.YNc(138,We,2,1,"div",43),e.qZA()(),e.TgZ(139,"div",37)(140,"label",38),e._uU(141,"Material"),e.qZA(),e.TgZ(142,"div",39),e._UZ(143,"input",49),e.YNc(144,Je,2,1,"div",43),e.qZA()(),e.TgZ(145,"div",37)(146,"label",38),e._uU(147,"Fecha Ingreso PR"),e.qZA(),e.TgZ(148,"div",39),e._UZ(149,"input",50),e.YNc(150,Ye,3,2,"div",41),e.qZA()(),e.TgZ(151,"div",37)(152,"label",38),e._uU(153,"Peso Total"),e.qZA(),e.TgZ(154,"div",39),e._UZ(155,"input",51),e.YNc(156,Ge,4,3,"div",41),e.qZA()(),e.TgZ(157,"div",37)(158,"label",38),e._uU(159,"Peso Declarado"),e.qZA(),e.TgZ(160,"div",39),e._UZ(161,"input",52),e.qZA()(),e.TgZ(162,"div",37)(163,"label",38),e._uU(164,"Peso Valorizado"),e.qZA(),e.TgZ(165,"div",39),e._UZ(166,"input",53),e.YNc(167,Ke,4,3,"div",41),e.qZA()(),e.TgZ(168,"div",37)(169,"label",38),e._uU(170,"Peso Remanente"),e.qZA(),e.TgZ(171,"div",39),e._UZ(172,"input",54),e.YNc(173,Xe,3,0,"div",43),e.qZA()(),e.TgZ(174,"div",37)(175,"label",38),e._uU(176,"Num. Declaraciones asociadas"),e.qZA(),e.TgZ(177,"div",39),e._UZ(178,"input",55),e.qZA()(),e.TgZ(179,"div",37)(180,"label",38),e._uU(181,"Adjuntar"),e.qZA(),e.TgZ(182,"div",39)(183,"input",56),e.NdJ("change",function(i){return r.onFileSelected(i)}),e.qZA(),e.YNc(184,rt,3,2,"div",43),e.qZA()()()(),e.TgZ(185,"div",57)(186,"button",58),e.NdJ("click",function(){return r.userForm.reset({reciclador:"0"})}),e._uU(187,"Volver"),e.qZA(),e.TgZ(188,"button",59),e.NdJ("click",function(){return r.saveInvoice(r.index)}),e._uU(189,"Guardar"),e.qZA()()()()()),2&t&&(e.xp6(18),e.Q6J("ngModel",r.selectedBusiness),e.xp6(3),e.Q6J("ngForOf",r.business_name),e.xp6(5),e.Q6J("ngModel",r.selectedTreatment),e.xp6(3),e.Q6J("ngForOf",r.treatment_name),e.xp6(5),e.Q6J("ngModel",r.selectedMaterial),e.xp6(3),e.Q6J("ngForOf",r.material_name),e.xp6(5),e.Q6J("ngModel",r.selectedYear),e.xp6(3),e.Q6J("ngForOf",r.years),e.xp6(5),e.Q6J("ngModel",r.selectedState),e.xp6(3),e.Q6J("ngForOf",r.state),e.xp6(32),e.Q6J("ngForOf",r.db),e.xp6(9),e.Q6J("ngForOf",r.setArrayFromNumber()),e.xp6(15),e.Q6J("formGroup",r.userForm),e.xp6(7),e.Q6J("ngIf",r.userForm.controls.invoiceNumber.errors&&r.userForm.controls.invoiceNumber.touched),e.xp6(5),e.Q6J("readonly",r.userForm.controls.invoiceNumber.invalid),e.xp6(1),e.Q6J("ngIf",r.userForm.controls.rut.errors&&r.userForm.controls.rut.touched),e.xp6(5),e.Q6J("disabled",""==r.userForm.controls.invoiceNumber.value),e.xp6(3),e.Q6J("ngForOf",r.dbBusiness),e.xp6(2),e.Q6J("ngIf",r.businessNoFound&&r.userForm.controls.rut.touched),e.xp6(6),e.Q6J("ngIf",r.userForm.controls.treatmentType.errors&&r.userForm.controls.treatmentType.touched),e.xp6(6),e.Q6J("ngIf",r.userForm.controls.material.errors&&r.userForm.controls.material.touched),e.xp6(6),e.Q6J("ngIf",r.userForm.controls.entryDate.errors&&r.userForm.controls.entryDate.touched),e.xp6(6),e.Q6J("ngIf",r.userForm.controls.totalWeight.errors&&r.userForm.controls.totalWeight.touched),e.xp6(11),e.Q6J("ngIf",r.userForm.controls.valuedWeight.errors&&r.userForm.controls.valuedWeight.touched),e.xp6(5),e.Q6J("value",r.calculateRemainingWeight()),e.xp6(1),e.Q6J("ngIf",r.isRemainingWeightNegative),e.xp6(11),e.Q6J("ngIf",r.userForm.controls.attachment.errors&&r.userForm.controls.attachment.touched),e.xp6(4),e.Q6J("disabled",r.userForm.invalid||r.isRemainingWeightNegative))},dependencies:[Z.mk,Z.sg,Z.O5,s._Y,s.YN,s.Kr,s.Fj,s.EJ,s.JJ,s.JL,s.Q7,s.sg,s.u,s.On,Z.uU],styles:["[_nghost-%COMP%]{width:90%!important;padding:1%}.color-verde[_ngcontent-%COMP%]{color:green}.color-verde-opaco[_ngcontent-%COMP%]{color:#0080004d}.custom-cursor[_ngcontent-%COMP%]{cursor:pointer}.no-pointer[_ngcontent-%COMP%]{cursor:default}"]}),n})();var nt=m(263);let at=(()=>{class n{constructor(t,r,o){this.fb=t,this.authService=r,this.router=o,this.pos="right",this.horaIngreso=new Date,this.formData=this.fb.group({actual:["",[s.kI.required]],password:["",[s.kI.required,s.kI.minLength(3)]],repeatPassword:["",[s.kI.required,s.kI.minLength(3)]]})}ngOnInit(){this.userData=JSON.parse(sessionStorage.getItem("user")),this.getProfile(this.userData.EMAIL),this.horaIngreso=new Date(sessionStorage.getItem("horaIngreso"))}btnrecovery(){const{actual:t,password:r,repeatPassword:o}=this.formData.value;this.authService.modifyPassword(r,o,t).subscribe({next:i=>{i.status?(a().fire({title:"Cambio de contrase\xf1a",text:"La contrase\xf1a fue cambiada exitosamente",icon:"success"}),this.router.navigate(["/mantenedor/home"])):(a().fire({title:"Validar informaci\xf3n",text:i.msg,icon:"error"}),this.formData.reset())},error:i=>{a().fire({title:"Formato inv\xe1lido",text:"Contrase\xf1a debe contener al menos 8 caracteres",icon:"error"})}})}displayModifyPassword(){this.pos="right"==this.pos?"down":"right"}getProfile(t){this.authService.getProfile(t).subscribe(r=>{sessionStorage.setItem("user",JSON.stringify(r.data.user)),this.userData=r.data.user})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(s.qu),e.Y36(nt.e),e.Y36(C.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-profile"]],decls:81,vars:16,consts:[[1,"container","mt-4"],[1,"mi-perfil"],[1,"box","box-mi-perfil","mb-5","d-flex","align-items-start"],[1,"list","list-data","list-data-title-green","column-md-2","gap-0","list-unstyled"],[1,"list-data__title"],[1,"list-data__text"],[1,"color-verde"],[1,"list","list-links","list-unstyled"],["id","accordionPanelsStayOpenExample",1,"accordion","accordion-flush"],[1,"accordion-item"],["id","panelsStayOpen-headingOne",1,"accordion-header"],["data-bs-toggle","collapse","data-bs-target","#panelsStayOpen-collapseOne",3,"click"],["aria-hidden","true"],["id","panelsStayOpen-collapseOne","aria-labelledby","panelsStayOpen-headingOne",1,"accordion-collapse","collapse"],[1,"accordion-body"],["autocomplete","off",1,"form-recovery",3,"formGroup"],[1,"mb-4"],[1,"input-group"],[1,"input-group-text","input-group-text-left"],["aria-hidden","true",1,"fa","fa-lock","fa-fw"],["type","password","id","password","formControlName","actual","placeholder","Contrase\xf1a actual",1,"form-control"],["type","password","id","password","formControlName","password","placeholder","Nueva contrase\xf1a",1,"form-control"],["type","password","id","repeatPassword","formControlName","repeatPassword","placeholder","Repetir contrase\xf1a",1,"form-control"],["type","button",1,"btn","btn-primary","btn-fa","w-100",3,"click"],["aria-hidden","true",1,"fa","fa-long-arrow-right","fa-fw"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"section",1)(2,"h1"),e._uU(3,"Mi Perfil"),e.qZA(),e.TgZ(4,"div",2)(5,"ul",3)(6,"li")(7,"span",4),e._uU(8,"Nombre Usuario"),e.qZA(),e.TgZ(9,"span",5),e._uU(10),e.qZA()(),e.TgZ(11,"li")(12,"span",4),e._uU(13,"Perfil"),e.qZA(),e.TgZ(14,"span",5),e._uU(15),e.qZA()(),e.TgZ(16,"li")(17,"span",4),e._uU(18,"Tel\xe9fono"),e.qZA(),e.TgZ(19,"span",5),e._uU(20),e.qZA()(),e.TgZ(21,"li")(22,"span",4),e._uU(23,"Correo"),e.qZA(),e.TgZ(24,"span",5),e._uU(25),e.qZA()(),e.TgZ(26,"li")(27,"span",4),e._uU(28,"Instituci\xf3n"),e.qZA(),e.TgZ(29,"span",5),e._uU(30),e.qZA()(),e.TgZ(31,"li")(32,"span",4),e._uU(33,"Cargo"),e.qZA(),e.TgZ(34,"span",5),e._uU(35),e.qZA()(),e.TgZ(36,"li")(37,"span",4),e._uU(38,"Tel\xe9fono Oficina"),e.qZA(),e.TgZ(39,"span",5),e._uU(40),e.qZA()(),e.TgZ(41,"li")(42,"span",4)(43,"b"),e._uU(44,"Fecha/ Hora ingreso"),e.qZA()(),e.TgZ(45,"span",5),e._uU(46),e.ALo(47,"date"),e.qZA()()()(),e.TgZ(48,"h2",6),e._uU(49,"Acciones"),e.qZA(),e.TgZ(50,"ul",7)(51,"div",8)(52,"div",9)(53,"h2",10)(54,"li",11),e.NdJ("click",function(){return r.displayModifyPassword()}),e.TgZ(55,"a")(56,"span"),e._uU(57,"Cambio de contrase\xf1a"),e.qZA(),e._UZ(58,"i",12),e.qZA()()(),e.TgZ(59,"div",13)(60,"div",14)(61,"form",15)(62,"div",16)(63,"div",17)(64,"button",18),e._UZ(65,"i",19),e.qZA(),e._UZ(66,"input",20),e.qZA()(),e.TgZ(67,"div",16)(68,"div",17)(69,"button",18),e._UZ(70,"i",19),e.qZA(),e._UZ(71,"input",21),e.qZA()(),e.TgZ(72,"div",16)(73,"div",17)(74,"button",18),e._UZ(75,"i",19),e.qZA(),e._UZ(76,"input",22),e.qZA()(),e.TgZ(77,"div",16)(78,"button",23),e.NdJ("click",function(){return r.btnrecovery()}),e._uU(79," Enviar "),e._UZ(80,"i",24),e.qZA()()()()()()()()()()),2&t&&(e.xp6(10),e.AsE("",r.userData.FIRST_NAME," ",r.userData.LAST_NAME,""),e.xp6(5),e.Oqu(r.userData.ROL_NAME),e.xp6(5),e.Oqu(r.userData.PHONE),e.xp6(5),e.Oqu(r.userData.EMAIL),e.xp6(5),e.Oqu(r.userData.BUSINESS.join(" || ")),e.xp6(5),e.Oqu(r.userData.POSITION),e.xp6(5),e.Oqu(r.userData.PHONE_OFFICE),e.xp6(6),e.Oqu(e.xi3(47,13,r.horaIngreso,"dd-MM-yyyy H:mm:s")),e.xp6(12),e.Gre("fa fa-chevron-",r.pos,""),e.xp6(3),e.Q6J("formGroup",r.formData))},dependencies:[s._Y,s.Fj,s.JJ,s.JL,s.sg,s.u,Z.uU]}),n})();var de=m(574),it=m(3813);const st=["fileInput"];function lt(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.TgZ(13,"td"),e._uU(14),e.qZA(),e.TgZ(15,"td"),e._uU(16),e.qZA(),e.TgZ(17,"td"),e._uU(18),e.qZA(),e.TgZ(19,"td"),e._uU(20),e.qZA(),e.TgZ(21,"td"),e._uU(22),e.qZA(),e.TgZ(23,"td"),e._uU(24),e.qZA(),e.TgZ(25,"td"),e._uU(26),e.qZA(),e.TgZ(27,"td"),e._uU(28),e.qZA(),e.TgZ(29,"td",26)(30,"input",27,17),e.NdJ("change",function(o){const d=e.CHM(t).index,f=e.oxw(2);return e.KtG(f.onInvoiceChange(o,d))}),e.qZA(),e.TgZ(32,"button",14),e.NdJ("click",function(){e.CHM(t);const o=e.MAs(31);return e.KtG(o.click())}),e._UZ(33,"i",18),e._uU(34," Cargar Factura "),e.qZA(),e.TgZ(35,"p"),e._uU(36),e.qZA()(),e.TgZ(37,"td"),e._UZ(38,"i",28),e.qZA()()}if(2&n){const t=l.$implicit,r=l.index,o=e.oxw(2);e.xp6(2),e.Oqu(t.nameBusiness),e.xp6(2),e.Oqu(t.establishment),e.xp6(2),e.Oqu(t.treatmentType),e.xp6(2),e.Oqu(t.material),e.xp6(2),e.Oqu(t.subMaterial),e.xp6(2),e.Oqu(t.withdrawalDate.replaceAll("/","-")),e.xp6(2),e.Oqu(t.numberInvoice),e.xp6(2),e.Oqu(t.vat),e.xp6(2),e.Oqu(t.vatCompanyName),e.xp6(2),e.Oqu(t.frontAdmissionDate),e.xp6(2),e.Oqu(t.totalWeightFormated),e.xp6(2),e.Oqu(t.declaratedWeightFormated),e.xp6(2),e.Oqu(t.valuedWeightFormated),e.xp6(2),e.Oqu(t.fixedRemainingWeight.replace(".",",")),e.xp6(8),e.Oqu(o.fileNames[r]),e.xp6(2),e.Q6J("ngClass",o.fileNames[r]?"color-verde":"color-verde-opaco")}}function ct(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",20)(1,"table",21)(2,"thead")(3,"tr",22)(4,"th"),e._uU(5,"Empresa CI"),e.qZA(),e.TgZ(6,"th"),e._uU(7,"Establecimiento"),e.qZA(),e.TgZ(8,"th"),e._uU(9,"Tipo Tratamiento"),e.qZA(),e.TgZ(10,"th"),e._uU(11,"Material"),e.qZA(),e.TgZ(12,"th"),e._uU(13,"Subtipo"),e.qZA(),e.TgZ(14,"th"),e._uU(15,"Fecha Retiro"),e.qZA(),e.TgZ(16,"th"),e._uU(17,"N\xfam. Factura Reciclador"),e.qZA(),e.TgZ(18,"th"),e._uU(19,"Rut Reciclador"),e.qZA(),e.TgZ(20,"th"),e._uU(21,"Reciclador"),e.qZA(),e.TgZ(22,"th"),e._uU(23,"Fecha ingreso PR"),e.qZA(),e.TgZ(24,"th"),e._uU(25,"Peso Total"),e.qZA(),e.TgZ(26,"th"),e._uU(27,"Peso Declarado"),e.qZA(),e.TgZ(28,"th"),e._uU(29,"Peso Valorizado"),e.qZA(),e.TgZ(30,"th"),e._uU(31,"Peso Remanente"),e.qZA(),e.TgZ(32,"th"),e._uU(33,"Carga Factura"),e.qZA(),e.TgZ(34,"th"),e._uU(35,"Estado"),e.qZA()()(),e.TgZ(36,"tbody"),e.YNc(37,lt,39,16,"tr",23),e.qZA(),e.TgZ(38,"tbody")(39,"tr"),e._UZ(40,"td")(41,"td")(42,"td")(43,"td")(44,"td")(45,"td")(46,"td")(47,"td")(48,"td")(49,"td")(50,"td")(51,"td")(52,"td")(53,"td"),e.TgZ(54,"td",24)(55,"button",25),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.saveAllInvoices())}),e._uU(56," Finalizar "),e.qZA()()()()()()}if(2&n){const t=e.oxw();e.xp6(37),e.Q6J("ngForOf",t.allInvoices),e.xp6(18),e.Q6J("ngClass",t.verification==t.allInvoices.length?"":"disabled")}}let ut=(()=>{class n{constructor(t,r,o){this.establishmentService=t,this.managerService=r,this.businessService=o,this.dbBusiness=[],this.invoices=[],this.invoicesDuplicated=[],this.allInvoices=[],this.index=0,this.fileNames={},this.verification=0,this.fileToUpload={},this.wasteTypes={PapelCart\u00f3n:["Papel","Papel Compuesto (cemento)","Caja Cart\xf3n","Papel/Cart\xf3n Otro"],Metal:["Envase Aluminio","Malla o Reja (IBC)","Envase Hojalata","Metal Otro"],Pl\u00e1stico:["Pl\xe1stico Film Embalaje","Pl\xe1stico Envases R\xedgidos (Incl. Tapas)","Pl\xe1stico Sacos o Maxisacos","Pl\xe1stico EPS (Poliestireno Expandido)","Pl\xe1stico Zuncho","Pl\xe1stico Otro"],Madera:["Caja de Madera","Pallet de Madera"]}}ngOnInit(){this.userData=JSON.parse(sessionStorage.getItem("user")),localStorage.removeItem("statementsState")}downloadExcel(){a().fire({title:"Generando Excel",text:"Esto puede tardar varios minutos",timerProgressBar:!0,showConfirmButton:!1,allowEscapeKey:!1,allowOutsideClick:!1}),a().showLoading(),this.managerService.downloadExcelTemplateInvoice().subscribe({next:t=>{if(t){const r=new Blob([t],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});let o=document.createElement("a");o.href=window.URL.createObjectURL(r),o.download="carga masiva gestor",document.body.appendChild(o),o.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),o.remove(),window.URL.revokeObjectURL(o.href),a().close()}},error:t=>{if(t instanceof Blob){const r=new FileReader;r.onload=()=>{const o=r.result;try{const i=JSON.parse(o);!1===i.status&&i.message?a().fire({icon:"error",text:i.message}):a().fire({icon:"error",text:"Documento para carga masiva no disponible."})}catch{a().fire({icon:"error",text:"Error desconocido al procesar la respuesta."})}},r.readAsText(t)}else a().fire({icon:"error",text:"Error desconocido al procesar la respuesta."})}})}onFileChange(t){const o=t.target;if(1!==o.files.length)return void a().fire({icon:"error",text:"Solo puede cargar un archivo a la vez"});const i=o.files[0];if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(i.type))return void a().fire({icon:"error",text:"Tipo de archivo incorrecto. Por favor, cargue un archivo Excel (.xls o .xlsx)"});if(o.files[0].size>1048576)return void a().fire({icon:"error",text:"Tama\xf1o del archivo excede el l\xedmite (1MB m\xe1ximo)."});const v=new FileReader;v.onload=_=>{const W=de.ij(_.target.result,{type:"binary"});if(!W.SheetNames.includes("Carga Masiva"))return void a().fire({icon:"error",text:'No se encontr\xf3 la hoja "Carga Masiva" en el archivo.'});const F=de.P6.sheet_to_json(W.Sheets["Carga Masiva"],{header:1});this.processData(F)},v.readAsBinaryString(i),this.resetFileInput()}resetFileInput(){this.fileInput.nativeElement.value=""}onInvoiceChange(t,r){const i=t.target;if(i.files.length>1)return void a().fire({icon:"error",text:"Solo puede cargar un archivo a la vez"});if(!["application/pdf","image/jpeg"].includes(i.files[0].type))return void a().fire({icon:"error",text:"Tipo de archivo incorrecto. Por favor, cargue un archivo v\xe1lido (.pdf, .jpeg o .jpg)"});if(i.files[0].size>1048576)return void a().fire({icon:"error",text:"Tama\xf1o del archivo excede el l\xedmite (1MB m\xe1ximo)."});const _=t.target.files[0];_&&(this.fileNames[r]=_.name,this.fileToUpload[r]=_,this.verification=Object.keys(this.fileNames).length),this.resetFileInput()}processData(t){var r=this;return(0,x.Z)(function*(){if(a().fire({title:"Procesando datos",text:"Se estan validando los datos",timerProgressBar:!0,showConfirmButton:!1,allowEscapeKey:!1,allowOutsideClick:!1}),a().showLoading(),0==t.length)return void a().fire({icon:"error",text:"Archivo inv\xe1lido. No tiene todas las columnas necesarias"});const o=t.slice(1).filter(u=>u.length>0&&u.some(c=>c)),i=[],d=[];if(0==o.length)return void a().fire({icon:"info",text:"Archivo inv\xe1lido, verifique que no est\xe9 vac\xedo."});if(13!=t[0].length)return void a().fire({icon:"error",text:"Archivo inv\xe1lido, no tiene todas las columnas necesarias."});const v=(yield r.establishmentService.getDeclarationEstablishment().toPromise()).status.filter(u=>0===u.STATE_GESTOR),_=yield r.managerService.getAllMaterials().toPromise(),N=yield r.managerService.getAllTreatments().toPromise(),W=yield r.businessService.getAllBusiness().toPromise(),y=new Set;for(let u=0;u<o.length;u++){const c=o[u],p=u+2;if(0==c.length&&0==u)return void a().fire({icon:"error",text:"Archivo vac\xedo"});const I=c[0];if(!I)return void a().fire({icon:"error",text:`Empresa CI no ingresado en la fila ${p}`});const M=c[1];if(!M)return void a().fire({icon:"error",text:`Establecimiento no ingresado en la fila ${p}`});const B=c[2];if(!B)return void a().fire({icon:"error",text:`Tipo de tratamiento no ingresado en la fila ${p}`});const k=c[3];if(!k)return void a().fire({icon:"error",text:`Material no ingresado en la fila ${p}`});const X=c[4];if(!X)return void a().fire({icon:"error",text:`Subtipo no ingresado en la fila ${p}`});const me=c[5];if(!me)return void a().fire({icon:"error",text:`Fecha retiro no ingresado en la fila ${p}`});const Y=c[6];if(!Y)return void a().fire({icon:"error",text:`Numero factura no ingresado en la fila ${p}`});if(Y<=0)return void a().fire({icon:"error",text:`Numero factura ingresado en la fila ${p} debe ser mayor que cero`});const $=c[7];if(!$)return void a().fire({icon:"error",text:`RUT no ingresado en la fila ${p}`});let ee;const te=_.status.find(g=>g.MATERIAL===k);if(!te)return void a().fire({icon:"error",text:`No se encontr\xf3 ningun material con el nombre "${k}" en la fila ${p}`});let re;te&&(ee=te.ID);const oe=N.status.find(g=>g.NAME===B);if(!oe)return void a().fire({icon:"error",text:`No se encontr\xf3 ningun tipo de tratamiento con el nombre "${B}" en la fila ${p}`});oe&&(re=oe.ID);const j=c[8];if(!j)return void a().fire({icon:"error",text:`Reciclador no ingresado en la fila ${p}`});let pe;const ne=W.status.find(g=>g.NAME===j&&g.VAT===$);if(!ne)return void a().fire({icon:"error",text:`No se encontr\xf3 ningun reciclador con el nombre "${j}" asociado al rut "${$}" en la fila ${p}`});ne&&(pe=ne.ID);const ae=c[9];if(!ae)return void a().fire({icon:"error",text:`Fecha ingreso PR no ingresado en la fila ${p}`});const ge=r.isValidDate(ae);if(!ge.valid)return void a().fire({icon:"error",text:`Error en la fila ${p}. ${ge.message}`});let E,q,L;const z=yield r.establishmentService.getInovice(Y,$,re,ee).toPromise();if(!z.status)return void a().fire({icon:"error",text:`La fila ${p} tiene el siguiente error: `+z.msg});if(E=r.formatNumber(z.data[0]?.invoice_value),L=r.formatNumber(z.data[0].value_declarated),0==E&&!c[10])return void a().fire({icon:"error",text:`Peso total no ingresado en la fila ${p}`});if(0==E&&(E=c[10]),0!==E&&E!==c[10])return void a().fire({icon:"info",text:`La factura con numero ${Y} de la fila ${p} ya cuenta con datos existentes, favor de ingresar el peso total registrado previamente (${E})`});const ht=E.replace(",","."),he=parseFloat(ht);if(isNaN(he))return void a().fire({icon:"error",text:`Peso total ingresado en la fila ${p} no es v\xe1lido, debe ser solo n\xfameros y con comas.`});if(he<=0)return void a().fire({icon:"error",text:`Peso total ingresado en la fila ${p} debe ser mayor que cero.`});if(q=c[11],0==q&&!c[11])return void a().fire({icon:"error",text:`Peso declarado no ingresado en la fila ${p}`});0==q&&(q=c[11]);const D=c[12];if(!D)return void a().fire({icon:"error",text:`Peso valorizado no ingresado en la fila ${p}`});const ft=D.replace(",","."),fe=parseFloat(ft);if(isNaN(fe))return void a().fire({icon:"error",text:`Peso valorizado ingresado en la fila ${p} no es v\xe1lido, debe ser solo n\xfameros y con comas.`});if(fe<=0)return void a().fire({icon:"error",text:`Peso valorizado ingresado en la fila ${p} debe ser mayor que cero.`});const _e=parseFloat(E.toString().replace(",",".")),Te=parseFloat(D.toString().replace(",","."));let V;if(0!==L){const h=_e-parseFloat(L.toString().replace(",",".")),Ae=h-Te;if(V=Ae.toFixed(2).replace(".",","),Ae<0)return void a().fire({icon:"error",text:`Peso remanente calculado en la fila ${p} no puede ser menor que cero.\n ${h} - ${D}  = ${V}`})}if(0==L){const g=_e-Te;if(V=g.toFixed(2).replace(".",","),g<0)return void a().fire({icon:"error",text:`Peso remanente calculado en la fila ${p} no puede ser menor que cero.\n ${E} - ${D}  = ${V}`})}for(let g=u+1;g<o.length;g++){const h=o[g];if(h[2]!==c[2]&&h[3]===c[3]&&h[6]===c[6]&&h[7]===c[7])return void a().fire({icon:"info",text:`Distintos tipos de tratamiento con el mismo tipo de material, N\xfam de factura reciclador y rut reciclador en las filas ${u+2} y ${g+2}`});if(h[2]===c[2]&&h[3]!==c[3]&&h[6]===c[6]&&h[7]===c[7])return void a().fire({icon:"info",text:`Distintos tipos de material con el mismo tipo de tratamiento, N\xfam de factura reciclador y rut reciclador en las filas ${u+2} y ${g+2}`});if(h[2]!==c[2]&&h[3]!==c[3]&&h[6]===c[6]&&h[7]===c[7])return void a().fire({icon:"info",text:`Distintos tipos de tratamiento y material con el mismo N\xfam de factura reciclador y rut reciclador en las filas ${u+2} y ${g+2}`});if(h[2]===c[2]&&h[3]===c[3]&&h[6]===c[6]&&h[7]===c[7]&&h[10]!==c[10])return void a().fire({icon:"info",text:`Ingresar el mismo peso total para todas las facturas iguales con numero ${c[6]}`});h[2]===c[2]&&h[3]===c[3]&&h[6]===c[6]&&h[7]===c[7]&&h[10]===c[10]&&(y.add(c),y.add(h))}const ve=c[13],ie=ae.split("/"),Ze=new Date(`${ie[2]}-${ie[1]}-${ie[0]}`).toISOString().split("T")[0],se=Ze.split("-"),Tt=`${se[2]}-${se[1]}-${se[0]}`;if(!v.find(g=>g.NAME_BUSINESS===I&&g.NAME_ESTABLISHMENT_REGION===M&&g.TipoTratamiento===B&&g.PRECEDENCE===k&&g.TYPE_RESIDUE===X&&g.VALUE===parseFloat(c[11])&&g.ID_DETAIL==parseInt(ve)))return void a().fire({icon:"error",text:`No se encontr\xf3 ninguna factura pendiente en la base de datos con los registros de la fila ${p}`});const vt=parseFloat(E.replace(",",".")).toFixed(2).replace(".",",").toString(),Zt=parseFloat(D.replace(",",".")).toFixed(2).replace(".",",").toString();let le;"number"==typeof q&&(le=parseFloat(q.toString().replace(",",".")).toFixed(2).replace(".",",").toString()),"string"==typeof q&&(le=parseFloat(q.replace(",",".")).toFixed(2).replace(".",",").toString());const be={nameBusiness:I,idBusiness:pe,establishment:M,treatmentType:B,material:k,subMaterial:X,withdrawalDate:me,numberInvoice:Y,vat:$,vatCompanyName:j,backAdmissionDate:Ze,totalWeight:E,declaratedWeight:q,valuedWeight:D,fixedRemainingWeight:V,idDetail:ve,frontAdmissionDate:Tt,totalWeightFormated:vt,valuedWeightFormated:Zt,declaratedWeightFormated:le,declaratedWeightResponse:L,materialTypeNum:ee,treatmentTypeNum:re};let ce=!1;for(const g of y)g.includes($)&&(ce=!0);0==ce&&i.push(be),1==ce&&d.push(be)}const F={};let U=null,G=null;for(const u of d){const c=`${u.vat}`;F[c]||(F[c]={tipo_tratamiento:u.treatmentType,material:u.material,numero_factura:u.numberInvoice,rut_reciclador:u.vat,remanente_total:0}),null===U&&null===G&&(U=0!==parseFloat(u.declaratedWeightResponse)?parseFloat(u.totalWeight.toString().replace(",","."))-parseFloat(u.declaratedWeightResponse.toString().replace(",",".")):parseFloat(u.totalWeight.replace(",",".")),G=u.vat),G!=u.vat&&(U=0!==parseFloat(u.declaratedWeightResponse)?parseFloat(u.totalWeight.toString().replace(",","."))-parseFloat(u.declaratedWeightResponse.toString().replace(",",".")):parseFloat(u.totalWeight.replace(",",".")),G=u.vat),U-=parseFloat(u.valuedWeight.replace(",",".")),u.fixedRemainingWeight=U.toFixed(2).replace(".",",").toString(),F[c].remanente_total=U}for(const u in F)if(F.hasOwnProperty(u)){const c=F[u].remanente_total;if(c<0)return void a().fire({icon:"error",text:`Los remanentes totales para las facturas con numero ${u} son menores a cero: ${c}`})}r.invoices=i,r.invoicesDuplicated=d,r.allInvoices=Array.from([...i,...d]),a().close()})()}saveAllInvoices(){var t=this;return(0,x.Z)(function*(){a().fire({title:"Ingresando datos",text:"Se estan cargando los datos",timerProgressBar:!0,showConfirmButton:!1,allowEscapeKey:!1,allowOutsideClick:!1}),a().showLoading();let r=!1;for(let o=0;o<t.allInvoices.length;o++){const i=t.allInvoices[o];if(t.allInvoices.length==Object.keys(t.fileNames).length&&t.fileNames[o])try{if(!(yield Promise.race([t.establishmentService.saveInvoice(i.vat,i.idBusiness,i.numberInvoice,i.idDetail,i.backAdmissionDate,i.valuedWeight.replace(",","."),i.totalWeight.replace(",","."),i.treatmentTypeNum,i.materialTypeNum,t.fileToUpload[o]).toPromise(),new Promise((f,v)=>{setTimeout(()=>v(new Error("Timeout")),3e4)})])).status)return r=!0,t.allInvoices=[],a().close(),void a().fire({icon:"error",text:"Ha habido un error y el proceso se ha detenido, consulte m\xe1s tarde el estado de sus declaraciones para ver cuales fueron exitosamente aprobadas y cuales no."})}catch(d){if("Timeout"===d.message)return r=!0,t.allInvoices=[],a().close(),void a().fire({icon:"error",text:"Ha habido un error y el proceso se ha detenido, consulte m\xe1s tarde el estado de sus declaraciones para ver cuales fueron exitosamente aprobadas y cuales no."});throw r=!0,t.allInvoices=[],a().close(),a().fire({icon:"error",text:"Ha habido un error y el proceso se ha detenido, consulte m\xe1s tarde el estado de sus declaraciones para ver cuales fueron exitosamente aprobadas y cuales no."}),d}}t.allInvoices=[],r||(a().close(),a().fire({icon:"success",text:"Sus facturas han sido ingresadas correctamente"}))})()}formatNumber(t){return null==t?"":Number.isInteger(t)?t.toString():t.toLocaleString("es")}isValidDate(t){if(typeof t>"u"||""===t.trim())return{valid:!1,message:"Fecha no puede estar vac\xeda."};const r=t.split("/");if(3!==r.length||isNaN(+r[0])||isNaN(+r[1])||isNaN(+r[2]))return{valid:!1,message:"Formato de la fecha es incorrecto. Formato requerido: DD/MM/AAAA"};const o=new Date(+r[2],+r[1]-1,+r[0]),i=new Date;return i.setHours(0,0,0,0),o>i?{valid:!1,message:"Fecha no debe ser futura."}:o.getDate()!==+r[0]||o.getMonth()!==+r[1]-1||o.getFullYear()!==+r[2]?{valid:!1,message:"Fecha proporcionada no es v\xe1lida."}:{valid:!0,message:""}}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(P.d),e.Y36(it.b),e.Y36(w.m))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-bulk-upload"]],viewQuery:function(t,r){if(1&t&&e.Gf(st,5),2&t){let o;e.iGM(o=e.CRH())&&(r.fileInput=o.first)}},decls:28,vars:1,consts:[[1,"container","mt-4"],["aria-label","breadcrumb",1,"breadcrumbs","d-none","d-lg-block"],[1,"breadcrumb"],[1,"breadcrumb-item"],["href","#"],["aria-hidden","true",1,"fa","fa-home"],["aria-current","page",1,"breadcrumb-item","active"],[1,"declaracion"],[1,"d-sm-flex","justify-content-between","mb-3","mb-md-0"],[1,"box","box-form","mb-4"],[1,"row","align-items-end"],[1,"col-12","col-xl-12"],[1,"row"],[1,"col-6"],[1,"btn","btn-primary","col-12",3,"click"],[1,"fas","fa-download"],["type","file","id","file-input","accept",".xls,.xlsx,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",2,"display","none",3,"change"],["fileInput",""],[1,"fas","fa-upload"],["class","box box-form mb-12",4,"ngIf"],[1,"box","box-form","mb-12"],[1,"table","table-even","table-section","table-borderless","table-radius"],["align","center"],[4,"ngFor","ngForOf"],["colspan","2"],[1,"btn","btn-primary","col-12",3,"ngClass","click"],[2,"width","1000px"],["type","file","id","file-input","accept",".pdf,.jpeg,.jpg",2,"display","none",3,"change"],["aria-hidden","true","id","submit",1,"fa","fa-check","fa-lg","fa-fw",3,"ngClass"]],template:function(t,r){if(1&t){const o=e.EpF();e.TgZ(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),e._UZ(5,"i",5),e._uU(6," Inicio"),e.qZA()(),e.TgZ(7,"li",6),e._uU(8,"Carga Masiva Factura Reciclador"),e.qZA()()(),e.TgZ(9,"section",7)(10,"h1"),e._uU(11,"Carga Masiva Factura Reciclador"),e.qZA(),e._UZ(12,"div",8),e.TgZ(13,"div",9)(14,"div",10)(15,"div",11)(16,"div",12)(17,"div",13)(18,"button",14),e.NdJ("click",function(){return r.downloadExcel()}),e._UZ(19,"i",15),e._uU(20," Descargar declaraciones pendientes por aprobar "),e.qZA()(),e.TgZ(21,"div",13)(22,"input",16,17),e.NdJ("change",function(d){return r.onFileChange(d)}),e.qZA(),e.TgZ(24,"button",14),e.NdJ("click",function(){e.CHM(o);const d=e.MAs(23);return e.KtG(d.click())}),e._UZ(25,"i",18),e._uU(26," Cargar declaraciones "),e.qZA()()()()()(),e.YNc(27,ct,57,2,"div",19),e.qZA()()}2&t&&(e.xp6(27),e.Q6J("ngIf",r.allInvoices.length>0))},dependencies:[Z.mk,Z.sg,Z.O5],styles:["[_nghost-%COMP%]{width:90%!important;padding:1%}.color-verde[_ngcontent-%COMP%]{color:green}.color-verde-opaco[_ngcontent-%COMP%]{color:#0080004d}.circle[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:50%;display:inline-block;margin-right:5px}.green-circle[_ngcontent-%COMP%]{background-color:green}.red-circle[_ngcontent-%COMP%]{background-color:red}"]}),n})();var dt=m(9314);const mt=[{path:"",component:R.$,children:[{path:"home",component:T},{path:"statements",component:ot},{path:"profile",component:at},{path:"faq",component:dt.v},{path:"bulk-upload-invoice",component:ut},{path:"**",redirectTo:"home",pathMatch:"full"}]}];let pt=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[C.Bz.forChild(mt),C.Bz]}),n})(),gt=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[Z.ez,pt,s.UX,s.u5]}),n})()}}]);